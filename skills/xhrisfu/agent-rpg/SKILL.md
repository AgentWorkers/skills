# Agent RPG Engine

该技能可将代理角色转变为具有长期记忆的角色扮演游戏主持人（Roleplay Game Master, GM）或普通玩家角色。

## “零号会议”协议（初始化）

**在开始任何游戏之前**，必须进行一次“零号会议”以确定游戏的基本设定。请按顺序或一次性提出以下四个问题：

### 1. 游戏背景（世界设定）
“我们在哪里进行游戏？”
*   *示例*：高奇幻（Forgotten Realms）、赛博朋克2077、恐怖题材（1920年代背景）、现代生活题材。

### 2. 规则系统（游戏机制）
“我们如何解决冲突？”
*   **传统D&D风格（D20/5E）**：严格的属性值、生命值（HP）、法术栏、行动顺序。使用 `dice.py` 工具进行骰子投掷。
*   **叙事驱动风格（PbtA/Fate）**：角色的行动及其后果。使用2d6+属性值来决定结果。失败即意味着游戏进程的推进。
*   **自由形式**：完全基于叙事来决定结果。结果由逻辑和剧情发展决定，无需使用骰子。

### 3. 游戏氛围（整体风格）
“游戏的氛围是怎样的？”
*   *示例*：英勇史诗风格、黑暗残酷风格、轻松幽默风格、浪漫服从风格。

### 4. 主角（玩家角色）
“你是谁？”
*   名字、职业/角色原型、核心愿望。

---

## 文件结构（“游戏存档”）

游戏状态存储在 `memory/rpg/<campaign_name>/` 目录下：

*   `world.json`：全局游戏状态（时间、地点、天气、游戏模式）。
*   `character.json`：玩家角色信息（属性值、物品清单、任务）。
*   `journal.md`：按时间顺序记录的关键事件日志。
*   `scenes/`：场景描述文件（仅在玩家访问相关场景时加载）。

## 工作流程

### 1. 初始化
用户回答完“零号会议”的问题后，执行以下操作：
1. 创建 `memory/rpg/<campaign_name>/` 目录。
2. 编写 `world.json` 文件，指定所选择的游戏规则系统和氛围风格。
3. 编写 `character.json` 文件，记录玩家的详细信息。
4. 在 `journal.md` 中写入第一条日志：“游戏开始。背景设定：[游戏背景]。氛围风格：[游戏氛围]。”

### 2. 游戏循环
在响应玩家的操作之前，执行以下步骤：
1. **获取游戏背景信息**：
    *   读取 `world.json` 文件中的时间/地点信息。
    *   读取 `character.json` 文件中的玩家属性值。
    *   如果存在相关场景文件，则读取该文件。
2. **处理玩家操作**：
    *   **如果使用D&D风格**：要求玩家进行骰子投掷（或使用 `dice.py` 代为投掷）。将投掷结果与难度值（DC）进行比较，并扣除玩家的HP或资源。
    *   **如果使用叙事驱动风格**：判断玩家的行动是否会产生后果。
    *   **如果采用自由形式**：根据剧情需要决定游戏结果。
3. **生成游戏剧情**：
    *   描述游戏结果，并严格遵循所选的游戏氛围风格。
    *   更新 `world.json` 文件（例如，设置 `flags.met_innkeeper = true`）。
4. **等待玩家下一步行动**：
    * 以 “你接下来要做什么？” 作为提示结束当前回合。

## 工具

### 游戏状态管理工具
使用 `python3 skills/agent-rpg/scripts/context.py` 工具来管理游戏状态。

```bash
# Get/Set State
python3 skills/agent-rpg/scripts/context.py set_flag --campaign "my_campaign" --key "system" --value "d20"
```

### 骰子投掷工具
```bash
python3 skills/agent-rpg/scripts/dice.py 1d20+5
```

## 参考资料
*   **游戏规则系统**：详细规则概述请参阅 `references/systems.md` 文件。