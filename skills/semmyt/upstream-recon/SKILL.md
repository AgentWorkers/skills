---
name: upstream-recon
description: 在与开源项目进行交互之前（无论是提交 Pull Request (PR)、创建问题还是发表评论），请先对其进行调查。这个步骤应在以下情况下执行：准备提交 PR、创建新问题、对现有讨论进行评论，或者当用户想要与自己不维护的仓库进行交互时。此外，也可以主动使用这个流程——检查现有讨论内容可以避免重复提交问题或浪费精力。
---
# 上游调研（Upstream Recon）

在开始与某个仓库互动之前，先了解该仓库的文化以及现有的问题（issues）和讨论线程。这有助于避免重复提交问题、浪费 Pull Request（PR）的资源，以及做出基于错误信息的决策。

**使用格式**：`<owner/repo> [topic-keyword]`

## 流程

整个过程使用 `gh` 命令行工具（CLI）来完成，并同时运行多个独立的查询：

1. **仓库元数据**：星标数量、分支数量、许可证类型、最后一次推送日期、仓库是否处于归档状态。
2. **贡献者排名前 10 位**：查看他们的提交次数。是否只有一个人贡献了 90% 以上的代码？
3. **现有问题搜索**：搜索与该主题相关的已打开和已关闭的问题。检查是否存在重复问题、先前的解决方案，以及维护者的回复情况，并报告搜索结果。
4. **最近 30 个 PR**（所有状态）：了解仓库的当前开发动态。
5. **被合并的 PR**（最近 20 个）：谁负责合并这些 PR？合并速度如何？哪些类型的 PR 被接受？
6. **未合并就被关闭的 PR**（最近 50 个，筛选条件为 `mergedAt == null`）：深入分析这些 PR。对于其中 2-3 个被拒绝的 PR，阅读维护者的拒绝理由。
7. **未获审核的开放 PR**：有多少 PR 一直未被审核？已经等待了多久？
8. **主题深入分析**（如果提供了关键词）：阅读与主题最相关的 2-3 个问题或 PR 的评论，以了解维护者的态度和社区内的解决方法。

## 分析维度：

- **项目管理方式**：是否由单人维护、小团队管理，还是由社区共同参与？
- **对外部 PR 的态度**：是否欢迎外部贡献者提交 PR（仅接受修复 bug 的 PR，不接受新增功能的 PR）；或者完全封闭外部贡献？
- **问题处理速度**：维护者对问题的响应速度如何？他们是主动处理问题，还是直接关闭问题？
- **合并速度**：外部贡献者的 PR 从提交到被合并需要多长时间？
- **拒绝模式**：维护者是否直接忽略问题？是否选择自行实现功能？还是通过机器人自动关闭 PR？
- **主题相关性**：该主题是否之前已经被讨论过？是否有活跃的解决方法？

## 建议：

根据分析结果，给出以下建议之一：

- **MERGE-LIKELY**：该项目倾向于合并外部提交的功能性 PR，没有冲突的实现方案，维护者也比较愿意接受新功能。
- **MERGE-UNLIKELY**：维护者倾向于自行实现功能，类似的 PR 被关闭或忽略，新提交的 PR 与项目方向不符。
- **FILE-ISSUE-FIRST**：该功能尚未被讨论，维护者虽然会筛选 PR 但会积极回应问题，建议在编码前先了解社区的需求。
- **COMMENT-ON-EXISTING**：如果已有相关问题或 PR，建议在现有解决方案的基础上补充你的解决方法，或者直接在现有问题/PR 下发表评论。
- **DUPLICATE-EXISTS**：如果已经存在相同的问题，建议不要重复提交。

**后续行动建议**：明确指出具体的下一步操作，例如：“在 #13738 下发表评论，分享你的解决方法”；“先提交一个修复 bug 的 PR 以建立信任”；“提交一个引用 #189 的新问题”；“克隆该仓库并独立维护代码”。