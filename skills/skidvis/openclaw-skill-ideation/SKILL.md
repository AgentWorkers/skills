---
name: ideation
description: 将原始的脑力输出（即自由形式的口述内容）转换为结构化的实现文档。适用于用户思路混乱、想法零散、或者只是随意口述的情况；也适用于需要规划某个功能、详细说明需求，或将初步想法转化为可执行的规范文档时。生成的文档会保存在 `./docs/ideation/{project-name}/` 目录下。
---
# 构思过程

通过一个基于信任度评估的工作流程，将用户头脑中的非结构化想法转化为结构化、可执行的实施文档。

## 工作流程

```
INTAKE → CODEBASE EXPLORATION → CONTRACT FORMATION → PHASING → SPEC GENERATION → HANDOFF
              ↓                        ↓                  ↓            ↓               ↓
         Understand              confidence < 95%?    PRDs or     Repeatable?    Analyze deps
         existing code                ↓               straight      ↓               ↓
                                 ASK QUESTIONS        to specs?   Template +    Sequential?
                                      ↓                           per-phase     Parallel?
                                 (loop until ≥95%)                deltas        
```

## 第一阶段：信息收集

接受用户提供的任何内容：
- 杂乱无章的想法和半成型的概念
- 语音转录内容（通常是思维的随意流露）
- 混杂着冗长叙述的要点列表
- 主题跳跃和偏离主题的讨论
- 自相矛盾或不清晰的陈述
- 技术术语与模糊描述混杂在一起

**无需对输入内容进行整理。** 将这些混乱的信息作为输入即可。

确认收到信息后开始分析，此时无需要求用户进一步澄清。

## 第二阶段：代码库探索

**在评估信任度或生成任何文档之前，先了解现有的代码库。** 这一步至关重要——如果在不了解现有代码模式、架构和规范的情况下编写需求文档，可能会导致文档内容过于泛泛而错误。

### 何时进行代码库探索

当以下情况发生时，需要进行代码库探索：
- 用户的思路中提到了现有的代码、功能或系统
- 项目目录中包含源代码（而非从零开始的新项目）
- 用户表示需要扩展、修改或集成现有功能

对于没有现有代码的从零开始的新项目，可以跳过这一阶段。

### 探索内容

通过文件阅读和搜索来了解以下内容：
1. **项目结构**：使用了哪些框架、语言和开发模式？
2. **相关代码**：哪些模块或文件与用户的需求相关？
3. **开发规范和模式**：类似的功能是如何实现的？存在哪些抽象设计？
4. **测试机制**：代码库是如何进行测试的？有哪些测试基础设施？
5. **配置与构建流程**：使用了哪些工具、包管理器以及持续集成/持续部署（CI/CD）系统？

**不要将探索结果写入文件中。** 这些信息只是构思过程中的参考资料，而非最终生成的文档。

## 第三阶段：制定项目契约

### 3.1 分析用户提供的信息

从原始输入内容和代码库探索中提取以下信息：
1. **问题线索**：描述了哪些痛点或需求？
2. **目标线索**：用户希望实现什么？
3. **成功标准**：如何判断项目是否成功？
4. **范围界定**：哪些内容包含在项目范围内？哪些内容被明确排除在外？
5. **矛盾之处**：注意是否存在相互矛盾的陈述。
6. **代码库的限制**：现有代码架构允许或限制了哪些操作？

### 3.2 计算信任度得分

对每个方面进行评分（0-20分）：

| 方面            | 问题                                              |
| ---------------- | -------------------------------------------------------------- |
| 问题清晰度        | 我是否理解了我们正在解决的问题及其重要性？                          |
| 目标定义        | 目标是否具体且可衡量？                                        |
| 成功标准        | 我能否为项目的完成编写测试或验证步骤？                              |
| 范围界定        | 我是否清楚项目的边界？                                        |
| 一致性          | 是否存在需要解决的矛盾之处？                                      |

**总分：/100分**

详细评分标准请参考 `references/confidence-rubric.md`。

### 3.3 信任度阈值

| 得分        | 应采取的行动                                        |
| -------------- | --------------------------------------------------------- |
| < 70           | 存在重大疑问。针对得分最低的方面提出5个以上问题。                          |
| 70-84           | 存在中等程度的疑问。提出3-5个针对性问题。                          |
| 85-94           | 存在较小疑问。提出1-2个具体问题。                          |
| ≥ 95           | 可以开始制定项目契约了。                                      |

### 3.4 提出澄清性问题

当信任度低于95%时，提出澄清性问题：

**提问策略**：
- 首先针对得分最低的方面进行提问
- 问题要具体，避免开放式问题
- 尽可能提供选择选项（例如：“是A、B还是C？”）
- 参考用户之前的陈述（例如：“您提到了X，您是指……吗？”）
- 每轮提问不超过3个问题
- 每轮提问后重新计算信任度得分

### 3.5 制定项目契约

当信任度达到或超过95%时：
1. 与用户确认项目名称
2. 将项目名称转换为驼峰式命名法（例如：`my-project`）
3. 创建输出目录：`./docs/ideation/{project-name}/`
4. 使用 `references/contract-template.md` 模板编写 `contract.md` 文件
5. 在继续下一步之前获得用户的明确批准

**在获得明确批准之前，切勿继续下一步。**

## 第四阶段：项目分阶段规划与需求文档编写

### 4.1 选择工作流程

询问用户：
- **直接编写需求文档**：适用于技术类项目，效率更高。
- **先编写产品需求文档（PRD），再编写详细需求文档**：适用于项目规模较大或涉及跨职能团队的情况。

### 4.2 确定项目阶段

**小型项目的简化方法**：如果项目规模较小，可以在一个阶段内完成（包含1-3个组件，涉及的文件少于10个），则可以跳过分阶段规划，直接编写一个 `spec.md` 文件。

**分阶段规划的标准**（适用于多阶段项目）：
- 依赖关系（哪些部分需要先开发？）
- 风险评估（优先处理高风险项）
- 价值交付（每个阶段完成后用户能否受益？）
- 复杂性（平衡各阶段的开发工作量）

### 4.3 编写产品需求文档（如果选择分阶段开发）

为每个阶段生成 `prd-phase-{n}.md` 文件，使用 `references/prd-template.md` 模板。

### 4.4 编写实施细节文档

使用 `references/spec-template.md` 模板编写实施细节文档：
- 技术实现方案
- 文件变更内容（新增和修改的部分）
- 实现细节及代码模式
- 测试要求
- 错误处理机制
- 验证步骤
- 每个组件的反馈机制

**引用现有代码**：当存在可参考的实现模式时，注明：“参考文档：`path/to/similar/file.ts`”。

### 4.5 提交文档供审核

在提交需求文档之前，先评估反馈机制的有效性，并将所有文档提交给用户审核。

## 第五阶段：执行策略的交接

向用户展示执行策略：

```
Ideation complete. Artifacts written to `./docs/ideation/{project-name}/`.

## To start implementation

Start a fresh session and work through the specs in order:
1. Read the contract for context
2. Read spec-phase-1.md  
3. Implement following the spec
4. Validate using the commands in the spec
5. Commit and move to next phase
```

## 最终输出文档

所有生成的文档都保存在 `./docs/ideation/{project-name}/` 目录下：

```
contract.md                        # Problem, goals, success, scope
prd-phase-1.md                     # Phase 1 requirements (only if PRDs chosen)
spec-phase-1.md                    # Phase 1 implementation spec
spec-template-{pattern}.md         # Shared template for repeatable phases (if applicable)
spec-phase-{n}.md                  # Per-phase specs
```

## 重要注意事项：

- 在评估信任度之前，请先探索代码库（除非项目是从零开始的新项目）。
- 在评估信任度时要保守一些，对不确定的内容给予较低的评分。
- 严禁跳过信任度评估步骤，不要仅凭主观判断就认为已经理解了用户的需求。
- 所有生成的文档都应保存在文件中，而不仅仅是展示在屏幕上。
- 每个阶段都应该具有独立的价值。
- 需求文档应足够详细，以便无需重新阅读产品需求文档或项目契约即可进行开发。
- 项目契约应保持简洁，过多的文档会拖慢开发进度。
- 在需求文档中引用现有的代码实现模式。
- 对于小型项目，无需进行分阶段规划。如果项目仅包含1-3个组件，可以直接编写一个详细的文档即可。