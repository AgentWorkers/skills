---
name: production-readiness
model: reasoning
description: 这是一项元技能（meta-skill），它整合了日志记录（logging）、监控（monitoring）、错误处理（error handling）、性能优化（performance）、安全保障（security）、部署（deployment）以及测试（testing）等方面的能力，以确保服务在正式上线前达到完全的生产就绪状态。建议在首次部署、重大版本更新、季度审查期间，或发生故障后使用该技能。
---

# 生产就绪性（元技能）

该技能将所有运营相关问题整合到一个统一的就绪性评估中。它避免重复各领域的专业知识，而是将问题分配给相应的专业技能团队或人员进行处理，然后将结果综合成一个统一的“可/不可”评估。

## 安装

### OpenClaw / Moltbot / Clawbot

---

## 目的

在服务正式上线之前，通过系统性地检查各项运营指标（如日志记录、错误处理、性能、安全性、部署、测试和文档等），确保服务具备生产就绪条件。

一个具备生产就绪性的服务应具备以下特点：
- **在负载或部分故障情况下能够优雅地处理问题**；
- **通过结构化的日志、指标和追踪机制自我监控**；
- **能够自动从临时故障中恢复**；
- **向运维人员和调度系统报告自身的运行状态**；
- **详细记录操作过程**，以便值班工程师无需深入了解系统内部细节即可进行故障排查。

---

## 适用场景

| 触发条件 | 使用场景 |
|---------|---------|
| **首次部署前** | 新服务首次投入生产环境 |
| **重大版本更新前** | 发布重大功能或架构变更时 |
| **季度生产审查** | 定期对现有服务进行审计 |
| **事故发生后** | 事故发生后进行加固处理，防止类似问题再次发生 |
| **依赖项升级** | 框架、运行时环境或基础设施发生重大变更时 |
| **团队交接** | 服务所有权转移给其他团队时 |

---

## 协调流程

可以依次或并行执行各个检查环节。每个步骤都会分配给相应的专业技能团队或人员处理，该技能本身不会重复实现这些团队的具体逻辑。

### 各环节详细说明

1. **日志记录与可观测性**：结构化日志记录、日志级别设置、关联ID、指标监控端点、分布式追踪系统、警报规则等。
2. **错误处理**：全局错误处理机制、重试策略、死信队列、错误分类、用户友好的错误提示信息等。
3. **性能**：负载测试结果、P95/P99延迟基准值、内存/CPU使用情况分析、数据库查询优化、缓存策略等。
4. **安全性**：身份验证与授权机制、输入数据验证、依赖项安全审计、OWASP常见安全漏洞检查等。
5. **部署**：容器安全加固、回滚策略、蓝绿部署/金丝雀部署方案、基础设施代码化管理等。
6. **测试**：单元测试/集成测试/端到端测试覆盖范围、合同测试、混沌工程/故障注入测试、预发布环境的压力测试等。
7. **文档编写**：API文档、操作手册、架构图、值班工程师处理指南等。

---

## 技能分配表

| 问题类型 | 对应技能/团队 | 处理路径 |
|---------|--------------|------|
| 日志记录与可观测性 | `logging-observability` | `ai/skills/tools/logging-observability/SKILL.md` |
| 错误处理 | `error-handling-patterns` | `ai/skills/backend/error-handling-patterns/SKILL.md` |
| 性能优化 | `performance-agent` | `ai/agents/performance/` |
| 安全性评估 | `security-review` | `ai/skills/meta/security-review/SKILL.md` |
| 容器部署 | `docker-expert` | `ai/skills/devops/docker/SKILL.md` |
| 部署流程 | `deployment-agent` | `ai/agents/deployment/` |
| 测试管理 | `testing-workflow` | `ai/skills/testing/testing-workflow/SKILL.md` |
| 限流策略 | `rate-limiting-patterns` | `ai/skills/backend/rate-limiting-patterns/SKILL.md` |
| 文档编写 | `/generate-docs` | `ai/commands/documentation/` |

> **处理规则：** 首先阅读目标技能的相关说明，按照指示操作，然后将结果反馈到这里进行综合评估。

---

## 生产就绪性检查清单

### 服务健康状况与生命周期管理

- [ ] 健康检查接口（`/healthz` 或 `/health`）能返回依赖项的运行状态。
- [ ] 就绪性检测机制能区分服务是否“正在启动”或“已准备好提供服务”。
- [ ] 活动检测机制能识别死锁和无法恢复的状态。
- [ ] 服务在关闭前会优雅地处理正在进行的请求。
- [ ] 启动过程允许缓慢初始化，避免不必要的重启。

### 韧性保障

- **所有外部服务调用都配备了断路器**。
- **对于临时故障，采用指数级退避和抖动机制进行重试**。
- **为每个接口和客户端配置了限流策略**。
- **背压机制能在负载情况下防止故障链式扩散**。
- **所有出站请求都设置了超时机制**（HTTP、数据库、队列等）。
- **使用隔离机制区分关键路径和非关键路径**。

### 配置管理与 secrets 管理

- **所有配置信息都外部化存储（环境变量、配置服务或配置标志）**。
- **代码、镜像或环境变量中不应包含敏感信息**。
- **敏感信息从安全存储库（如 AWS Secrets Manager、HashiCorp Vault）中加载**。
- **配置变更无需重新部署服务**。
- **对于高风险变更，使用配置标志进行控制**。

### 数据安全

- **制定了备份策略并进行了测试（恢复点/恢复时间已记录）**。
- **在非生产环境中验证了数据恢复流程**。
- **数据库迁移具有向后兼容性和可逆性**。
- **实施了数据保留策略并严格执行**。

### 运营就绪性

- **针对最常见的5种故障场景准备了操作手册**。
- **定义了服务级别目标（SLO，包括可用性、延迟、错误率等）并设置了错误预算**。
- **已将服务级别目标告知相关团队或客户**。
- **值班人员轮换机制已建立，并记录了故障升级流程**。
- **仪表盘能显示关键指标（延迟、流量、错误情况等）**。
- **警报规则设置了适当的阈值和严重性级别**。

---

## 成熟度等级

| 等级 | 名称 | 要求 |
|-------|------|-------------|
| **L1** | **基础级** | 健康检查、基本日志记录、错误处理、手动部署、单元测试、项目说明文档（README） |
| **L2** | **稳定级** | 结构化日志记录、指标监控、优雅关闭机制、持续集成/持续部署（CI/CD）流程、集成测试、操作手册 |
| **L3** | **弹性级** | 分布式追踪系统、断路器、自动扩展机制、混沌工程测试、服务级别目标（SLO）、值班人员轮换机制 |
| **L4** | **优化级** | 自适应限流机制、预测性警报系统、金丝雀部署方案、全面的可观测性机制、错误预算管理、事后分析机制 |

### 发展指南

- **从 L1 升级到 L2**：添加结构化日志记录、指标监控端点以及持续集成/持续部署（CI/CD）流程。为常见的故障模式编写操作手册。
- **从 L2 升级到 L3**：引入分布式追踪系统。为外部调用添加断路器。定义服务级别目标（SLO）并建立值班机制。
- **从 L3 升级到 L4**：实施金丝雀部署方案。采用错误预算管理。定期进行故障模拟测试。建立预测性警报系统。

## 事故响应机制

### 值班人员轮换

- 每个值班小组至少包含两名工程师（主值班员和备用值班员）。
- 交接内容包括最近的一次部署情况、未解决的问题以及已知的风险。
- 明确了故障升级路径：主值班员 → 备用值班员 → 技术团队负责人 → 工程总监。

### 故障升级机制

| 故障严重程度 | 响应时间 | 升级路径 | 相关方通知方式 |
|----------|--------------|-------------------|--------------------------|
| **SEV-1**（严重故障） | 15分钟 | 30分钟 | 立即通知技术团队负责人及客户 |
| **SEV-2**（性能下降） | 30分钟 | 1小时内 | 技术团队负责人 |
| **SEV-3**（轻微故障） | 4小时 | 下一个工作日 | 每日例会 |
| **SEV-4**（外观问题） | 下一个开发周期 | 不需要立即处理 | 记入待办事项列表 |

## 重要注意事项

1. **绝不要跳过健康检查**——所有服务都必须提供健康检查接口；即使是“简单”服务也不例外。
2. **绝不要将敏感信息存储在代码或容器镜像中**——使用专门的 secrets 管理工具；切勿将真实值设置为环境变量的默认值。
3. **绝不要在没有回滚计划的情况下进行部署**——如果无法在5分钟内恢复服务，说明服务尚未准备好上线。
4. **绝不要忽视错误预算的违反情况**——一旦错误预算被耗尽，应立即暂停相关功能的开发并修复系统可靠性问题。
5. **绝不要将日志记录视为可选功能**——没有结构化日志记录的服务在出现问题时将难以排查故障。
6. **绝不要在没有操作手册的情况下将服务投入生产**——如果值班人员在没有原始开发人员协助的情况下无法解决最常见的5种故障问题，说明该服务尚未具备生产就绪条件。