---
name: setup-agent-wallet
description: 为 Uniswap 操作设置一个代理钱包。当用户需要为自主代理提供钱包时可以使用该功能。该钱包支持三种安全级别：Privy（开发环境）、Turnkey（生产环境）和 Safe（最高安全级别）。您可以配置支出限额、允许交易的代币列表，并为钱包充值以太坊（gas）以支持交易费用。
model: opus
allowed-tools: [Task(subagent_type:wallet-provisioner)]
---

# 设置代理钱包

## 概述

为自主运行的Uniswap代理提供并配置钱包。支持三种不同安全级别的钱包提供商，涵盖整个钱包设置流程：创建钱包、配置安全策略、为交易费用（gas）充值以及验证设置是否正确。

## 使用场景

当用户请求以下操作时使用此功能：
- “设置钱包”
- “配置代理钱包”
- “创建钱包”
- “为我的代理设置钱包”
- “创建新的代理钱包”

## 参数

从用户请求中提取以下参数：
| 参数                | 是否必填 | 默认值         | 说明                                                                                          |
|------------------|---------|--------------|--------------------------------------------------------------------------------------------|
| `provider`           | 否       | `privy`         | 钱包提供商：`privy`（开发环境）、`turnkey`（生产环境）或`safe`（最高安全级别） |
| `chains`            | 否       | `all`          | 需要配置的链名；输入“all”表示所有支持的链                     |
| `environment`        | 否       | `development`     | 开发环境或生产环境                                                                                   |
| `spendingLimit`       | 否       | `$1000/天`       | 每日消费限额（例如：“$1000/天”或“$500/天”）                        |

### 提供商选择指南

- **Privy**：最适合开发和测试环境。设置快速，易于管理。不推荐用于涉及大量资金的生产环境。
- **Turnkey**：提供生产级密钥管理功能（使用TEE，即可信执行环境）。适用于中等资金量的实际交易。
- **Safe**：通过多重签名智能账户实现最高级别的安全性。适用于高价值交易或机构级应用。

## 工作流程

1. **解析用户需求**：从用户请求中确定钱包提供商、目标链、环境以及消费限额。未指定的参数使用默认值。
2. **委托给 `wallet-provisioner` 代理**：将参数传递给该代理，由其完成整个设置流程：
   - **创建钱包**：通过选定的提供商的API创建钱包。
   - **配置策略**：设置每笔交易的消费限额、每日消费限额、允许交易的代币列表以及交易速率限制。
   - **充值**：向钱包发送每个目标链所需的交易费用（gas）。
   - **验证**：通过检查钱包余额和策略配置来确认钱包是否正常使用。
3. **反馈结果**：向用户展示钱包设置的详细信息。

## 代理职责

此功能将相关任务委托给 `wallet-provisioner` 代理，由该代理负责处理所有设置步骤，并返回最终的钱包配置信息。

## 输出格式

（输出格式的具体内容在文档的 **```text
Agent Wallet Configured

  Address:    0x1234...ABCD
  Provider:   Privy (development)
  Chains:     Ethereum, Base, Arbitrum
  Limits:     $1,000/day, $500/tx
  Allowlist:  USDC, WETH, UNI, ARB (4 tokens)
  Gas:        Funded on all 3 chains

  Config: .uniswap/agent-wallet.json
```** 部分提供。）

## 错误处理

| 错误类型                | 显示给用户的消息                                                         | 建议的操作                                                         |
|------------------|-------------------------------------------------------------------------|------------------------------------------------------------|
| `PROVIDER_AUTH_FAILED`    | “无法与 [provider] 进行身份验证。请检查 API 密钥。”                        | 确认环境变量中的提供商凭证是否正确。                                      |
| `FUNDING_FAILED`       | “无法为 [chain] 的钱包充值。源钱包余额不足。”                         | 先为源钱包充值。                                                    |
| `CHAIN_NOT_SUPPORTED`    | “[chain] 不受 [provider] 支持。”                                      | 选择其他链或提供商。                                                    |