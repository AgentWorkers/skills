---
name: openclaw-bastion
user-invocable: true
metadata: {"openclaw":{"emoji":"\ud83c\udfdb\ufe0f","requires":{"bins":["python3"]},"os":["darwin","linux","win32"]}}
---

# OpenClaw Bastion

OpenClaw Bastion 是一款专为代理工作空间设计的运行时提示注入防御工具。虽然其他工具会监控工作空间的身份验证文件，但 Bastion 主要保护输入/输出边界——即代理程序读取的文件、网页内容、API 响应以及用户提供的文档。

## 重要性

代理程序会处理来自多种来源的内容：本地文件、API 响应、网页以及用户上传的文件。这些内容都可能包含提示注入攻击（即用于操控代理行为的隐藏指令）。Bastion 会在代理程序处理这些内容之前对其进行扫描。

## 命令

### 扫描注入攻击

- **扫描文件或目录**：检测文件或目录中是否存在提示注入的恶意模式，包括指令覆盖、系统提示标记、隐藏的 Unicode 字符、Markdown 数据泄露、HTML 注入、Shell 注入、编码后的payload、分隔符混淆等多种攻击手段。
- **扫描特定文件或目录**：可以针对指定的文件或目录进行扫描。
- **快速文件检查**：对单个文件进行快速的注入攻击检测，检测方式与“扫描”命令相同。

### 边界分析

- **分析工作空间的内容边界安全性**：识别以下问题：
  - 包含混合可信/不可信内容的代理指令文件；
  - 可被攻击的指令文件（可能被用于发起攻击）；
  - 每个关键文件的潜在风险等级。

### 命令允许列表

- **显示当前的命令允许列表和禁止列表**：如果系统中没有 `.bastion-policy.json` 文件，Bastion 会自动生成一个默认的配置文件。
- **自定义策略**：可以直接编辑该 JSON 文件来定义哪些命令是安全的，哪些模式是被禁止的。Bastion Pro 会在运行时通过钩子（hooks）来执行这些策略。

### 状态信息

- 提供工作空间注入防御状态的快速概览：包括已扫描的文件数量、检测到的问题（按严重程度分类）、边界安全状况以及整体防御效果。

## 自动检测工作空间

如果未指定 `--workspace` 参数，Bastion 会尝试从以下位置获取工作空间信息：
- `OPENCLAW_WORKSPACE` 环境变量；
- 当前目录（如果存在 `AGENTS.md` 文件）；
- `~/.openclaw/workspace`（默认路径）。

## 可检测的攻击类型及严重程度

| 类型          | 检测模式                | 严重程度 |
|------------------|----------------------|
| **指令覆盖**       | “ignore previous”、“disregard above”等           | CRITICAL（严重） |
| **系统提示标记**     | `<system>`, `[SYSTEM]`, `<<SYS>>`等           | CRITICAL（严重） |
| **隐藏指令**       | 多轮操控指令（如“在下次响应中必须执行某操作”）      | CRITICAL（严重） |
| **HTML 注入**       | `<script>`, `<iframe>`, `<img onerror=>`等         | CRITICAL（严重） |
| **Markdown 数据泄露**   | URL 中包含编码数据的图像标签             | CRITICAL（严重） |
| **危险命令**      | `curl \| bash`, `wget \| sh`, `rm -rf /`等         | CRITICAL（严重） |
| **Unicode 欺骗**     | 零宽度字符、RTL 文本格式等             | WARNING（警告） |
| **同形异义词替换**     | 在 ASCII 文本中混入西里尔文/拉丁文字符       | WARNING（警告） |
| **Base64 编码的 payload** | 代码块外的大型编码数据             | WARNING（警告） |
| **Shell 注入**       | `$(command)` 形式的子shell执行             | WARNING（警告） |
| **分隔符混淆**     | 伪造的代码块边界（实际包含注入代码）           | WARNING（警告） |

## 扫描机制

- **上下文感知**：
  - 会跳过被 ```` ` 标签括起来的代码块内的内容，以避免误报；
  - 根据检测到的问题数量和严重程度对文件进行风险评分；
  - Bastion 会自动排除自身的配置文件（因为这些文件本身包含注入攻击的规则）。

## 错误代码

- **0**：扫描完成，未发现任何问题。
- **1**：检测到警告，建议查看相关日志。
- **2**：发现严重问题，需要立即采取行动。

## 依赖性

- 仅依赖 Python 标准库，无需安装额外的库或工具（如 pip）；
- 不涉及网络请求，所有操作都在本地完成。

## 跨平台兼容性

Bastion 可与 OpenClaw、Claude Code、Cursor 以及任何遵循 Agent Skills 规范的工具配合使用。