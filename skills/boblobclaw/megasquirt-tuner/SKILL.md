---
name: megasquirt-tuner
description: Megasquirt ECU tuning and calibration using TunerStudio. Use when working with Megasquirt engine management systems for: (1) VE table tuning and fuel map optimization, (2) Ignition timing maps and spark advance, (3) Idle control and warmup enrichment, (4) AFR target tuning and closed-loop feedback, (5) Sensor calibration (TPS, MAP, CLT, IAT, O2), (6) Acceleration enrichment and deceleration fuel cut, (7) Boost control and launch control setup, (8) Datalog analysis and troubleshooting, (9) Base engine configuration and injector setup, (10) Any Megasquirt/TunerStudio ECU tuning tasks.
---

# 使用TunerStudio对Megasquirt电子控制单元（ECU）进行调校

本指南介绍了如何使用TunerStudio软件对Megasquirt发动机管理系统进行调校。

## 核心概念

### 所需燃油计算公式
Megasquirt根据以下公式计算燃油喷射量：
```
Pulse Width = Required Fuel × VE% × MAP × AFR Target Correction × Air Density × Warmup × Accel Enrichment × Other Corrections
```

**所需燃油量**是指在100%的真空度（VE）、100kPa的进气压力（MAP）和标准温度下的基础喷射器脉冲宽度。

### 主要调校表格

| 表格 | 用途 | 典型分辨率 |
|-------|---------|-------------------|
| VE表格 | 空气容积效率与转速/进气压力（RPM/MAP）的关系 | 12×12（MS2），最高16×16（MS3） |
| AFR目标值 | 所需的空燃比与转速/进气压力（RPM/MAP）的关系 | 12×12（MS2），最高16×16（MS3） |
| 火花提前角 | 点火正时与转速/进气压力（RPM/MAP）的关系 | 12×12（MS2），最高16×16（MS3） |
| 加热期燃油加浓 | 燃油修正量与冷却液温度的关系 | 10-20个点 |
| 基于节气门位置传感器（TPS）的加速加浓 | 加速加浓量与TPSdot的关系 | 10-20个点 |
| 基于进气压力（MAP）的加速加浓 | 加速加浓量与MAPdot的关系 | 10-20个点 |

## 调校流程

### 1. 基础配置
在开始调校之前，请确认以下内容：
- 发动机排量和气缸数量
- 喷射器流量（cc/min或lb/hr）
- 喷射器的喷射方式（同时喷射、交替喷射、顺序喷射）
- 所需燃油量——TunerStudio会根据发动机参数（排量、喷射器数量、喷射器流量和喷射分配器）自动计算该值。请勿手动计算，使用固件内置的计算功能。
- 点火输入/输出设置与硬件匹配
- 触发轮和点火模式已正确配置（使用“触发器向导”进行触发轮解码器设置）
- INI文件与安装的固件版本一致（不匹配可能导致连接错误或设置错误）

### 2. 传感器校准
在调校前，请校准所有传感器（操作均在TunerStudio的“工具”菜单下进行）：
- **冷却液温度（CLT）**：工具 → 校准热敏电阻——选择预设值（GM、Ford、Bosch）或输入自定义电阻值
- **进气温度（IAT）**：工具 → 校准热敏电阻——与CLT相同的过程
- **节气门位置传感器（TPS）**：工具 → 校准TPS——在节气门关闭和全开位置采样
- **进气压力（MAP）**：工具 → 校准MAP/气压传感器——在发动机启动时验证大气压读数；常用传感器包括MPX4250（250kPa）和MPXH6400（400kPa）
- **氧传感器（O2 Sensor）**：工具 → 校准AFR——设置宽频控制器电压与AFR的映射关系

### 3. VE表格调校（速度密度）
**方法1：使用宽频氧传感器反馈**
1. 启用EGO（Engine Oxygen Sensor）修正功能，修正范围为±15-20%
2. 设置合理的AFR目标值
3. 使发动机处于稳态运行（固定转速/负载）
4. 让EGO进行修正，记录修正百分比
5. 根据修正百分比反向调整VE（例如，若修正为+10%，则将VE增加10%）
6. 保存设置并进入下一个参数调整步骤

**方法2：根据测量的AFR值进行计算**
```
New VE = Current VE × (Measured AFR / Target AFR)
```

**调校顺序：**
1. 从怠速区域开始（600-1000 RPM，30-50kPa）
2. 轻度巡航状态（1500-2500 RPM，40-60kPa）
3. 部分节气门开度下的加速
4. 全开节气门下的高负载状态
5. 过渡区域

### 4. AFR目标值表
根据不同使用场景设置目标AFR值：
| 条件 | 目标AFR | Lambda值 |
|-----------|-----------|--------|
| 怠速 | 13.5-14.5 | 0.92-0.99 |
| 轻度巡航 | 14.5-15.5 | 0.99-1.06 |
| 部分节气门开度 | 13.5-14.5 | 0.92-0.99 |
| 自然吸气下的全开节气门状态 | 12.5-13.0 | 0.85-0.88 |
| 涡轮增压/机械增压下的全开节气门状态 | 11.8-12.5 | 0.80-0.85 |

### 5. 点火正时
**基本设置：**
- 设置点火提前角（通常为10-20° BTDC）
- 设置怠速提前角（通常为15-25° BTDC）
- 根据发动机具体规格构建火花提前角表格

**典型火花提前角表格（自然吸气发动机）：**
- 低转速/高负载：10-20°
- 低转速/低负载：25-35°
- 高转速/高负载：25-35°
- 高转速/低负载：35-45°

**爆震处理：**
- 如果检测到爆震，每次减少1-2°的点火提前角
- 在易爆震区域增加燃油量
- 如有爆震传感器，可利用其反馈数据

### 6. 怠速控制
**怠速阀PWM设置：**
- 关闭位置：热怠速时的PWM占空比（通常为20-40%）
- 开启位置：冷启动时的PWM占空比（通常为60-80%）
- 启动时的PWM占空比：通常为50-70%

**怠速目标转速表：**
- 热态：700-900 RPM
- 冷态（0°C）：1200-1500 RPM
- 在此范围内进行插值调整

### 7. 加热期燃油加浓
**启动后加浓：**
- 持续时间：30-200个循环（发动机转速）
- 加浓量：额外增加20-40%的燃油量
- 在整个加热期内逐渐减少加浓量

**加热期燃油加浓曲线：**
- -40°C：150-200%
- 0°C：120-140%
- 70°C（工作温度）：100%

### 8. 加速加浓
**基本加速加浓（基于TPS）：**
- 阈值：TPSdot每秒变化5-10%
- 加浓量：增加10-30%的燃油量
- 减衰时间：0.5-2秒

**基本加速加浓（基于MAP，适用于ITB发动机）：**
- 阈值：MAP每秒变化10-30 kPa
- 加浓量随MAP变化率调整

**增强型加速加浓（EAE）——推荐用于MS2/Extra版本：**
- 采用壁面润湿燃油模型，而非简单的TPSdot/MAPdot计算方法
- 考虑燃油在进气道壁面的吸附和释放现象
- EAE系数控制燃油在壁面上的附着量与进入气缸的量
- 提供比基本加速加浓更平滑的过渡响应
- 通过“加速加浓”设置进行配置；调整延迟补偿和转速/冷却液温度修正

**冷启动乘数：**
- 在冷启动时增加加速加浓量（-20°C时增加1.5-3倍）

## 高级功能

### 增压控制
**开环控制：**
- 负载循环表与目标增压值的关系

**闭环控制（如支持）：**
- 废气门控制的PID参数
- 目标增压值表与转速/挡位的关系

### 发动机制动控制
- 设置发动机制动转速限制（通常为4000-6000 RPM）
- 配置制动期间的点火延迟（0-10° BTDC）
- 设置燃油/点火切断方式

### 平稳换挡/顺序换挡切断
- 换挡过程中保持节气门开度
- 换挡点时短暂切断燃油/点火（100-200ms）
- 保持不同挡位间的增压状态
- 通过“增压/高级设置”进行配置

### 氮气控制系统（MS2/Extra版本）**
- 支持第一阶段和第二阶段氮气喷射系统
- 配置激活条件（转速范围、TPS阈值、冷却液温度最低值）
- 增加燃油量以补偿氮气的额外氧气含量
- 氮气激活期间调整点火正时
- 通过“增压/高级设置”进行配置

### 表格切换
- MS2/Extra版本支持在多个燃油和点火表格之间切换
- 通过输入引脚、CAN信号或其他条件控制切换
- 适用于：比赛用燃油与普通燃油的切换、氮气喷射的开启/关闭、牵引力控制
- 通过“增压/高级设置”进行配置

### 可编程输出
- 配置可编程输出，根据转速、TPS、MAP、冷却液温度等条件触发
- 适用于：风扇、换挡指示灯、警告灯、氮气喷射电磁阀、水/甲醇喷射装置
- 通过“增压/高级设置”进行配置

## 触发器设置与诊断
### 触发器设置/触发器向导
设置触发器模式是调校过程中的第一步，也是最关键的步骤之一：
- 使用“点火设置” → “触发器向导”进行引导式设置
- 选择合适的触发器轮类型（例如36-1、60-2、Ford TFI、GM HEI等）
- 设置触发器角度（触发事件发生的BTDC角度）
- 如果出现失火或同步问题，配置主次转速输入信号的滤波

### 齿轮记录器/复合记录器
这些工具用于验证触发器信号的质量：
- **齿轮记录器**：记录原始齿轮到达时间——用于检查齿轮数量和缺失齿轮的情况
- **复合记录器**：叠加曲轴和凸轮轴信号——用于验证凸轮轴同步和触发器对齐情况
- **同步错误记录器**：捕获同步丢失事件，用于诊断间歇性触发问题
- 通过TunerStudio的“诊断”菜单访问这些工具
- 每次启动前务必运行齿轮记录器，以确保触发器信号正常

## 数据日志分析
### 需要记录的关键参数
| 参数 | 监控内容 |
|-----------|---------------|
| 转速（RPM） | 系统稳定性、转速限制是否被触发 |
| 进气压力（MAP） | 对节气门控制的响应、是否存在泄漏 |
| AFR（宽频） | 与目标值的偏差 |
| EGO修正量 | 应保持在±10%范围内 |
| 冷却液温度（CLT） | 是否达到工作温度 |
| 进气温度（IAT） | 热量吸收效应 |
| 火花提前角 | 是否与表格匹配 |
| 喷射器PWM占空比 | 系统运行是否平稳、最大占空比是否合理 |
| 节气门位置传感器（TPS） | 系统运行是否平稳 |

### 常见问题及解决方法
**怠速时混合气过稀：**
- 增加基于TPS的加速加浓量
- 检查TPSdot的灵敏度

**减速时混合气过浓：**
- 启用减速燃油切断功能（DFCO）
- 设置合适的TPS阈值（通常<10%）
- 设置高于怠速时的转速阈值

**怠速不稳：**
- 检查真空系统是否有泄漏
- 调整怠速PID参数
- 核对点火正时的稳定性

**高负载时出现爆震：**
- 减少受影响喷气器的点火提前角
- 增加混合气浓度（降低目标AFR值）

## TunerStudio特定功能
### 设置保存到ECU闪存
在TunerStudio中修改设置后，这些更改会暂时保存在RAM中，直到您将它们“保存”到ECU的闪存中。如果ECU断电，未保存的更改将会丢失。
- **保存设置**：使用Ctrl+B键或“保存”按钮将当前设置写入闪存
- VE表格、火花提前角表格和AFR表格支持“实时调校”——更改会在RAM中立即生效，但需保存到闪存中才能长期保留
- 闪存最多可保存100,000次保存操作——避免频繁保存

### INI文件
INI文件定义了特定固件版本的TunerStudio界面，包含所有常量、表格、输出通道、菜单和仪表信息。
- INI文件与固件版本不匹配是常见的连接/兼容性问题
- 症状：出现“控制器代码版本与签名不匹配”的错误、菜单缺失或读数混乱
- 解决方法：从msextra.com下载与您的固件版本匹配的INI文件
- 在大多数情况下，TunerStudio可以自动检测并下载正确的INI文件

### 项目设置
1. 创建新项目 → 选择相应的固件版本（MS1、MS2、MS3）——确保使用正确的INI文件
2. 加载基础调校文件（.msq文件）或从默认设置开始
3. 连接至ECU（串行、USB或蓝牙）
4. 与ECU同步以加载当前设置

### 调校界面
- **基本/自定义调校**：浏览和编辑各种表格
- **实时数据**：实时监控系统参数
- **数据日志**：记录和回放调校过程中的数据

### 自动调校
- 启用VEAL（VE实时分析）功能，并使用宽频氧传感器
- 设置可接受的AFR范围
- 遍历尽可能多的参数调整步骤
- 审查并确认更改
- 完成调校后关闭该功能

### 安全限制
**转速限制：**
- 软限制：通过延迟点火正时来控制转速
- 硬限制：在超过目标转速时切断燃油/点火信号
- 设置超过目标压力的保护机制

**过增压保护：**
- 当压力超过目标值时切断燃油供应
- 提供点火切断选项

**混合气过稀时的保护措施：**
- 如果AFR超过安全阈值，关闭相关喷射器
- 通常在负载较高时减少15:1的喷射比例

## 参考资料
有关详细文档，请参阅：
- [references/tunerstudio-reference.md](references/tunerstudio-reference.md) — 完整的TunerStudio文档
- [references/megasquirt-tuning-guide.md](references/megasquirt-tuning-guide.md) — 综合调校指南

## 快速参考公式
**喷射器占空比：**
```
DC% = (Injector PW / Injection Period) × 100
```
为确保安全，建议保持占空比在85%以下。

**所需燃油量：**
当您输入发动机排量、喷射器数量、喷射器流量（cc/min）和喷射分配器后，TunerStudio会自动计算所需燃油量。**请勿手动计算**——在“基本/负载设置” → “发动机参数”中使用固件内置的计算功能。

**根据测量的AFR值调整VE：**
```
New VE = Current VE × (Measured AFR / Target AFR)
```

**气流估算：**
```
MAF (g/s) ≈ (RPM × Displacement × VE% × MAP/100) / (2 × 60 × R × Temp)
```

## 安全检查清单
在启动发动机之前，请确认：
- [ ] 喷射器流量设置正确
- [ ] 通过点火正时灯验证点火正时是否准确
- [ ] 燃油泵已启动并保持压力稳定
- [ ] 无燃油泄漏
- [ ] 宽频氧传感器已预热
- [ ] 紧急燃油/点火切断功能可用

在调校过程中，请注意：
- [ ] 如果有EGT（排气温度）传感器，请监控其数值
- [ ] 注意是否有爆震或爆震声
- [ ] 在参数调整过程中注意AFR的变化
- [ ] 保持VE表格的调整幅度适中
- [ ] 经常保存调校结果，并记录版本信息