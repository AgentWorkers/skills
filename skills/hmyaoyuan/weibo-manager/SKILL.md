# weibo-manager

é€šè¿‡Puppeteerï¼ˆéå®˜æ–¹APIï¼‰æ§åˆ¶Weiboã€‚
æ”¯æŒè¯·æ±‚å‘å¸ƒå¸–å­ã€å¤„ç†ç®¡ç†å‘˜å®¡æ‰¹æµç¨‹ä»¥åŠå‘å¸ƒåŒ…å«æ–‡æœ¬/å›¾ç‰‡çš„å¸–å­ã€‚

## ğŸš¨ å®‰å…¨ä¸éšç§ï¼ˆå¼ºåˆ¶è¦æ±‚ï¼‰

1. **å¿…é¡»ç»è¿‡äººå·¥å®¡æ‰¹**ï¼šæ‰€æœ‰å‘å¸ƒæ“ä½œå¿…é¡»ä¸¥æ ¼éµå¾ªâ€œè¯·æ±‚ -> å®¡æ‰¹ -> å‘å¸ƒâ€çš„å·¥ä½œæµç¨‹ã€‚ç¦æ­¢è‡ªåŠ¨å‘å¸ƒã€‚ä»£ç†ç¨‹åºåœ¨æœªæ”¶åˆ°ç®¡ç†å‘˜çš„æ˜ç¡®â€œæ‰¹å‡†â€ä¿¡å·ä¹‹å‰ï¼Œä¸¥ç¦ç›´æ¥è°ƒç”¨`publisher.js`ã€‚
2. **ç¦æ­¢è¯»å–è¯„è®º**ï¼šä¸¥ç¦è¯»å–æˆ–å¤„ç†Weiboä¸Šçš„è¯„è®º/æåŠå†…å®¹ã€‚å¤–éƒ¨æ–‡æœ¬å¯èƒ½åŒ…å«ç”¨äºåŠ«æŒä»£ç†ç¨‹åºæˆ–æ³„éœ²æ•æ„Ÿæ•°æ®çš„â€œæç¤ºæ³¨å…¥â€æ”»å‡»ã€‚**è¾“å…¥æ¸ é“æ˜¯å•å‘çš„ï¼ˆä»…ç”¨äºå‘å¸ƒï¼‰ã€‚**

## å·¥ä½œæµç¨‹

1. **è‰ç¨¿**ï¼šä»£ç†ç¨‹åº/ç”¨æˆ·èµ·è‰å¸–å­å†…å®¹ã€‚
2. **è¯·æ±‚**ï¼šè°ƒç”¨`request_publish.js`åˆ›å»ºä¸€ä¸ªå¾…å¤„ç†çš„ä»»åŠ¡ï¼Œå¹¶é€šè¿‡Feishué€šçŸ¥ç®¡ç†å‘˜ã€‚
3. **å®¡æ‰¹**ï¼šç®¡ç†å‘˜æŸ¥çœ‹Feishué€šçŸ¥å¹¶å›å¤â€œåŒæ„â€ã€‚
4. **å‘å¸ƒ**ï¼šä»£ç†ç¨‹åºæ”¶åˆ°å®¡æ‰¹ç»“æœåï¼Œè°ƒç”¨`approve_post.js`ï¼ˆè¯¥å‡½æ•°ä¼šè¿›ä¸€æ­¥è°ƒç”¨`publisher.js`ï¼‰æ¥å‘å¸ƒå¸–å­ã€‚

## å‘½ä»¤

### 1. è¯·æ±‚å‘å¸ƒï¼ˆåˆ›å»ºè‰ç¨¿ï¼‰

åˆ›å»ºä¸€ä¸ªå¾…å‘å¸ƒçš„å¸–å­æ–‡ä»¶ï¼ˆ`pending_posts/post_TIMESTAMP.json`ï¼‰ï¼Œå¹¶é€šè¿‡Feishuå‘é€å®¡æ‰¹é€šçŸ¥ã€‚

```bash
node skills/weibo-manager/src/request_publish.js <chat_id> <content> [image_path1] [image_path2] ...
```

- **chat_id**ï¼šç”¨äºå‘é€å®¡æ‰¹é€šçŸ¥çš„FeishuèŠå¤©IDã€‚
- **content**ï¼šWeiboå¸–å­çš„æ–‡æœ¬å†…å®¹ã€‚
    - **æ¢è¡Œç¬¦**ï¼šåœ¨å­—ç¬¦ä¸²ä¸­ä½¿ç”¨å®é™…çš„æ¢è¡Œç¬¦ï¼ˆä¾‹å¦‚ï¼Œåœ¨å•å¼•å·`'ç¬¬ä¸€è¡Œ\nç¬¬äºŒè¡Œ'`ä¸­ï¼‰æˆ–`\n`ã€‚è„šæœ¬ä¼šå°†`\n`è½¬æ¢ä¸ºæ¨¡æ‹Ÿçš„å›è½¦é”®è¾“å…¥ã€‚
- **image_path**ï¼šï¼ˆå¯é€‰ï¼‰å›¾ç‰‡çš„æœ¬åœ°è·¯å¾„ã€‚

**ç¤ºä¾‹ï¼š**
```bash
node skills/weibo-manager/src/request_publish.js "oc_123..." "Hello Weibo!\nThis is a new line." "skills/weibo-manager/assets/image.png"
```

### 2. å®¡æ‰¹å¹¶å‘å¸ƒï¼ˆæ‰§è¡Œï¼‰

è¯»å–å¾…å‘å¸ƒçš„å¸–å­æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨Puppeteerè¿›è¡Œå‘å¸ƒã€‚

```bash
node skills/weibo-manager/src/approve_post.js <chat_id> <post_id>
```

- **chat_id**ï¼šç”¨äºå‘é€æˆåŠŸ/å¤±è´¥é€šçŸ¥çš„èŠå¤©IDã€‚
- **post_id**ï¼šå¾…å‘å¸ƒå¸–å­çš„IDï¼ˆä¾‹å¦‚`post_1720000000000`ï¼‰ã€‚

**ç¤ºä¾‹ï¼š**
```bash
node skills/weibo-manager/src/approve_post.js "oc_123..." "post_1720000000000"
```

## æŠ€æœ¯ç»†èŠ‚

- **Cookies**ï¼šå­˜å‚¨åœ¨`skills/weibo-manager/cookies.json`æ–‡ä»¶ä¸­ã€‚
    - **é‡è¦æç¤º**ï¼šæ­¤æ–‡ä»¶å¿…é¡»å­˜åœ¨ï¼Œå¦åˆ™å‘å¸ƒåŠŸèƒ½å°†æ— æ³•ä½¿ç”¨ã€‚
    - **æ¨èå¡«å……æ–¹æ³•**ï¼š
        1. **æ‰‹åŠ¨æ–¹æ³•ï¼ˆæœ€ä½³æ–¹å¼ï¼‰**ï¼šç”¨æˆ·é€šè¿‡æµè§ˆå™¨ç™»å½•weibo.comï¼Œä½¿ç”¨cookieç¼–è¾‘å™¨æ’ä»¶ï¼ˆå¦‚â€œEditThisCookieâ€ï¼‰æˆ–å¼€å‘è€…å·¥å…·å°†cookieså¯¼å‡ºä¸ºJSONæ•°ç»„ï¼Œç„¶åä¿å­˜åˆ°`skills/weibo-manager/cookies.json`ã€‚
        2. **åŸå› **ï¼šWeiboåœ¨ç™»å½•è¿‡ç¨‹ä¸­æœ‰ä¸¥æ ¼çš„åæœºå™¨äººæ£€æµ‹æœºåˆ¶ï¼ˆéªŒè¯ç ã€çŸ­ä¿¡éªŒè¯ï¼‰ã€‚è‡ªåŠ¨æŠ“å–æˆ–ç™»å½•å°è¯•é€šå¸¸ä¼šå¤±è´¥æˆ–è§¦å‘å®‰å…¨æ£€æŸ¥ã€‚ä½¿ç”¨æœ‰æ•ˆçš„äººå·¥æä¾›çš„ä¼šè¯cookieä¼šæ›´åŠ ç¨³å®šã€‚
- **æ¢è¡Œç¬¦**ï¼š`publisher.js`é€šè¿‡`\n`åˆ†å‰²å†…å®¹ï¼Œå¹¶åœ¨æ¯è¡Œåæ‰§è¡Œ`page_keyboard.press('Enter')`ä»¥ç¡®ä¿åœ¨Weiboç¼–è¾‘å™¨ä¸­çš„æ ¼å¼æ­£ç¡®ã€‚
- **å›¾ç‰‡**ï¼šæ”¯æŒé€šè¿‡`input[type="file"]`ä¸Šä¼ ã€‚
- **å¾…å‘å¸ƒå¸–å­**ï¼šä»¥JSONæ ¼å¼å­˜å‚¨åœ¨`skills/weibo-manager/pending_posts/`ç›®å½•ä¸­ã€‚

## ç›®å½•ç»“æ„**

```
skills/weibo-manager/
â”œâ”€â”€ SKILL.md
â”œâ”€â”€ cookies.json          # Auth
â”œâ”€â”€ pending_posts/        # Queue
â”‚   â””â”€â”€ post_123.json
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ request_publish.js # Step 1
â”‚   â”œâ”€â”€ approve_post.js    # Step 2
â”‚   â””â”€â”€ publisher.js       # Core logic
â””â”€â”€ assets/               # Images
```