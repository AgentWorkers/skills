---
name: writing-skills
description: **使用场景：**  
在创建新技能、编辑现有技能，或在部署前验证技能是否正常工作时使用。
---

# 编写技能

## 概述

**编写技能本质上就是将测试驱动开发（Test-Driven Development, TDD）应用于流程文档的编写。**

**个人技能通常存储在特定代理的目录中（Claude代码使用`~/.claude/skills`，Codex使用`~/.agents/skills/`）。**

你需要编写测试用例（包含子代理的压力测试场景），观察代理在无该技能时的行为（作为基准），然后编写相应的文档，再观察代理在具备该技能后是否能够正确执行任务（确保符合预期），最后对文档进行重构（修复潜在问题）。

**核心原则：** 如果你没有在代理未具备该技能的情况下观察到其错误行为，你就无法确定该文档是否正确地描述了使用该技能的流程。

**必备背景知识：** 在使用这项技能之前，你必须理解测试驱动开发的基本原理。这项技能将TDD的原则应用于文档编写中，包括RED-GREEN-REFACTOR循环（即“红色-绿色-重构”循环）。

**官方指南：** 有关Anthropic官方的技能编写最佳实践，请参考`anthropic-best-practices.md`文档。该文档提供了补充性的模式和指南，进一步细化了基于TDD的技能编写方法。

## 什么是技能？

**技能**是一种关于经过验证的技术、模式或工具的参考指南。它们帮助未来的Claude实例找到并应用有效的方法。

**技能的特点：** 可复用的技术、模式、工具以及参考指南。

**技能不是什么：** 关于你曾经如何解决问题的叙述性文字。

## 技能与测试驱动开发的映射关系

| TDD概念 | 技能创建过程 |
|-------------|----------------|
| **测试用例** | 包含子代理的压力测试场景 |
| **生产代码** | 技能文档（SKILL.md文件） |
| **测试失败（红色状态）** | 代理在未使用该技能时违反规则（基准情况） |
| **测试通过（绿色状态）** | 代理在使用该技能后符合规则 |
| **重构** | 修复漏洞的同时保持合规性 |
| **先编写测试用例** | 在编写文档之前先运行基准测试场景 |
| **观察测试结果** | 记录代理的具体行为逻辑 |
| **编写简洁的代码** | 根据具体的违规情况编写文档 |
| **验证通过情况** | 确认代理现在是否能够正确执行任务 |
| **重构循环** | 发现新的问题 → 修复漏洞 → 重新验证 |

整个技能创建过程遵循RED-GREEN-REFACTOR循环。

## 何时创建技能

**在以下情况下创建技能：**
- 某项技术不是显而易见的；
- 你希望在多个项目中重复使用该技能；
- 该模式具有普遍适用性（而非特定于某个项目）；
- 其他开发者也能从中受益。

**不要创建以下情况的技能：**
- 一次性解决方案；
- 已有其他地方有详细文档的标准实践；
- 项目特定的约定（应记录在`CLAUEDE.md`中）；
- 可以通过正则表达式或验证来强制执行的机械性约束（如果可以自动化处理，就无需编写文档）。

## 技能类型

### 技术型技能
包含具体的操作步骤（例如基于条件的等待、根本原因追踪等）。

### 模式型技能
关于解决问题的思维方式（例如使用标志来简化问题、在测试中保持不变量等）。

### 参考型技能
API文档、语法指南、工具使用说明等。

## 目录结构

**所有技能都存储在一个可搜索的命名空间中。**

**以下内容应单独保存在单独的文件中：**
- **需要大量参考信息的技能**（超过100行，如API文档、详细的语法说明）；
- **可复用的工具**（脚本、实用程序、模板）。

**其他内容可以内联保存：**
- 原则和概念；
- 代码模式（少于50行）；
- 其他所有内容。

## SKILL.md文件的结构

**前置内容（YAML格式）：**
- 仅支持两个字段：`name`和`description`；
- 总长度不超过1024个字符；
- `name`：只能使用字母、数字和连字符（不能使用括号或特殊字符）；
- `description`：使用第三人称进行描述，仅说明**何时使用该技能**（而不是技能的具体功能）；
- 以“Use when...”开头，明确触发条件；
- 包括具体的使用场景和情境；
- **绝对不要总结技能的流程或工作流程**（原因见下文）；
- 如果可能的话，保持描述长度在500个字符以内。

## Claude的搜索优化（CSO）

**对于未来的Claude来说，发现技能非常重要：**

### 1. 丰富的描述字段

**目的：** Claude会根据描述来决定在给定任务中是否需要加载某个技能。描述应该能够回答“我现在应该阅读这个技能吗？”这个问题。

**格式要求：** 以“Use when...”开头，明确触发条件。

**关键点：** 描述应仅说明使用条件，**绝对不要总结技能的流程或工作流程**。

**原因：** 测试表明，如果描述中总结了技能的流程，Claude可能会直接按照描述来执行，而忽略文档内容。例如，如果描述中写的是“在任务之间进行代码审查”，即使文档中的流程图显示需要两个步骤（先检查规范合规性，再检查代码质量），Claude也可能只执行第一步。

**注意事项：** 如果描述中总结了流程，Claude可能会跳过文档内容，直接按照描述来操作。

### 内容要求：
- 使用具体的触发条件、问题症状和适用场景；
- 描述的是问题本身（例如竞态条件、行为不一致等问题），而不是特定语言的实现细节；
- 如果技能是针对特定技术的，应在描述中明确说明；
- 使用第三人称进行描述（这样会融入系统的提示中）；
**绝对不要总结技能的流程或工作流程**。

### 2. 关键词的使用

使用Claude会搜索的词汇：
- 错误信息（如“Hook timed out”、“ENOTEMPTY”、“race condition”等）；
- 症状描述（如“flaky”、“hanging”、“zombie”、“pollution”等）；
- 同义词（如“timeout/hang/freeze”、“cleanup/teardown/afterEach”等）；
- 工具名称、库名、文件类型等。

### 3. 命名规则

**使用主动语态和动词开头：**
- 例如：`creating-skills`而不是`skill-creation`；
- 例如：`condition-based-waiting`而不是`async-test-helpers`。

### 4. 代码效率

**问题：** 需要快速启动或经常被引用的技能会被频繁加载到对话中。每个关键词都很重要。

**目标字数要求：**
- 需要快速启动的技能：每条描述不超过150个单词；
- 经常被加载的技能：总字数不超过200个单词；
- 其他技能：字数不超过500个单词。

**技巧：** 将详细信息放在工具的帮助文档中。

### 5. 使用交叉引用

### 6. 压缩示例

**避免重复已经在其他技能中提到的内容；**
**不要解释从命令中可以直接理解的内容；**
**不要为同一模式提供多个示例。**

### 7. 验证规则

**根据你的行为或核心理念来命名技能：**
- 例如：`condition-based-waiting`而不是`async-test-helpers`；
- 例如：`using-skills`而不是`skill-usage`；
- 例如：`flatten-with-flags`而不是`data-structure-refactoring`；
- 例如：`root-cause-tracing`而不是`debugging-techniques`。

### 8. 其他注意事项**

- 使用动词形式来命名技能（如`creating-skills`、`testing-skills`、`debugging-with-logs`等），这样可以更好地表达动作。

### 9. 引用其他技能

**在引用其他技能时：**
- 仅使用技能名称，并明确说明所需的前提条件：
  - 例如：`**REQUIRED SUB-SKILL:** Use superpowers:test-driven-development`；
  - 例如：`**REQUIRED BACKGROUND:** You MUST understand superpowers:systematic-debugging`；
- **错误示例：** 如`See skills/testing/test-driven-development`（表述不明确）；
- **错误示例：** 如`@skills/testing/test-driven-development/SKILL.md`（会导致不必要的文件加载）。