---
name: capability-graph-mapper
description: 该工具用于映射人工智能代理技能依赖链中的复合权限结构。它首先追踪每个技能单独能够执行的功能，然后计算这些技能组合在一起时所能实现的功能——从而揭示出那些未被明确授权的新兴能力。
version: 1.0.0
metadata:
  openclaw:
    requires:
      bins: [curl, python3]
      env: []
    emoji: "🕸️"
---
# 您的代理拥有12项技能——您知道它们组合起来能做什么吗？

> 该工具有助于梳理技能之间的依赖关系，揭示出任何单一技能都无法体现的潜在风险能力。

## 问题背景

单独来看，各项技能的权限设置似乎都很合理：文件读取技能用于读取文件，HTTP客户端技能用于发送请求，JSON解析技能用于处理数据。每项技能都经过了安全审查。  

但当这三种技能同时被部署在一个代理中时，它们就可能构成一个数据泄露的渠道——读取敏感文件、提取凭证信息并将其发送到外部服务器。然而，没有人批准过这种组合的使用，甚至没有人意识到这种风险的存在。  

在传统软件中，像`npm audit`这样的工具可以分析依赖关系并标记已知的安全漏洞。但在代理系统中，风险并不在于单个依赖项本身，而在于技能组合后所产生的**综合能力**。目前还没有专门用于检测代理系统这种综合风险的工具。  

## 工具功能  

该工具会追踪代理中已安装技能的权限关系：  

1. **权限分析**：提取每项技能的权限信息（如文件访问、网络请求、shell执行、环境变量读取、凭证访问等）  
2. **组合检测**：检查任意两项技能组合后是否会产生新的风险能力（例如：文件读取 + 数据发送 = 数据泄露）  
3. **多级依赖链分析**：追踪多级依赖关系，例如技能A触发技能B，技能B再触发技能C，从而产生在单一步骤中无法察觉的风险  
4. **权限风险评分**：计算代理技能集中存在多少种危险的能力组合  
5. **新增技能影响分析**：当有新技能添加时，显示该技能会为现有技能集带来哪些新的风险  

## 使用方法  

**输入**：  
- 提供代理中已安装的技能名称/别名列表  
- 技能配置文件  
- 需要评估的单一技能  

**输出**：  
- 权限关系图报告，包含：  
  - 权限矩阵（技能 × 能力）  
  - 被标记为高风险的组合能力  
- 权限风险评分（0-100分）  
- 建议：需要手动审查哪些技能组合  
- （针对新添加的技能）提供影响分析报告  

## 示例  

**输入**：评估包含以下技能的代理的权限关系：`log-analyzer`、`http-poster`、`env-reader`、`markdown-formatter`  

```  
🕸️ 权限关系图 — 检测到3个潜在风险  

权限矩阵：  
                    read_files  send_http  read_env  exec_shell  write_files  
  log-analyzer         ✓  
  http-poster                      ✓  
  env-reader           ✓                     ✓  
  markdown-formatter   ✓                                ✓  

**潜在风险组合：**  

  ⚠️ 风险1：数据泄露  
     env-reader（读取.env文件）→ http-poster（发送HTTP请求）  
     组合后：可读取凭证信息并外部传输  
     风险等级：高  

  ⚠️ 敏感文件转发  
     log-analyzer（读取日志）→ http-poster（发送HTTP请求）  
     组合后：可读取应用程序日志并外部传输  
     风险等级：中等  

  ⚠️ 多级依赖链  
     env-reader（读取敏感信息）→ markdown-formatter（处理数据）  
     → http-poster（发送HTTP请求）  
     组合后：可同时实现读取、数据混淆和传输  
     风险等级：高  

**权限风险评分：** 67/100  

**建议：**  
- 审查`http-poster`是否应与`env-reader`共存  
- 限制`env-reader`的文件访问范围  
- 注意`markdown-formatter`与`http-poster`的组合可能导致数据混淆；需审核`markdown-formatter`的输出内容  

## 相关工具  

- **blast-radius-estimator**：用于评估技能被恶意利用后的影响范围  
- **permission-creep-scanner**：检查单个技能是否存在过度授权的问题  
- **supply-chain-poison-detector**：检测被恶意利用的技能；该工具能说明为何具有网络访问权限的恶意技能在同时具备文件读取功能的代理中更具危险性  

## 限制因素  

权限关系图的生成依赖于对技能实际权限的准确分析，但这些权限可能与声明的权限不完全一致。某些在运行时动态请求权限的技能可能无法通过静态分析完全捕捉到。该工具基于已知的风险模式（如读取+发送、解析+执行）来评估风险，但新的攻击链可能不在模式库中。该工具主要用于帮助人类审查潜在风险，并不能保证检测到所有可能的组合情况。权限风险评分仅是相对的评估结果，并非绝对的风险度量标准。