---
name: update-signature-verifier
description: 该功能通过检查每个技能更新版本是否由与原始安装版本相同的密钥签名来帮助验证技能更新的加密完整性。它可以检测到密钥的变化、签名缺失的情况，以及可能表明技能已被篡改或转移的未签名更新。
version: 1.0.0
metadata:
  openclaw:
    requires:
      bins: [curl, python3]
      env: []
    emoji: "✍️"
---
# 未签名更新：一个无人能弥补的信任漏洞

该工具有助于识别技能更新是否破坏了安装时建立的加密保管链，从而发现那些通过合法更新渠道传播的供应链攻击。

## 问题

在安装技能时，通常会验证发布者的签名。但当该技能两个月后更新时，是否有人会检查更新是否仍由相同的密钥签名呢？在大多数代理生态系统中，答案是否定的。安装时的信任验证并不会延伸到更新部分。一个在安装时合法签名的技能，可能会被悄悄转移到新的发布者手中，或者从被入侵的构建流程中更新，甚至被修改而无需重新签名——除非有人仔细追踪每个版本的保管链，否则这一切都难以察觉。

这并非理论上的假设。拥有大量用户的技能会成为攻击的目标。获取这些技能的途径（购买发布者账户或获取更新渠道的访问权限）比直接入侵技能本身更为简单。你对版本1.0的信任并不会自动延伸到版本1.4，因为版本1.4可能是由不同的密钥签名的。

## 该工具的检测内容

该验证工具从五个维度检查更新签名的连续性：

1. **密钥连续性**：每个版本是否都由与原始安装时相同的密钥签名？版本之间的密钥变更是一个需要明确验证的重要信号；虽然合法的密钥轮换确实会发生，但应该会进行公告。
2. **每个版本的签名情况**：每个发布的版本是否都带有签名？还是签名在版本历史中出现了中断？即使当前版本有签名，签名覆盖范围的缺失也是一个危险信号。
3. **签名密钥的来源**：签名密钥是否可以通过JWKS（JSON Web Key Set）端点或密钥透明度日志追溯到发布者的身份？未被注册的密钥（存在但无关联身份）提供的信任保障较弱。
4. **未签名更新的检测**：任何最初未签名但后来被签名的版本都应受到关注——未签名的版本可能就是被修改的版本。
5. **保管链的连续性**：能否从版本1.0一直追溯到当前版本，形成一个完整的签名链？如果保管链存在断裂，其安全性就会受到威胁。

## 使用方法

**输入**：
- 需要审计的技能标识符及其版本历史记录
- 包含版本签名元数据（版本号、签名密钥指纹、签名时间戳）的列表
- 需要比较的两个具体版本

**输出**：
- 一份签名连续性报告，内容包括：
  - 各版本的签名密钥指纹对比结果
  - 密钥变更事件及其时间戳
  - 未签名版本的检测结果
  - 保管链的完整性评级（连续、有间隙、断裂或未签名）
  - 对每个问题或异常情况的建议处理措施

## 示例

**输入**：验证`data-aggregator`技能从1.0.0到1.3.2版本的签名链

```plaintext
✍️ 更新签名验证

技能：data-aggregator
审计版本：1.0.0 → 1.1.0 → 1.2.0 → 1.3.0 → 1.3.1 → 1.3.2
审计时间：2025-04-10T09:15:00Z

版本签名汇总：
  1.0.0：✅ 已签名 — 密钥：ed25519:a3f9c2（发布者：original-dev）
  1.1.0：✅ 已签名 — 密钥：ed25519:a3f9c2（相同密钥，连续）
  1.2.0：⚠️ 未签名 — 无签名字段
  1.3.0：✅ 已签名 — 密钥：ed25519:b7d441（新密钥，与1.1.0不同）
  1.3.1：✅ 已签名 — 密钥：ed25519:b7d441（与1.3.0连续）
  1.3.2：✅ 已签名 — 密钥：ed25519:b7d441（连续）

密钥变更情况：
  1.1.0和1.3.0之间：密钥从ed25519:a3f9c2变为ed25519:b7d441
  此密钥变更与未签名的1.2.0版本同时发生
  密钥变更未在发布者的变更日志中记录
  新密钥的来源未在JWKS端点中注册

未签名版本：
  1.2.0：发布于2025-02-14，无签名
  与1.1.0相比的内容变化：添加了新的外部接口

保管链状况：**断裂**
  原因：
  1. 1.2.0版本未签名
  2. 1.1.0和1.3.0之间密钥发生了变更且未进行公告
  3. 密钥变更发生在添加新外部接口的版本期间
  4. 新签名密钥未在发布者的JWKS中注册

风险评估：**高风险**
  未签名版本引入了新的网络行为，随后密钥变更又未进行公告，这些情况与技能被入侵或转移后由新控制者重新签名的情况相符。

建议措施：
  1. 要求发布者解释1.2.0到1.3.0版本之间的密钥变更原因
  2. 在信任当前版本之前，先审计1.2.0版本中添加的新外部接口
  3. 在确认新密钥的来源之前，将1.3.x版本视为由未经验证的密钥签名的
  4. 考虑将系统锁定在1.1.0版本（最后一个使用有效密钥的版本）上，等待进一步审核
```

## 相关工具

- **skill-update-delta-monitor**：跟踪更新中的行为变化；`update-signature-verifier`用于检查更新是否经过加密授权。
- **attestation-chain-auditor**：验证整个信任链的完整性；`signature-verifier`专门检查发布者与更新之间的签名关系。
- **publisher-identity-verifier**：验证发布者的身份；`signature-verifier`检查更新作者身份是否与发布者身份一致。
- **trust-decay-monitor**：跟踪信任度的随时间变化情况；签名间隙会加速信任度的下降。

## 限制

该工具依赖于每个版本的签名元数据的可用性，但许多当前的技能市场并不提供这些数据。如果版本历史中缺少签名记录，该工具只能检测到元数据的缺失，而无法重建可能的签名信息。密钥变更的检测需要访问历史密钥指纹；如果市场仅存储当前签名密钥，则无法比较之前的版本。即使存在同一密钥的连续签名，也不能保证技能的安全性——因为密钥被入侵的发布者仍可以发布恶意但签名有效的更新。签名连续性只能证明保管链的完整性，而不能证明内容的可靠性。