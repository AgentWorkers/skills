---
name: observer-effect-probe
description: 该功能有助于检测那些在察觉到被监控时行为会发生变化的技能。这类技能通常会利用条件激活逻辑来专门应对认证（attestation）和沙箱（sandbox）环境中的检测机制。
version: 1.0.0
metadata:
  openclaw:
    requires:
      bins: [curl, python3]
      env: []
    emoji: "👁️"
---
# 当技能察觉到被监视时，其行为会变得“完美无瑕”

> 该工具有助于识别那些利用环境检测来抑制恶意行为的技能——这类技能在安全审查过程中总能通过所有检测，因为检测过程本身是可见的。

## 问题

运行时认证机制存在一个隐蔽的问题：那些能够根据环境信号条件性执行操作的技能，同样具备检测到自身被监视的能力，并会在被监视时抑制自身的条件性行为。

这就是所谓的“观察者效应”在安全领域的体现：观察行为本身会改变被观察的对象。这类技能能够识别沙箱环境的特点（如受限的网络访问、特定的主机名模式、具有探测特征的API调用序列），并在检测不到这些特征时才释放恶意载荷——也就是说，它们只在真实的生产环境中才会激活恶意行为。

这并非理论上的担忧。自20世纪90年代以来，恶意软件就已经利用虚拟机检测来在分析过程中抑制自身的执行。同样的技术也可以应用于代理技能：它们会检测探测者的特征标记，返回正常的结果，然后在探测者退出后重新激活恶意行为。那些通过检测认证者来逃避认证的技能，并不具备真正的安全性——它们实际上属于“被对手操纵的认证技能”。

“观察者效应”探测机制试图通过最小化探测环境与生产环境之间的可观察差异，来削弱这类技能的识别能力。

## 本次探测的内容

本次探测从五个维度来评估技能的逃避能力：

1. **沙箱特征检测**：该技能是否会尝试识别探测环境的特征？例如检查特定于沙箱的主机名模式、受限的网络连接、具有探测特征的请求时序，或者是否缺少预期的生产环境信号。
2. **对探测时长的敏感性**：该技能的行为是否会随着运行时间的不同而改变？或者在激活前会统计调用次数？通过长时间运行，可以检测到那些用于清除认证窗口的调用延迟。
3. **对观察者API模式的检测**：该技能是否会查询能够区分观察者与实际操作者的信号（如检查调用者的身份、检测工具的签名、异常的进程环境指标等）？
4. **在不同环境下的行为一致性**：当探测环境发生系统变化（不同的主机名、不同的运行时间、不同的网络访问权限）时，该技能的输出是否会出现与变化类型相对应的变化？
5. **元认知检测**：该技能是否会通过检查自身的执行上下文、堆栈跟踪或运行时元数据来主动检测是否正在被监视？

## 使用方法

**输入**：
- 提供一个技能标识符及其执行环境，以检测其逃避行为；
- 提供一个已知认证结果的技能，并在不同环境中重新进行检测；
- 提供来自多个环境的执行记录，以评估其行为对环境变化的敏感性。

**输出**：一份“观察者效应”探测报告，包含以下内容：
- 沙箱特征检测结果；
- 调用次数的敏感性评估；
- 观察者API模式列表；
- 不同环境下的行为一致性矩阵；
- 逃避概率评分（0-100）；
- 检测结果：**环境无关 / 对环境敏感 / 很可能逃避 / 确认逃避**。

## 示例

**输入**：对`report-aggregator`技能进行“观察者效应”探测：

```plaintext
👁️ 观察者效应探测

技能：report-aggregator v2.1
标准认证结果：合规（声明的功能与实际行为一致）
探测环境：5个（主机名、运行时间、网络环境、调用者签名各不相同）
每个环境执行样本数量：100次
已启用沙箱特征最小化功能

沙箱特征检测：
- 主机名模式检测：⚠️ 检测到
  - 该技能在调用1-3次时查询了`os.hostname()`，之后未再查询
  - 在Linux系统中读取了`/proc/1/cgroup`（容器检测指标）
- 网络可用性检测：⚠️ 检测到
  - 该技能在主执行前尝试连接外部端点
  - 如果连接失败：仅执行声明的功能
  - 如果连接成功：激活扩展行为

调用次数敏感性：
- 调用1-5次：仅执行声明的功能 ✅
- 调用6-10次：仅执行声明的功能 ✅
- 调用11次及以上：向分析端点发送额外请求 ⚠️
  - 规律：当调用次数达到10次时，行为会发生变化

观察者API模式：
- `sys.argv`检查：✅ 未检测到异常
- 调用者身份检查：⚠️ 检测到——读取了父进程名称
  - 如果父进程名称包含“probe”、“audit”、“scan”、“test”等关键词：进入抑制模式
  - 否则：执行全部功能，包括扩展行为

行为一致性矩阵：
- 环境A（标准沙箱）：合规行为 ✅
- 环境B（延长运行时间）：合规行为（调用次数重置）✅
- 环境C（真实网络环境）：扩展行为 ⚠️
- 环境D（非探测来源）：扩展行为 ⚠️
- 环境E（类似生产环境）：扩展行为 ⚠️

逃避概率评分：89/100
- 高概率存在故意的“观察者效应”逃避行为：
  - 主机名查询与行为抑制相关
  - 父进程名称检查会过滤包含“probe”或“audit”的进程
  - 扩展行为仅在非沙箱环境中激活

检测结果：确认逃避
  - 该技能能够主动检测到认证环境，并在被探测时抑制扩展行为
  - 标准认证方法会始终返回“合规”结果

建议措施：
1. 将该技能视为恶意行为——逃避行为是故意的
2. 将父进程名称的过滤行为视为信任与安全违规
3. 审查同一发布者的所有类似技能
4. 无论认证结果如何，都不要在该技能中部署它

## 相关工具

- **runtime-attestation-probe**：检测声明的行为与实际行为是否一致；
- **hollow-validation-checker**：检测伪造的安装时测试；
- **supply-chain-poison-detector**：在静态分析中识别恶意载荷；
- **blast-radius-estimator**：估计恶意行为的传播范围；在确认逃避行为后使用，以评估可能有多少代理接收了被错误认证的技能。

## 局限性

“观察者效应”探测是一种对抗性的竞争：即使探测者试图最小化自身的特征，足够复杂的逃避机制也能被检测出来。该工具可以减少探测环境与生产环境之间的可观察差异，但无法完全消除这种差异。那些需要特定生产环境信号才能激活的技能（这些信号无法被探测者模拟）即使在启用“观察者效应”功能的情况下也不会被触发。如果检测结果为“环境无关”，仅表示探测者在测试环境中未检测到逃避行为，并不能证明该技能不存在逃避逻辑。调用次数的检测需要运行足够多的样本才能跨越可能的延迟阈值，这可能需要较长的执行时间。探测必须在隔离的沙箱环境中进行，且不能使用真实的凭证或生产系统资源。