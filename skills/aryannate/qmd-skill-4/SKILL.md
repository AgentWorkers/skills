---
name: qmd
description: 本地混合搜索功能，适用于Markdown笔记和文档的查询。该功能可用于搜索笔记、查找相关内容，或从已索引的集合中检索文档。
homepage: https://github.com/tobi/qmd
metadata: {"clawdbot":{"emoji":"🔍","os":["darwin","linux"],"requires":{"bins":["qmd"]},"install":[{"id":"bun-qmd","kind":"shell","command":"bun install -g https://github.com/tobi/qmd","bins":["qmd"],"label":"Install qmd via Bun"}]}}
---

# qmd - 快速 Markdown 搜索工具

这是一个用于搜索 Markdown 笔记、文档和知识库的本地搜索引擎。只需进行一次索引，即可实现快速搜索。

## 使用场景（触发短语）  
- “搜索我的笔记/文档/知识库”  
- “查找相关笔记”  
- “从我的收藏中检索 Markdown 文档”  
- “搜索本地的 Markdown 文件”  

## 默认行为（重要说明）  
- 首选 `qmd search`（基于 BM25 算法的快速搜索）；通常响应迅速，应作为默认选项。  
- 仅在关键词搜索失败且需要语义相似性时使用 `qmd vsearch`（初次运行时可能较慢）。  
- 除非用户明确要求最高质量的混合搜索结果并能够接受较长的运行时间/超时，否则避免使用 `qmd query`。  

## 先决条件  
- 确保已安装 Bun >= 1.0.0。  
- 在 macOS 上，需要通过 `brew install sqlite` 安装 SQLite 扩展。  
- 确保系统路径中包含 `$HOME/.bun/bin`。  

**在 macOS 上安装 Bun：**  
`brew install oven-sh/bun/bun`  

## 安装方法  
`bun install -g https://github.com/tobi/qmd`  

## 设置方法  
（具体设置步骤请参考相关文档或代码块。）  

## 支持的索引类型  
- 主要用于 Markdown 文件的索引（通常为 `**/*.md` 格式）。  
- 在测试中，格式较为“混乱”的 Markdown 文件也能被正确处理；索引过程基于内容划分（每个索引块包含大约几百个字符），而非严格的标题/结构。  
- 该工具不能替代代码搜索工具，代码搜索适用于代码仓库或源代码树的搜索。  

## 搜索模式  
- **`qmd search`**（默认模式）：基于关键词的快速匹配（使用 BM25 算法）。  
- **`qmd vsearch`**（备用模式）：基于语义相似性的搜索（使用向量模型）。由于在查询前需要执行局部语言模型（LLM）的计算，因此可能较慢。  
- **`qmd query`**（较少使用）：结合语义搜索和 LLM 重新排序结果的混合搜索方式；通常比 `vsearch` 更慢，且可能超时。  

## 性能说明  
- **`qmd search`** 通常响应迅速。  
- **`qmd vsearch`** 在某些设备上可能需要约 1 分钟的时间，因为查询过程可能需要将本地模型（如 Qwen3-1.7B）加载到内存中；不过向量查找本身通常很快。  
- **`qmd query`** 会在 `vsearch` 的基础上添加 LLM 重新排序步骤，因此可能更慢且可靠性较低（不适用于交互式使用）。  
- 如果需要频繁进行语义搜索，可以考虑保持相关进程/模型的运行状态（例如，在系统中启用长时间运行的 qmd/MCP 服务），以避免每次都重新启动 LLM。  

## 常用命令  
（具体命令请参考相关文档或代码块。）  

## 有用的选项  
- `-n <num>`：限制返回结果的数量。  
- `-c, --collection <name>`：仅搜索指定集合内的内容。  
- `--all --min-score <num>`：返回得分高于指定阈值的所有匹配项。  
- `--json` / `--files`：输出格式适合代理程序使用。  
- `--full`：返回完整的文档内容。  

## 文档检索方法  
（具体检索逻辑请参考相关文档或代码块。）  

## 维护说明  
（具体维护步骤请参考相关文档或代码块。）  

## 保持索引更新  
为了确保搜索结果始终是最新的，请定期执行索引操作：  
- 对于基于关键词的搜索（`qmd search`），通常只需执行 `qmd update` 即可。  
- 如果使用基于语义/混合搜索的选项（`vsearch`/`query`），还可以使用 `qmd embed` 命令，但该命令可能较慢。  

**示例调度脚本（cron 语法）：**  
（具体调度脚本请参考相关文档或代码块。）  

**注意事项：**  
如果你的 Clawdbot/代理环境支持内置调度器，可以直接在该环境中运行相应的命令，无需依赖系统 cron。  

## 模型与缓存机制  
- 该工具使用本地的 GGUF 模型；首次运行时会自动下载这些模型。  
- 默认缓存路径为 `~/.cache/qmd/models/`（可通过 `XDG_CACHE_HOME` 配置自定义）。  

**与 Clawdbot 的关系**  
- `qmd` 用于搜索你手动添加到集合中的本地 Markdown 文件。  
- Clawdbot 的 `memory_search` 用于搜索代理程序内存中保存的信息/上下文。  
- 可以同时使用这两种工具：`memory_search` 用于查询“我们之前做了什么/学到了什么？”，`qmd` 用于查询“磁盘上的笔记/文档内容”。