---
name: Loop
slug: loop
version: 1.0.2
description: 运行迭代代理循环，直到满足成功标准。实现受控的自主迭代过程。
changelog: Fixed internal contradiction about Git commits in memory.md
metadata: {"clawdbot":{"emoji":"🔄","requires":{"bins":[]},"os":["linux","darwin","win32"]}}
---
## 数据存储

```
~/loop/
├── active.json         # Currently running loops
├── history/            # Completed loop logs
│   └── {loop-id}.json
└── learnings.md        # Cross-loop patterns
```

**首次使用时执行操作：** `mkdir -p ~/loop/history`  

## 使用范围  

此技能适用于：  
- ✅ 根据定义的成功标准进行多次迭代尝试  
- ✅ 记录每次迭代的过程及所获得的经验教训  
- ✅ 在成功、达到最大迭代次数或出现无法恢复的错误时终止流程  
- ❌ 绝不自动提交到 Git  
- ❌ 绝不部署到生产环境  
- ❌ 绝不修改系统配置  
- ❌ 绝不无限期运行（最大迭代次数为 10 次）  

## 快速参考  

| 主题 | 文件 |  
|-------|------|  
| 循环示例 | `examples.md` |  
| 迭代之间的内存使用情况 | `memory.md` |  

## 核心规则  

### 1. 迭代模式  
```
Task + Criteria → Execute → Verify → [Pass? Exit : Retry]
```  

### 2. 必需的设置  
| 元素 | 是否必需 | 示例 |  
|---------|----------|---------|  
| 任务 | 是 | “修复失败的测试” |  
| 成功标准 | 是 | “所有测试都通过” |  
| 最大迭代次数 | 默认：5 次 | 最大：10 次 |  
| 验证命令 | 推荐使用 | `npm test` |  

### 3. 何时提出迭代建议  
- 任务有明确的成功标准，但实现路径尚不确定  
- 上一次尝试失败，但错误是可以修复的  
- 用户要求“持续尝试直到……”  

**不适用场景：**  
- 一次性任务  
- 目标不明确的情况  
- 探索性工作  

### 4. 每次迭代  
1. **保持新鲜的环境**：仅携带任务、成功标准、当前迭代次数及经验教训  
2. **执行任务**：尝试完成该任务  
3. **验证结果**：检查是否达到成功标准  
4. **记录结果**：将执行过程及失败原因添加到历史记录中  
5. **做出决策**：如果达到成功标准，则终止迭代；如果失败，则在未超过最大迭代次数的前提下重试  

### 5. 停止条件  
- ✅ 达到成功标准  
- ❌ 达到最大迭代次数  
- ⚠️ 出现无法恢复的错误（如缺少依赖项、权限被拒绝等）  

### 6. 失败处理  
- 如果达到最大迭代次数仍未成功：  
  - 总结所有尝试的过程  
  - 分析常见的失败原因  
  - 建议手动干预或尝试其他方法  

### 7. 安全性  
- 最大迭代次数限制为 10 次  
- 未经明确批准，严禁执行任何可能破坏系统的数据操作  
- 将所有操作记录到 `~/loop/history/` 目录中