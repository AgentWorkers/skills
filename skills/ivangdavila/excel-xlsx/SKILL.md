---
name: XLSX
description: 能够读取并生成格式正确的Excel文件，确保日期格式准确无误，并具备跨平台兼容性。
metadata: {"clawdbot":{"emoji":"📗","os":["linux","darwin","win32"]}}
---

## 日期

- Excel中的日期实际上是序列号，表示从1900年1月1日（Windows系统）或1904年1月1日（Mac旧版本）开始的天数。
- 1900年闰年问题：Excel错误地将1900年视为闰年，导致序列号为60的日期实际上是1900年2月29日（这是无效的日期）。
- 仅凭数值无法区分日期和普通数字——必须检查单元格的格式。
- 时间值是以小数形式表示的：0.5表示中午12点，0.25表示下午6点。

## 数字

- Excel对数字的精度限制为15位；超过这个限制的数字会自动被截断。对于ID或电话号码等特殊用途，应使用文本格式。
- 数字前面的零会被自动去除；可以选择将数字格式化为“00000”等形式。
- 科学计数法（如`1E10`）会自动转换为数值；如果需要保留文字形式，则需要加上引号。
- 货币或百分比数据虽然以数字形式存储，但其显示格式只是为了美观，实际数值可能与存储形式不同。

## 文本与编码

- 共享字符串表会只存储一次相同的文本内容，从而避免重复存储；大型文件会通过索引来高效引用这些文本。
- 每个单元格的最大字符数为32,767个。
- 单元格中的换行符使用`\n`，但需要将单元格设置为“自动换行”格式才能正确显示换行内容。
- XLSX格式完全支持Unicode编码，但旧版本的XLS存在编码问题。

## 结构

- 单元的行数上限为1,048,576行，列数上限为16,384列（XFD格式）；XLS格式的行数和列数上限分别为65,536行×256列。
- 合并的单元格中只有左上角的单元格包含实际数据，其他合并单元格显示为空值。
- 被隐藏的行或列仍然包含数据，不要误以为隐藏的单元格就不存在数据。
- 工作表名称最多可以包含31个字符，禁止使用`\`、`/`、`?`、`*`、`[`等特殊字符。

## 公式

- 单元格中可以同时包含公式和公式计算的结果；不同的Excel版本可能返回不同的结果（公式或缓存的结果）。
- 公式在打开工作表时会重新计算；如果需要使用最新的计算结果，可以强制重新计算或直接读取公式内容。
- 数组公式（CSE/Dynamic数组公式）在不同版本的Excel中的行为可能有所不同。
- 外部引用（如`[Book.xlsx]Sheet!A1`）在文件移动后可能会失效。

## 跨平台兼容性

- Windows版和Mac版Excel的日期系统可能不同（1900年作为闰年的规则不同），请检查工作簿的设置。
- LibreOffice和Google Sheets可能不支持某些Excel的功能，请进行测试以确保数据能够正确传输。
- XLSM格式包含宏，存在安全风险；XLSB格式是二进制格式，虽然读取速度更快，但兼容性较差。
- 文件的密码保护很容易被破解，因此不建议依赖密码保护；建议对文件进行外部加密。

## 常见的问题和库相关注意事项

- 文件末尾可能存在空白行，某些写入工具会自动填充这些空白行；在读取数据时需要将这些空白行去除。
- 在读取数据时，系统可能会尝试自动推断数据的类型；如果数据原本是数字，应明确进行类型转换。
- 大型文件加载到内存中可能会占用大量内存，建议使用流式读取器来处理这类文件。
- 单元格中的字母索引（A=0还是A=1）因库的不同而有所差异，使用前请确认具体的约定。