---
name: shelter
description: 连接您的Shelter财务数据：查看可安全使用的资金、预测资金短缺情况、识别无效的订阅服务、模拟购买行为、获取AI建议，并向Guardian AI咨询有关财务的问题。您还可以通过Plaid以只读方式访问真实的银行数据。
version: 1.0.0
metadata:
  openclaw:
    emoji: "\U0001F6E1"
    requires:
      env: [SHELTER_API_KEY]
      bins: [curl]
    primaryEnv: SHELTER_API_KEY
    homepage: https://shelter.money
---
# 财务管理工具：Shelter

您可以通过Agent API连接到用户的财务数据。所有接口返回的格式均为JSON。作为财务顾问，您的职责是解读这些数据，而不仅仅是简单地呈现它们。

## 认证

每个请求都需要以下两个信息：

- **请求头**：`X-Shelter-Key: $SHELTER_API_KEY`
- **基础URL**：`$SHELTER_API_URL`（默认值：`https://api.shelter.money/agent`）

以下所有示例都使用了这些变量。在发起任何请求之前，请确保它们已经设置正确。

## 决策树

使用以下规则来选择适合用户问题的接口：

| 用户想要了解的信息 | 接口 | 成本 |
|------------------------|----------|------|
| “我的财务状况如何？” / “我今天可以消费吗？” | `GET /v1/status` | 低成本 |
| “我的钱什么时候会用完？” | `GET /v1/runway` | 低成本 |
| “下周的情况如何？” | `GET /v1/forecast` | 中等成本 |
| “有哪些我需要知道的问题？” | `GET /v1/alerts` | 中等成本 |
| “我在哪里浪费钱？” | `GET /v1/opportunities` | 中等成本 |
| “给我一个全面的财务概况” | `GET /v1/context` | 中等成本 |
| “我负担得起X吗？” | `POST /v1/affordability` | 中等成本 |
| “给我今天的财务建议” | `GET /v1/coach/daily` | 中等成本 |
| “帮助我处理[债务/储蓄/账单]” | `GET /v1/coach/advice?topic=` | 中等成本 |
| 复杂或细致的问题 | `POST /v1/ask` | 高成本 |

**始终从成本最低的接口开始尝试，直到找到合适的答案。**只有在结构化的接口无法解决问题时，才使用 `/v1/ask`。

---

## 接口详情

### 快速查询

这些接口响应快速、数据缓存且成本低廉。建议优先使用它们。

#### GET /v1/status

提供用户当前的财务状况概览。

**使用场景**：用户询问自己的财务状况、需要确认是否可以安全消费，或在提供详细建议前进行快速检查。

**不适用场景**：用户需要多日财务预测或详细的数据分析。

**关键响应字段**：
- `safeToSpend`：扣除即将发生的支出后剩余的可支配金额
- `safeDays`：以当前消费速度计算出的资金可使用天数
- `stressLevel`：`低` | `中等` | `高` | `危急`
- `upcomingIncome`：`{ 金额, 日期, 来源 }` 或 `null`
- `nextCommitment`：`{ 名称, 金额, 到期日期 }` 或 `null`
- `confidence`：0-100的数据质量评分
- `explanation`：易于理解的文字说明

**总结方式**：首先说明用户是否可以安全消费以及当前的财务压力水平。如果下次收入在3天内到来，请一并提及。如果数据可信度低于50%，请标注为“数据有限”。

---

#### GET /v1/runway

计算用户资金耗尽的时间。

**使用场景**：用户询问资金还能使用多久、当前的消费速度或何时会破产。

**不适用场景**：用户需要每日详细的消费记录（请使用 `/v1/forecast`）。

**关键响应字段**：
- `safeDays`：剩余的资金可使用天数
- `burnRate`：过去30天的平均每日支出
- `breathingRoom`：扣除支出后的缓冲天数
- `nextCrunchDate`：余额变为负数的日期（或 `null`
- `nextCrunchAmount`：即将到期的支出金额
- `daysUntilCrunch`：距离资金耗尽的天数（或 `null`
- `explanation`：易于理解的文字说明

**总结方式**：说明剩余的资金可使用天数和每日平均支出。如果即将出现资金紧张的情况，请告知具体日期和金额。如果没有资金紧张的问题，请让用户放心。

---

### 深度分析

这些接口提供更详细的财务信息。在快速查询无法满足需求时使用。

#### GET /v1/forecast

提供14天的每日财务预测。

**使用场景**：用户询问下周或未来两周的财务状况，或想知道特定账单的支付时间。

**不适用场景**：用户只需要今天的财务状况概览（请使用 `/v1/status`）。

**关键响应字段**：
- `forecast[]`：每日财务预测数组：`{ 日期, 预计余额, 事件列表, 是否处于资金紧张状态 }`
- `summary`：`{ 资金紧张天数, 紧张天数, 最低余额, 最高余额 }`

**总结方式**：首先强调可能出现资金紧张的日期和金额。同时列出最低余额以及产生该余额的具体事件（如大额支出）。

---

#### GET /v1/alerts

显示当前的警告信息，包括无效订阅、消费异常或即将到期的账单。

**使用场景**：用户需要了解需要关注的问题，或者您希望主动发现潜在问题。

**不适用场景**：用户已经针对特定问题寻求建议（请使用 `/v1/coach/advice?topic=`）。

**关键响应字段**：
- `alerts[]`：`{ 编号, 类型, 严重程度, 标题, 描述, 预计影响金额, 剩余天数 }`
- `count`：警告总数
- `hasCritical`：布尔值，表示警告的紧急程度

**总结方式**：先列出最紧急的警告，再依次展示其他警告。具体说明金额和日期。如果存在紧急警告，请特别强调。

---

#### GET /v1/opportunities

指出用户可能在哪些方面浪费资金或有机会节省开支。

**使用场景**：用户询问如何节省开支、处理无效订阅或优化消费习惯。

**不适用场景**：用户需要财务预测或财务状况概览（请使用 `/v1/status` 或 `/v1/forecast`）。

**关键响应字段**：
- `opportunities[]`：`{ 编号, 类型, 标题, 描述, 预计节省金额, 实施难度, 操作链接 }`
- `totalPotentialSavings`：如果所有建议都得到执行，可节省的年度总金额

**总结方式**：首先说明预计的总节省金额。按难度从低到高列出节省机会，并提供相应的操作链接（如果有的话）。

---

#### GET /v1/context

提供包含财务状况概览、警告信息、消费分析及未来事件的全面财务报告。

**使用场景**：用户需要整体了解财务状况，或者您需要综合信息来回答复杂问题。

**不适用场景**：如果有更具体的接口可以满足需求，无需使用此接口。此接口提供的信息较为全面。

**关键响应字段**：
- `snapshot`：`{ 可用余额, 剩余缓冲天数, 未来收入, 即将发生的支出 }`
- `highlights`：`{ 紧急行动, 最大的节省机会, 最近的财务改善 }`
- `alerts[]`：与 `/v1/alerts` 接口的格式相同
- `spendingInsights`：`{ 消费分析总结, 按类别分类, 主要支出来源, 异常情况 }`
- `upcomingEvents[]`：`{ 类型, 名称, 金额, 预计发生时间, 优先级 }`

**总结方式**：首先说明可用余额和剩余的缓冲天数。重点介绍紧急行动和最近的财务改善情况。只有在用户询问时，再详细分析消费习惯。

---

#### POST /v1/affordability

模拟用户是否能够负担特定的消费。

**使用场景**：用户询问是否能够负担某个具体金额的支出。

**不适用场景**：用户只是想了解一般的消费情况（请使用 `/v1/status`）。

**关键响应字段**：
- `canAfford`：布尔值，表示用户是否负担得起
- `safeToSpendAfter`：购买后剩余的可支配金额
- `impactOnRunway`：购买后资金可使用天数的减少量
- `recommendation`：AI生成的节省建议
- `confidence`：0-100的信任度评分

**总结方式**：首先明确回答用户是否负担得起，然后解释该消费对资金使用和剩余余额的影响。

---

### 财务建议

根据用户的财务状况生成AI建议。

#### GET /v1/coach/daily

今天的个性化财务建议。

**使用场景**：会话开始时，或用户请求每日财务更新。

**关键响应字段**：
- `messageType`：`daily_checkin` | `alert` | `celebration` | `suggestion` | `warning`
- `headline`：简短的标题
- `body`：包含具体数字的2-4句话建议
- `actions[]`：`{ 动作标签, 动作类型, 目标 }`
- `tone`：鼓励性、紧急性或支持性的语气

**总结方式**：自然地呈现标题和建议内容。根据语气选择合适的表达方式。

---

#### GET /v1/coach/advice?topic=

针对特定财务问题提供深入的财务建议。

**使用场景**：用户请求针对某个具体财务问题的帮助。

**可用主题**：`债务`、`储蓄`、`账单`、`订阅`、`谈判`、`一般财务建议`

**响应格式**：与每日建议相同（包含标题、建议内容、具体行动和语气）。

**总结方式**：自然地呈现建议内容。如果用户未指定具体主题，可以询问他们需要帮助的领域，或者默认建议为“一般财务建议”。

---

### Guardian AI 聊天

**POST /v1/ask**

向Guardian AI提出关于用户财务状况的开放式问题。这是成本最高的接口，仅在结构化接口无法解决问题时使用。

**使用场景**：需要复杂分析或规划建议的情况。

**不适用场景**：上述结构化接口已经可以回答用户的问题。请优先尝试这些接口。

**关键响应字段**：
- `response`：Guardian AI的文字回答
- `confidence`：0-100的信任度评分
- `relatedAlerts[]`：相关警告的编号
- `limitRemaining`：当天剩余的提问次数

**总结方式**：直接呈现Guardian AI的回答。如果信任度评分低于50%，请说明答案的不确定性。如果当天剩余的提问次数较少，也请告知用户。

## 使用限制

| 接口组 | 免费 tier | 高级 tier |
|----------------|-----------|--------------|
| 状态、资金预测、警报、节省机会、财务概况、负担能力分析 | 60次/小时 | 60次/小时 |
| 财务建议（每日建议） | 60次/小时 | 60次/小时 |
| 向Guardian AI提问 | 5次/天 | 100次/天 |

## 错误代码

| 代码 | 含义 | 处理方式 |
|------|---------|------------|
| 401 | API密钥无效或缺失 | 确保`SHELTER_API_KEY`已设置且有效 |
| 403 | 密钥权限不足 | 用户需要在shelter.money网站上更新权限 |
| 429 | 超过使用限制 | 等待片刻后重试。请检查`Retry-After`请求头信息 |
| 500 | 服务器错误 | 稍后重试 |

如果收到401错误，请提示用户检查他们的API密钥。切勿重复尝试认证操作。

## 设置步骤

1. 在[shelter.money](https://shelter.money)注册账户。
2. 通过Plaid连接银行账户（大约需要60秒）。
3. 在[shelter.money/settings/api-keys](https://shelter.money/settings/api-keys)创建Agent API密钥。
4. 设置环境变量：
   ```bash
   export SHELTER_API_KEY="wv_your_key_here"
   ```
5. 测试连接是否正常：
   ```bash
   curl -s -H "X-Shelter-Key: $SHELTER_API_KEY" \
     "${SHELTER_API_URL:-https://api.shelter.money/agent}/v1/status"
   ```

## 安全性

- **只读权限**：Shelter工具可以查看交易记录和余额，但无法直接操作资金。
- **权限控制**：您可以精确指定密钥的访问范围。
- **不存储原始银行数据**：API返回的是经过处理的分析结果（如可支配金额、警告信息），而非原始交易数据。
- **密钥加密**：密钥信息以加密形式存储，绝不会以明文形式保存。
- **审计记录**：所有API请求都会被记录。
- **即时撤销权限**：您可以在设置中随时禁用某个密钥。

## 数据参考

有关所有响应字段的详细信息，请参阅[`references/DATA_MODEL.md`](references/DATA_MODEL.md)。