---
name: vocabulary-builder
description: 从书籍、播客以及日常交流中构建和整理词汇。当用户想要阅读书籍、分享新词汇、在阅读过程中询问某个单词的含义、请求进行词汇测验、询问词汇学习进度时，或者当定时任务（cron/heartbeat）触发预定的测验时，该系统都能提供相应的支持。该系统负责管理用户的阅读会话、词汇收集过程、三步学习法（包括理解、记忆和应用三个阶段）、间隔重复练习以及学习进度的跟踪。
metadata: {"files": {"vocabFile": "memory/vocabulary.md", "audioDir": "docs/tts-fr"}}
---

# 词汇构建工具

该工具可以读取和写入以下文件（路径相对于工作区）：
- **词汇跟踪器：** `memory/vocabulary.md` — 所有单词数据都存储在这里
- **音频文件目录：** `docs/tts-fr/` — 只读；用户可以将发音音频文件保存在这里

请确保这些路径存在，或在首次使用前创建它们。

## 阅读流程

当用户想要阅读或练习阅读一本书时：
1. 询问他们正在阅读哪本书。
2. 在词汇跟踪器中查找该书中的单词——阅读“活跃单词”（Active Words）部分的末尾（使用 `tail` 命令或查看最后的条目）以确定最后一个单词。注意：`memory_search` 可能会返回部分或排序后的结果，因此在检查最新条目时也需要直接读取文件。
3. 告诉用户最后一个添加的单词及其所在的页码，以便他们知道从哪里继续阅读。
4. 询问用户是想要练习尚未掌握的单词，还是继续阅读并添加新的单词。

## 添加新单词

当用户提供一个新的单词时：
1. 提供单词的**发音**（国际音标，美式英语）。
2. 提供单词的**含义**——要简洁明了。
3. 提供**同义词**——用户可能知道的相似单词。
4. 在得到用户确认后，将单词添加到跟踪器中（例如：“将 [单词] 添加到您的词汇表中——可以吗？”）
5. 添加单词后，显示该单词的详细信息。

新单词应添加到“活跃单词”部分的末尾（`---` 分隔符之前）。

### 单词条目格式

```markdown
### [word]
- **Type:** noun/verb/adj/adv
- **Learned:** YYYY-MM-DD HH:MM TZ
- **Book:** [source name]
- **Page:** [number]
- **Pronunciation:** /IPA/
- **Meaning:** [explanation]
- **Synonyms:** [similar words]
- **Context:** "[sentence from source]"
- **Practice History:**
  - YYYY-MM-DD HH:MM TZ: Step N ✓/✗ (notes)
```

### 法语单词

- **上下文：** 仅提供法语句子。
- **中文翻译：** 使用单独的字段记录中文翻译。
- 不要在同一个字段中混合法语和中文内容。
- 用户将音频文件保存在 `docs/tts-fr/` 目录中——请在“音频”（Audio）字段中填写文件路径。

## 三步学习流程

这三个步骤应在一次对话中完成（不要分散在几个小时内进行）：
- **步骤1：** 显示单词 → 询问“你知道这个单词的发音吗？” → 用户输入单词进行确认。
- **步骤2：** 询问“这个词的意思是什么？” → 检查用户的回答是否正确或接近正确。
- **步骤3：** 要求用户用这个单词造一个句子。

发音的确认依赖于用户的输入，不使用语音识别或自动语音识别（ASR）技术。

## 定期复习计划

完成所有三个步骤后，按照以下时间表进行复习：
- 第二天 → 第三天 → 第一周 → 第二周 → 第一个月 → 第三个月
- 完成三个月的复习后，该单词即被视为“掌握”。

### 单词进度

单词在跟踪器中会经历三个阶段：
1. **活跃单词** — 当前正在学习的单词。
2. **长期复习单词** — 完成了所有步骤的单词，需要定期复习。
3. **掌握的单词** — 经过三个月的复习。

## 测验规则
- **每次测验只包含一个单词** — 不允许连续快速回答多个单词。
- **避免发送重复的测验**：如果用户今天没有回答之前的测验，则不发送新的测验。
- **次日重置**：新的一天可以发送新的测验，即使昨天的测验没有回答。
- **休息时间：** 从晚上11点到早上7点（用户所在时区）不发送消息。
- **优先级**：需要复习的单词 > 新学的单词（尚未完成步骤的单词） > 复习单词。

### 随机选词

统计用户未练习过的单词数量（N），使用当前的 Unix 时间戳计算：
`(timestamp % N) + 1` = 随机选择的单词的索引。

### 按需测验

用户可以随时请求特定的测验：
- “给我出个测验” → 随机选择一个单词。
- “就 [单词] 给我出个测验” → 选择特定的单词。
- “就 [书] 中的单词给我出个测验” → 从该书中随机选择一个单词。
- “就本周的单词给我出个测验” → 从过去7天内随机选择一个单词。
- “就 [书] 的第 [N] 页到第 [M] 页的单词给我出个测验” — 指定页码范围。
- “给我出3个测验” → 连续选择3个单词进行测验。

### 按需复习

如果没有任何单词需要复习或待复习，就从所有学过的单词中随机选择一个单词进行测验。同时记录测验的日期。

## 测验状态跟踪

在词汇跟踪器文件的顶部添加一个“## 测验状态”（Quiz State）部分：

```markdown
## Quiz State
- **Pending quiz:** [word] ([review type], [step] sent)
- **Last quiz sent:** YYYY-MM-DD HH:MM TZ
```

每次测验后更新该部分的内容。