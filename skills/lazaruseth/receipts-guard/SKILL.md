---
name: receipts-guard
description: ERC-8004标准定义了身份验证（Identity）机制、x402支付协议以及仲裁（Arbitration）机制，这些是支持自主代理（Autonomous Agents）进行商业活动的三大基础框架。它们共同构成了机器经济（Machine Economy）的三大支柱。
metadata: {"openclaw":{"emoji":"⚖️","requires":{"anyBins":["node"]},"version":"0.7.1"}}
---

# RECEIPTS Guard v0.7.1 - 机器经济的三大支柱

> “机器经济的三大支柱。”

支持ERC-8004身份验证标准、x402支付协议以及仲裁机制，为代理之间的商业活动提供基础设施。

**三大支柱：**
| 支柱 | 标准 | 功能 |
|------|----------|---------|
| **身份验证** | ERC-8004 | 在链上锚定代理的身份信息 |
| **信任机制** | ERC-8004声誉系统 | 仲裁结果影响代理的声誉 |
| **支付方式** | x402支付协议 | 支付仲裁费用，实现自动化结算 |

**本地优先、链上锚定、可云部署、安全性强化。**

## v0.7.1的新功能（安全性强化）  
- **🔐 HTTP认证**：支持API密钥和DID请求签名  
- **🛡️ 权限验证**：对 `/accept` 端点进行交易对手方验证  
- **🌐 CORS安全增强**：可配置的源地址白名单（默认禁止跨源请求）  
- **⚡ 速率限制**：每个IP每分钟限制100次请求  
- **✅ 输入验证**：验证支付地址、费用和截止日期的合法性  

## v0.7.0的新功能  
- **⛓️ ERC-8004集成**：将代理身份信息锚定到以太坊/Base注册表  
- **💰 x402支付**：支持使用USDC/ETH进行支付  
- **☁️ 云部署**：支持Dockerfile和Fly.io Sprites部署  
- **🌐 HTTP服务器模式**：为云代理提供REST API接口  

### 从v0.6.0开始的新功能：  
- **🪪 自主身份系统**：基于DID的身份验证，使用Ed25519签名  
- **🔑 密钥轮换**：旧密钥用于签署新密钥，确保签名链的连续性  
- **👤 人工控制器**：提供基于Twitter的紧急恢复机制  

### 从v0.5.0开始的新功能：  
- **⚖️ 完整的仲裁流程**：提出提案 → 接受提案 → 履行协议 → 仲裁 → 发布裁决  
- **📜 可编程协议对象（PAO）**：包含协议的规范条款和双方签名  
- **📊 法律来源审查（LPR）**：为仲裁员提供时间线可视化工具  

## 快速入门  

---

### 命令  

#### 身份管理（v0.6.0）  
- `identity init`：创建代理身份  
  创建Ed25519密钥对、DID文档（格式：`did:agent:<namespace>:<name>`以及人工控制器配置  

- `identity show`：显示代理身份信息（可选参数 `--full` 可查看完整DID文档）  

- `identity rotate`：轮换代理密钥  
  旧密钥用于生成签名链，旧密钥会被存档以供历史验证使用  
  密钥轮换后，代理身份保持不变  

- `identity verify`：验证代理身份或签名合法性  

- `identity set-controller`：设置人工控制器，用于紧急情况下的身份恢复  

- `identity recover`：触发人工控制器进行身份恢复，所有旧密钥将被撤销  

- `identity publish`：发布代理的DID文档  

- `identity anchor`：将代理身份信息锚定到ERC-8004注册表（v0.7.0版本）  
  需要设置环境变量 `RECEIPTS_WALLET_PRIVATE_KEY`；交易哈希会存储在DID文档中  
  主网环境：提供更高的可信度；基础环境：支持x402支付协议  

**已部署的注册表：**  
| 链路 | 注册表 | 状态 |  
|------|-------------------|--------|  
| 以太坊 | `0x8004A169FB4a3325136EB29fA0ceB6D2e539a432` | 正式运行 |  
| Sepolia | `0x8004A818BFB912233c491871b3d84c89A494BD9e` | 测试网 |  
| Base | 即将推出 | 待定 |  

- `identity resolve`：从本地存储或链上注册表中解析DID信息（v0.7.0版本）  

---

### ERC-8004集成（v0.7.0）  
ERC-8004标准提供了三个用于管理代理信任的注册表：  
1. **身份注册表**：基于NFT的代理标识符  
2. **声誉注册表**：记录代理的在线反馈和评分  
3. **验证注册表**：由验证者确认代理的工作成果  

RECEIPTS Guard与这些注册表集成，同时提供更完善的离链协议管理功能。  

### x402支付集成（v0.7.0）  
x402支付协议支持付费仲裁，仲裁员可以获得报酬。  

#### 提交包含支付条款的提案  
#### 进行仲裁并验证支付信息  

### 云部署（v.0.7.0）  
RECEIPTS Guard可作为持久化的云服务运行：  
- **HTTP服务器模式**：提供REST API接口（无需认证）  
  - 公共接口：`GET /`（服务信息）、`GET /health`（健康检查）、`GET /identity`（DID文档）、`GET /identity/chains`（链状态）  
  - 需认证的接口：`GET /list`（记录列表）、`GET /proposals`（提案列表）、`GET /agreements`（协议列表）、`POST /propose`（创建提案）、`POST /accept`（仅限交易对手方接受提案）  

### HTTP API安全（v.0.7.1）  
HTTP服务器采用多重安全措施：  
- **认证方式**：  
  - **API密钥**  
  - **DID请求签名**  
- **CORS配置**：默认禁止跨源请求（增强安全性）  
- **速率限制**：每个IP每分钟限制100次请求  
- **响应头信息**：包含请求限制信息  
- **输入验证**：验证支付地址、仲裁费用、截止日期等数据的合法性  

#### 环境变量  
用于配置服务器行为和安全性设置  

---

### 其他功能  
- **Fly.io Sprites部署**：支持使用Fly.io Sprites进行部署  
- **Docker部署**：提供Docker镜像  
- **迁移**：支持将现有协议升级为使用DID格式  

### 仲裁流程  
- **propose**：创建包含协议条款、提案方签名和截止日期的PAO（可编程协议对象）  
- **accept**：接受提案，并在相同条款哈希下添加交易对手方的签名  
- **reject**：拒绝提案  
- **fulfill**：提交完成证明  
- **arbitrate**：启动仲裁流程  
- **submit**：在指定时间内提交证据  
- **ruling**：仲裁员发布最终裁决  
- **timeline**：生成包含所有状态变化、证据提交记录和裁决结果的时间线  

---

### 其他命令  
- **capture**：捕获协议相关数据  
- **list**：列出所有记录  
- **query**：查询特定信息  
- **diff**：比较数据差异  
- **dispute package**：处理争议相关操作  
- **witness**：提供证据支持  
- **rules**：查看相关规则  
- **export**：导出数据  

## 状态机设计  
---

## 数据结构  
- **DID文档（`identity/did.json`，v.0.6.0版本）**  
- **签名格式**  
- **提案文件（`proposals/prop_xxx.json`）**  
- **协议文件（`agreements/agr_xxx.json`）**  
- **仲裁记录（`arbitrations/arb_xxx.json`）**  
- **裁决文件（`rulings/rul_xxx.json`）**  

## 数据存储方式  

## 代理使用指南  
- **接受协议前**：  
  1. 确认协议条款；  
  2. 验证仲裁员的可靠性；  
  3. 检查截止日期的可行性；  
  4. 对所有涉及的服务条款执行证据捕获操作。  

- **做出承诺前**：  
  1. 使用 `propose` 命令正式提出承诺；  
  2. 等待对方接受后再执行；  
  3. 用证据记录协议履行情况。  

- **仲裁过程中**：  
  1. 在截止日期前提交所有相关证据；  
  2. 使用适当的证据类型（如文档、截图等）；  
  3. 在提交材料中引用对应的条款哈希。  

## 环境变量设置  

## 框架集成信息  
---

## 链接资源  
- **GitHub仓库**：https://github.com/lazaruseth/receipts-mvp  
- **ClawHub**：https://clawhub.ai/lazaruseth/receipts-guard  
- **Moltbook**：https://moltbook.com/u/receipts-guard  
- **问题反馈**：https://github.com/lazaruseth/receipts-mvp/issues  

## 免责声明  
RECEIPTS Guard提供证据捕获和仲裁流程工具，但不能替代法律审查。仲裁协议仅提供结构化支持，不构成法律仲裁。在实际争议中，请务必咨询专业律师。