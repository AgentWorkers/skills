---
name: agentspend
description: 设置和管理用于支付服务的卡片及加密货币钱包。
source: https://github.com/jpbonch/agentspend
---
## 安装

安装命令使用 `npx agentspend`，该命令会从 npm 中下载相关依赖。或者，也可以选择全局安装：

```bash
npm install -g agentspend
```

之后可以直接使用 `agentspend`，而无需再通过 `npx agentspend` 来调用它。

## 规则

- 在运行 `agentspend pay` 之前，务必先与用户确认——向用户展示支付链接、支付方式（信用卡/加密货币），并征求他们的同意。
- 唯一的例外情况是：用户在当前对话中已经明确表示“同意支付”或“可以开始”。

## 使用场景

- 当某个服务需要 `billing.accepts: agentspend` 的功能时，就需要使用此命令。
- 用户需要先设置信用卡或加密货币钱包来支付相关费用。

## 命令

### 配置信用卡

```bash
npx agentspend card configure
```

**首次使用：** 用户会进入一个页面，设置他们的每周消费限额，然后通过 Stripe Checkout 功能添加信用卡信息。配置信息会保存在 `~/.agentspend/card.json` 文件中。

**重新运行：** 用户可以再次进入该页面，修改每周消费限额、更换信用卡或完全删除信用卡信息。

### 信用卡状态

```bash
npx agentspend card status
```

显示信用卡的详细信息：
- **每周预算使用情况：** 已花费的金额与每周限额的对比
- **已授权的服务：** 该信用卡绑定的服务列表
- **最近的交易记录：** 最近 10 笔交易，包括服务名称、交易金额和交易日期

如果尚未设置信用卡，则会显示信用卡的配置待处理状态。

### 创建钱包

```bash
npx agentspend wallet create
```

为 x402 支付方式生成一个新的加密货币钱包（包含公钥和私钥对）。配置信息会保存在 `~/.agentspend/wallet.json` 文件中。此过程无需用户手动操作。只需将钱包地址告知用户，以便他们使用 USDC 在 Base 平台上为钱包充值。

### 钱包状态

```bash
npx agentspend wallet status
```

显示钱包的地址、所属网络以及 USDC 的余额。

### 支付

```bash
npx agentspend pay <url>
```

使用信用卡或加密货币钱包来支付受支付墙保护的服务端点。

**可选参数：**
- `--method card|crypto` — 强制指定支付方式（默认为自动检测）
- `--body <json>` — 请求体（JSON 格式的数据）
- `--header <key:value>` — 额外请求头（可重复使用）

## 支付流程

- 系统会首先尝试使用信用卡进行支付（通过 `x-card-id` 请求头识别信用卡）。
- 如果系统检测到用户已使用加密货币钱包，且服务端返回了支持 x402 支付方式的响应（状态码为 402），则会尝试使用加密货币进行支付。

## 用户交互方式

- **`card configure`：** 告知用户在浏览器中配置消费设置。首次设置时，用户需要设置每周消费限额并添加信用卡。重新运行该命令后，用户可以修改限额、更换信用卡或删除信用卡。
- **`card status`：** 用于查看剩余的每周预算、已授权的服务列表以及最近的交易记录。在尝试支付前查看这些信息非常有用。
- **`wallet create`：** 告知用户钱包的地址，并要求他们使用 USDC 为钱包充值。
- 请勿在消息中显示信用卡的 ID、私钥或 Stripe 的相关链接。
- 信用卡配置成功后：**“您的信用卡已配置完成。现在我可以代表您支付服务费用了。”
- 钱包创建成功后：**“钱包已创建。请将 USDC 发送到 0x...（Base 平台的地址）进行充值。”