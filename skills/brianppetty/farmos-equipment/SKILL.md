---
name: farmos-equipment
description: 查询农场设备群的状态、维护计划和服务历史记录。该功能通过集成端点实现（无需身份验证）。
tags: [farming, equipment, maintenance]
---
# FarmOS设备

用于查询和管理农场设备数据——包括设备状态、维护计划、服务记录以及零部件库存。

## 适用场景

**该功能可处理以下内容：**设备运行状态、维护计划、设备故障、运行时间/里程记录、服务手册查询、零部件相关问题以及维护完成情况。

**常用触发语句：**“[设备名称] 出现问题了...”、“设备状态如何？”、“需要记录[设备名称]的运行时间”、“哪些设备需要维护？”、“在服务手册中查找[设备名称]的相关信息”、“8370R型号的设备使用哪种机油？”

**该功能不处理的内容：**关于作物/土壤/虫害的现场观察（使用farmos-observations功能）、人员维修安排（通过farmos-tasks功能创建任务）、以及天气造成的设备损坏报告（使用包含“weather_damage”类型的farmos-observations功能）。

**最低有效输入要求：**设备名称或设备故障的简要描述。例如：“联合收割机运转时发出奇怪的声音”即可。

## API基础信息

http://100.102.77.110:8005

## 数据完整性规则

**重要提示：**务必返回完整的数据，切勿截断结果。

1. **仪表板端点仅用于显示汇总统计信息**——使用`/api/integration/dashboard`获取设备数量和逾期维护任务信息，不用于列出所有设备。
2. **用于列出所有设备**的端点为`/api/integration/equipment`，该端点会返回所有设备的详细信息，不支持分页。
3. **用于获取到期维护任务的端点为`/api/integration/due-maintenance`，该端点会返回所有即将到期或已经到期的维护任务。
4. **务必说明返回的任务总数**：例如：“找到3个到期维护任务”（而不仅仅是“到期任务：”）。
5. **如果返回的结果数量异常少**，请标记为“可能数据不完整，请尝试其他端点”。
6. **如果某个端点出现故障**，应立即向用户报告故障情况，而不要默默地使用不完整的数据。

## 集成端点（无需身份验证）

### 仪表板汇总
GET /api/integration/dashboard

返回：设备数量、维护统计信息、逾期维护任务。

**用途：**仅用于获取汇总统计数据和设备数量。不适用于列出设备或维护任务。

### 设备列表
GET /api/integration/equipment

返回：所有设备的详细信息，包括设备ID、名称、品牌、型号、类型和状态。

**用途：**用于获取所有设备的完整列表。该端点会返回所有设备的详细信息，不支持分页。可以使用此信息来查询其他相关设备。

### 设备详情
GET /api/integration/equipment/{id}/summary

返回：设备的完整信息，包括维护历史记录和服务文档。

### 到期维护任务
GET /api/integration/due-maintenance

返回：所有即将到期或已经到期的维护任务，包含以下信息：
- `schedule_id`、`equipment_id`、`equipment_name`
- `maintenance_name`、`priority`（低/正常/高/紧急）
- `trigger_type`（基于运行时间/日历/季节）
- `hours_overdue`或`days_overdue`
- `estimated_duration_minutes`（预计维护时间）
- `parts_required`（所需零部件列表）

**用途：**获取所有即将到期或已经到期的维护任务的完整列表。该端点会返回所有任务的详细信息，不支持分页。

### 维护完成记录
POST /api/integration/record-completion
Content-Type: application/json

**用途：**当有人报告维护已完成时使用此端点。

### 语义搜索（服务文档）
POST /api/integration/search
Content-Type: application/json

**用途：**用于查询与服务文档相关的内容，例如设备规格、操作流程和零部件信息。

### 自动问答（RAG Q&A）
POST /api/integration/ask
Content-Type: application/json

**用途：**使用此端点根据服务文档生成人工智能生成的答案，用于解答与设备相关的问题。

## 常用API端点（提供更多功能）

### 设备基本操作（CRUD）
GET /api/equipment — 支持分页和过滤（例如：`?equipment_type=tractor&status=active&search=deere`）
GET /api/equipment/{id} — 获取设备详细信息
POST /api/equipment/{id}/hours — 记录设备运行时间（例如：`{"hours": 1500, "recorded_at": "2026-02-13"）

### 维护管理
GET /api/maintenance/due — 获取所有即将到期或已经到期的维护任务列表
GET /api/schedules — 获取所有维护计划
GET /api/maintenance — 获取所有维护历史记录

## 使用说明

- 设备ID为整数。可以通过设备列表按名称查找对应的ID。
- 基于运行时间的维护任务会在`current_hours`大于或等于`due_at_hours`时触发。
- 基于日期的维护任务会在指定日期触发。
- 维护任务的优先级分为：低、正常、高、紧急。请特别注意标记为“紧急”的任务。
- 在报告设备维护状态时，务必首先提及到期任务。
- 自动问答端点可以根据上传的服务文档回答技术相关问题。

## 设备故障的沟通处理流程

当工作人员报告设备故障时（即使描述较为模糊），也要记录下来。例如：“联合收割机运转时发出奇怪的声音”。你的工作是引导他们提供更多有用信息，而不是进行深入询问。

### 症状检测

根据收到的信息自动判断可能的问题类型：

**声音相关症状**（对应可能出现的系统问题）：
- 嘎吱声：轴承、齿轮、刹车问题
- 点击声/敲击声：发动机、传动系统、部件松动
- 嗡嗡声/尖叫声：皮带、液压泵、助力转向系统问题
- 嘶嘶声：空气泄漏、液压管路问题、冷却系统问题

**性能相关症状**：
- 动作迟缓/动力不足：燃油系统、空气滤清器、涡轮增压器、变速箱问题
- 运转不稳/颠簸：传动系统、离合器、液压阀问题
- 车身偏移/牵引力异常：转向系统、对准问题、轮胎气压问题
- 振动：平衡问题、轴承问题、传动轴问题、部件松动问题
- 过热：冷却液、散热器、风扇、恒温器问题

**视觉相关症状**：
- 液体泄漏：根据液体颜色判断泄漏部位（机油为深色、液压油为琥珀色/红色、冷却液为绿色/橙色、燃油为透明/有柴油味）
- 烟雾：烟雾颜色可判断问题类型（白色为冷却液泄漏、蓝色为机油燃烧、黑色为燃油泄漏）
- 零件损坏/松动：记录损坏的部件和位置

**接受模糊的故障描述**：“有点不对劲”、“感觉不对劲”、“运行不正常”等描述都可以记录下来，并进一步询问详细情况。

### 后续问题（最多3个）

根据缺失的信息提出2-3个有用的问题。切勿提出超过3个问题。

| 缺失信息 | 问题 |
|-------------|----------|
| 声音类型 | “是嘎吱声、点击声还是嗡嗡声？” |
| 设备状况 | “这种问题一直存在，还是在特定负载下/在特定速度下/在转弯时出现？” |
| 发生时间 | “你什么时候第一次注意到这个问题？是今天刚出现的，还是逐渐加重的？” |
| 环境因素 | “最近有什么变化吗？是否有新安装的部件？环境条件是否有所不同？” |
| 问题位置 | “你能确定问题出在哪里吗？是前面、后面、左侧还是发动机附近？” |
| 严重程度 | “现在还能安全使用这台设备吗？还是应该将其停用？” |

**对于了解设备的操作人员**：自动检测所有相关信息，并确认问题后提供维修建议。对于信息不多的报告者，只需提出2-3个针对性问题。

### 自动关联

当设备出现故障时，自动检查以下内容：
1. **设备运行时间与维护计划**：例如：“当前运行时间为1247小时，而设备下次维护时间是在1250小时，现在正好是检查的好时机。”
2. **最近的维护记录**：例如：“液压滤清器在200小时前更换过——虽然可能不是这个问题，但也需要提及。”
3. **类似的故障记录**：例如：“上周有人报告过这台设备有类似的声音——可能是相关问题。”

可以使用设备详情端点（`GET /api/integration/equipment/{id}/summary`）获取设备的维护历史记录和服务间隔信息。

### 创建维护标记

在记录故障信息后，先询问用户是否需要标记该设备为待维修状态，或者是否需要创建维修任务：

1. **询问用户是否需要标记该设备为待维修状态**：例如：“您需要我标记这台设备为待维修吗？”
2. **使用任务管理功能创建维修任务**：
   - 标题：设备名称 + 症状描述（例如：“8370R型号设备在左转弯时发出嘎吱声”）
   - 描述：记录的所有详细信息（症状、设备状况、操作人员的观察结果）
   - 设备ID：记录的设备ID
   - 优先级：根据故障严重程度确定
3. **如果操作人员提供了设备运行时间，可以使用`POST /api/equipment/{id}/hours`记录下来**

### 安全紧急处理

如果报告的故障涉及以下任何情况，立即切换到紧急处理模式：
- **刹车系统**：任何设备的刹车问题
- **转向系统**：转向失灵、转向不灵敏、牵引力异常
- **液压系统故障**：液压压力突然下降、液压系统故障导致设备无法正常工作
- **结构问题**：车架裂纹、防翻装置损坏、侧倾风险
- **火灾风险**：发动机舱冒烟、有电气故障迹象、燃油泄漏

**进入紧急处理模式后**：
- 明确说明安全风险
- 建议立即停止设备使用
- 自动将问题上报给相关人员（例如：Brian）
- 创建紧急优先级的维修任务
- 不要等待操作人员主动询问，立即采取行动

### 问题处理后的后续操作

记录问题后，可以提供以下帮助：
- **询问是否需要检查库存中有相应的零部件**（如果适用）
- **是否需要查询服务手册中的相关内容**（使用自动问答功能）
- **是否需要安排设备停机时间**（如果需要，可以使用任务管理功能安排维修）

### 示例流程

**了解设备的操作人员：**
（此处应提供具体的操作流程示例）

**信息不多的报告者：**
（此处应提供针对信息不多的报告者的处理流程示例）

**紧急情况处理：**
（此处应提供紧急情况下的处理流程示例）

---

## 跨模块关联处理

在处理设备故障时，需要考虑其他可能受影响的部分：

**设备与任务的关系：**
- 当设备出现故障或无法正常使用时，检查`farmos-tasks`中是否已为该设备分配了维修任务。例如：“8370R型号设备本周有3个维修任务，其中2个需要使用播种机。如果使用播种机会影响其他任务，可以将其标记为待处理状态。”
- 当设备需要维护或已经到期时，检查是否有依赖于该设备的任务。例如：“喷雾器下次维护时间是在200小时，但目前设备运行时间为197小时，且本周有相关任务。需要先安排喷雾器的维护吗？”
- 当设备恢复使用后，检查是否有依赖于该设备的任务。

**设备与现场观察记录的关系：**
- 当设备在田间出现故障时，检查`farmos-observations`中是否有相关的现场观察记录。设备故障可能与作物问题有关，反之亦然。例如：“上周有记录显示8号田块的播种情况不均匀，可能与这台设备的故障有关。”

**设备与天气的关系：**
- 当田间设备出现故障时，查看天气预报。如果天气恶劣且设备需要立即使用，需要提高维修的紧迫性。例如：“周四开始下雨，而喷雾器无法使用，这会缩短维修时间。”

在处理设备故障时，需要考虑其他可能受影响的方面，并进行相应的协调。

## 图片处理

当设备故障报告附有图片时（图片描述会显示为`[图片] 描述：...`），可以利用图片来辅助问题处理：

### 图片中的损坏或症状
- **识别部件**：根据图片描述判断损坏的部件（例如：软管、皮带、轮胎、轴承、气缸等）
- **评估损坏情况**：记录裂纹、泄漏、磨损情况、变色、变形或部件缺失等情况
- **查询服务手册**：根据识别出的部件和问题，使用`POST /api/integration/search`查询服务手册（例如：`[品牌] [型号] [部件] [症状]`）以找到相关服务文档
- **在维护任务中记录图片信息**：在创建维修任务时，附上图片中的损坏情况。例如：“图片显示8370R型号设备左后部有损坏的液压软管，框架下方有液体泄漏。”

### 图片中的设备运行时间或仪表板信息
- **读取数值**：从图片描述中提取设备运行时间、里程数等数值
- **记录相关信息**：例如：“图片显示设备运行时间为1200小时。需要我记录下来吗？”然后使用`POST /api/equipment/{id}/hours`记录这些信息
- **注意警告灯**：如果仪表板有警告灯，请记录下来，并查阅相关服务手册
- **注意错误代码**：如果显示屏上有错误代码，记录下来并查询服务手册（例如：“显示的错误代码是E-47，请查阅手册确认原因”）

### 图片中的错误代码或警告灯
- **读取错误代码**：从图片描述中提取错误代码
- **查询相关信息**：使用`POST /api/integration/search`查询服务手册（例如：`{"query": "error code E-47 Case IH 8250"}`）
- **用通俗语言解释**：将服务手册中的解释用简单的语言传达给操作人员。例如：“错误代码E-47表示液压泵压力不足，可能是液压油不足、滤清器堵塞或泵故障”
- **建议处理措施**：根据错误代码的严重程度建议下一步操作（例如：继续使用设备需谨慎、立即停车、联系维修人员）

### 处理图片质量
- **图片清晰**：使用清晰的图片进行问题处理。准确描述所看到的情况
- **图片不清晰**：如果图片质量较差，可以询问操作人员能否提供更清晰的图片
- **无法识别设备**：如果无法从图片中识别设备类型，需要操作人员提供更多信息

### 请求图片的情况
- 如果工作人员报告设备故障但没有提供图片，且图片对问题诊断有帮助，可以请求他们拍照：**“能拍张照片吗？这有助于我们判断问题原因。”
- **并非所有情况都需要拍照**：对于基于声音的症状、性能问题或已知的问题，无需拍照
- **适合拍照的情况**：包括明显的损坏、液体泄漏、错误代码/显示故障、部件损坏等情况