---
name: splitxch
description: 根据用户提供的描述，`Create SplitXCH` 功能用于生成用于分配 XCH（Chia Coin）支付、版税或收入的地址。当用户需要将这些资金分发给多个接收者时，可以使用该功能。该功能会在接收到以下请求时触发：`split royalties`、`royalty split`、`splitxch`、`split XCH between`、`revenue share`、`payment split`、`basis points split` 等。该系统支持嵌套/级联的分割方式，能够处理复杂的层级结构以及超过 128 个接收者的分配需求。
---

# SplitXCH 代币分配工具

该工具可根据自然语言描述生成复杂的 XCH 代币分配地址。

## 工作原理

SplitXCH 会创建特殊的 Chia 区块链地址，这些地址能够根据配置的百分比自动将收到的付款分配给多个接收者。API 会生成一个特定的地址；任何发送到该地址的 XCH 代币都会在链上自动进行分配。

## 工作流程

1. 将用户提供的简单分配描述解析为包含接收者及其对应百分比的信息。
2. 将百分比转换为基点（总基数为 9850，API 会收取 150 bps 的费用）。
3. 对于嵌套的分配结构（即一次分配中包含多次分配），采用自下而上的方式进行处理：先创建最底层的分配地址，然后将这些地址作为上层分配的接收者。
4. 通过 `scripts/splitxch.sh` 脚本或直接使用 `curl` 命令调用 SplitXCH API。
5. 返回生成的分配地址及分配汇总信息。

## 基点转换规则

- 10,000 bps 等于 100%；API 费用为 150 bps（1.5%）。
- 接收者最终获得的代币总数为 9,850 bps。
- 计算公式：`points = round(percentage / 100 * 9850)`。
- 确保所有接收者的代币总数恰好为 9,850 bps。

**示例**：将 60% 的代币分配给 Alice，40% 分配给 Bob。
- Alice 获得：`round(0.60 * 9850) = 5910` bps
- Bob 获得：`9850 - 5910 = 3940` bps

## 构建 API 请求数据

将生成的请求数据保存到临时文件中，然后运行以下命令：
```json
{
  "recipients": [
    {"name": "Alice", "address": "xch1...", "points": 5910, "id": 1},
    {"name": "Bob", "address": "xch1...", "points": 3940, "id": 2}
  ]
}
```

## 嵌套分配结构（超过 128 个接收者或分层结构）

当用户需要处理多层分配时：
1. 首先通过 API 创建每一层的分配地址。
2. 使用返回的分配地址作为上层分配的接收者。
- 每一层分配都会产生 150 bps 的费用。

**示例**：将 70% 的代币分配给 Team A（Alice 和 Bob 各占 50%），剩余 30% 分配给 Charlie。
- 创建 Team A 的分配地址：`Alice: 4925` bps, `Bob: 4925` bps → 返回地址 `xch1teamA...`
- 创建最终分配地址：`TeamA: 4925` bps + `Charlie: 2955` bps = 9850` bps

## 验证规则

- 所有分配地址必须以 `xch1` 开头，并且必须是有效的 bech32m 格式地址。
- 每次分配最多只能包含 128 个接收者。
- 每个接收者的代币数量必须大于 0。
- 所有接收者的代币总数必须恰好为 9,850 bps。

## 输出格式

分配完成后，会显示以下内容：
1. **分配地址**：生成的 `xch1...` 格式的分配地址。
2. **汇总表**：每个接收者的名称、分配地址（部分隐藏）及分配百分比。
3. **费用说明**：“SplitXCH 会对每一层分配收取 1.5% 的平台费用。”
4. **使用说明**：“将 XCH 代币发送到此地址，系统会自动将其分配给所有接收者。”

如果存在嵌套结构，会显示完整的分配树结构。

## API 参考文档

有关详细的 API 文档、验证规则和错误处理信息，请参阅 [references/api.md](references/api.md)。

## 重要提示

- 用户必须为所有接收者提供有效的 XCH 钱包地址。如果缺少地址，请在调用 API 之前要求用户提供。
- 如果用户仅提供了名称和百分比而没有地址，请告知用户所需的信息并请求他们提供地址。
- 在进行测试或预览时，可以不调用 API，直接显示计算出的基点结果。