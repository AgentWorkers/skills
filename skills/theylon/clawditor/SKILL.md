---
name: clawditor
description: 审计 OpenClaw 代理的工作空间，并生成标准化的评估报告、评分结果及修复建议。当需要审查内存质量、检索效率、产出效果、可靠性或数据一致性时，可通过扫描内存文件、日志文件、配置文件、Git 仓库以及相关工件来实现这一目标。具体操作包括生成以下文件：`eval/exec_summary.md`、`eval/scorecard.md` 和 `eval/latest_report.json`（如果之前存在评估历史记录，则会包含差异对比信息）。
---
# Clawditor

## 概述
Clawditor 是一个用于 OpenClaw 工作区审计和代理评估的工具。它能够分析工作区的各项资源（包括内存、日志、项目、文件、Git 仓库和配置文件），并生成包含评分、证据以及具体改进建议的评估报告。

## 运行规则
- 以非交互式模式运行：除非因文件缺失导致问题，否则不提示用户输入信息。系统会自行判断并继续执行审计流程。
- 避免秘密数据的泄露：仅报告密钥/令牌的存在位置及文件路径，并提出相应的修复建议。
- 对第三方技能/插件持谨慎态度：优先采用静态检查而非实际执行这些插件。

## 必须按顺序执行的步骤
1. 构建工作区资源清单：
   - 生成一个四级目录结构的树状视图，显示每个目录下的文件数量和大小。
   - 确定工作区内存在的内存数据、日志文件、配置文件、代码仓库、脚本、文档及其他资源。
   - 记录最大的文件大小。
2. 重建会话时间线：
   - 通过分析每日内存文件和日志，提取会话中的关键事件、任务、结果及未解决的问题。
3. 分析内存使用情况：
   - 检测内存文件中重复的段落，并量化重复内容的数量。
   - 识别数据过时的迹象（如日期、已弃用的配置设置）以及逻辑矛盾。
   - 确定缺失的关键信息（如项目信息、优先级、部署/运行脚本等）。
4. 分析评估结果：
   - 总结已发布的文档、代码变更及功能更新。
   - 如果存在 Git 仓库，计算代码变更的统计信息及提交频率；识别具有价值的代码更改。
5. 评估系统可靠性：
   - 从日志中提取错误信息、重试次数和工具故障情况。
   - 仅在安全且成本较低的情况下执行测试；否则采用静态检查方法。
6. 计算评分：
   - 为各项指标分配分数（0–100 分），并附上详细的理由和证据。
7. 提出改进措施和修复建议：
   - 提供 3–7 条优先级较高的改进建议。
   - 在安全的情况下，提供具体的代码差异修改方案（尤其是针对内存结构优化的建议）。
8. 与之前的评估结果进行对比：
   - 如果存在 `eval/history/*.json` 文件，计算当前评估结果与历史数据的差异。
   - 如果没有此类文件，创建基准评估并制定后续的评估计划。

## 评分框架
评分分为 5 个方面（每方面 0–100 分），最终得出综合加权分数：
- 内存健康状况（30%）：内存覆盖范围、结构合理性、冗余程度、数据更新频率、数据检索的便利性。
- 数据检索与上下文效率（15%）：操作前的搜索效率、上下文信息的冗余程度、数据压缩质量。
- 产出效率（30%）：发布的文档和代码数量、Git 仓库的更新频率、任务完成情况。
- 系统可靠性（15%）：错误率、测试与持续集成（CI）的覆盖率、代码回归情况。
- 任务聚焦与一致性（10%）：目标的一致性、项目范围的控制能力、决策过程的透明度。

## 必须生成的输出文件
所有评估结果应保存在 `eval/` 目录下：
1. `exec_summary.md`：
   - 以 10 个要点的形式总结主要发现、最大的瓶颈以及 3 条最重要的改进措施。
   - 显示总体评分及各指标的详细分数，以及与上次评估的差异。
2. `scorecard.md`：
   - 以表格形式展示各项指标的数值及简要说明。
   - 提供关键证据的列表，包括文件路径和简短的示例内容（避免包含敏感信息）。
3. `latest_report.json`：
   - 包含时间戳、工作区路径、Git 仓库的当前状态、评分结果、差异对比信息、关键发现、风险提示及改进建议。
4. 修复建议文件（`patches`）：
   - 如果存在内存问题，提供具体的代码修改方案（包括 `INDEX.md`、每日更新的结构文件及代码重构方案）。

## 推荐的内存数据结构（如未配置则使用此方案）
建议创建或更新以下文件：
- `memory/INDEX.md`：
  - 当前的工作目标（前 3 项）
  - 正在运行的项目（状态、下一步行动、相关链接）
  - 运行环境中的限制因素（工具、系统配置、政策要求）
  - 重要的决策记录（日期、决策内容及理由）
  - 已知问题/调试日志的引用
  - 术语表/相关实体信息
- `memory/YYYY-MM-DD.md`（每日追加）：
  - 当天的工作目标
  - 执行的操作（链接到被修改的文件）
  - 作出的决策
  - 新发现的信息（区分长期有效的数据和临时性内容）
  - 下一步需要完成的任务（具体内容）

## 代码修改建议
- 在安全的情况下，优先使用代码差异修改方案而非文字描述。
- 将长期稳定的数据从每日日志中提取出来，放入 `INDEX.md` 或相关项目页面中。
- 在未来的审计中添加日志记录和监控机制，以评估数据检索效率和任务完成情况。

## 辅助工具
使用以下脚本来确保审计工作的统一性和低成本：
- `scripts/run_audit.py`：运行所有辅助脚本并生成评估报告的初稿。
- `scripts/workspace_inventory.py`：生成目录结构树、文件数量统计及最大文件列表。
- `scripts/memory_dupes.py`：检测内存文件中的重复段落。
- `scripts/log_scan.py`：扫描日志中的错误、超时和重试记录。
- `scripts/git_stats.py`：获取 Git 仓库的当前状态、代码变更统计信息及提交频率。
- `scripts/validate_report.py`：验证评估报告的结构是否正确。

## 参考模板
- `references/report_schema.md`：提供输出报告的模板和 JSON 数据结构规范。

## 证据要求
- 确保每个评分结果都对应具体的证据来源。
- 如发现资源浪费、数据重复或系统性能不佳的情况，应如实反映。
- 在报告末尾提出“下次审计时的改进措施”。