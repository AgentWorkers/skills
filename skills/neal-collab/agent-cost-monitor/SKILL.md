---
name: agent-cost-monitor
version: 1.1.0
description: å®æ—¶è·Ÿè¸ªæ‰€æœ‰ OpenClaw ä»£ç†çš„ä»¤ç‰Œä½¿ç”¨æƒ…å†µä¸æˆæœ¬ï¼šåŒ…æ‹¬è­¦æŠ¥ã€é¢„ç®—ä¿¡æ¯ä»¥åŠä¼˜åŒ–å»ºè®®
emoji: ğŸ’°
tags:
  - cost
  - monitoring
  - tokens
  - budget
  - optimization
  - multi-agent
---

# ä»£ç†æˆæœ¬ç›‘æ§å™¨ â€” äº†è§£æ‚¨çš„ä»£ç†å®é™…èŠ±è´¹

å®æ—¶è·Ÿè¸ªæ‰€æœ‰ OpenClaw ä»£ç†çš„ä»£å¸ä½¿ç”¨æƒ…å†µã€æˆæœ¬å’Œæ•ˆç‡ã€‚åœ¨è¶…å‡ºé¢„ç®—ä¹‹å‰åŠæ—¶æ”¶åˆ°è­¦æŠ¥ã€‚

## é—®é¢˜

è¿è¡Œå¤šä¸ªä»£ç†éå¸¸å¼ºå¤§ï¼Œä½†å¦‚æœæ‚¨ä¸åŠ ä»¥ç›‘æ§ï¼Œæˆæœ¬ä¹Ÿä¼šéšä¹‹å¢åŠ ï¼š
- å“ªä¸ªä»£ç†æ¶ˆè€—çš„ä»£å¸æœ€å¤šï¼Ÿ
- å¿ƒè·³è¯·æ±‚æ˜¯å¦åœ¨æ˜‚è´µçš„æ¨¡å‹ä¸Šæµªè´¹äº†èµ„é‡‘ï¼Ÿ
- ç¼“å­˜åŠŸèƒ½æ˜¯å¦çœŸçš„ä¸ºæ‚¨èŠ‚çœäº†è´¹ç”¨ï¼Ÿ
- æ‚¨ä½•æ—¶ä¼šè¾¾åˆ°æ¯å‘¨çš„è´¹ç‡é™åˆ¶ï¼Ÿ

## è¯¥åŠŸèƒ½çš„ç”¨é€”

å½“è¯¥åŠŸèƒ½è¢«è§¦å‘ï¼ˆé€šè¿‡ cron æˆ–æ‰‹åŠ¨æ–¹å¼ï¼‰æ—¶ï¼Œå®ƒä¼šæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š
1. æ£€æŸ¥æ¯ä¸ªä»£ç†çš„ `session_status` çŠ¶æ€ã€‚
2. è®¡ç®—æ¯ä¸ªä»£ç†çš„å•ç‹¬æˆæœ¬ä»¥åŠæ€»æˆæœ¬ã€‚
3. ä¸é¢„ç®—é˜ˆå€¼è¿›è¡Œæ¯”è¾ƒã€‚
4. å¦‚æœæ¥è¿‘é˜ˆå€¼ï¼Œåˆ™å‘é€è­¦æŠ¥ã€‚
5. æå‡ºä¼˜åŒ–å»ºè®®ã€‚

## ä½¿ç”¨æ–¹æ³•

è¯·æ±‚æ‚¨çš„ç›‘æ§ä»£ç†ï¼ˆæˆ–ä»»ä½•å…·å¤‡æ­¤åŠŸèƒ½çš„ä»£ç†ï¼‰æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

```
"Give me a cost report for all agents"
"Which agent used the most tokens today?"
"Am I going to hit my rate limit this week?"
```

### è‡ªåŠ¨æ¯æ—¥æŠ¥å‘Šï¼ˆé€šè¿‡ cronï¼‰

```json5
{
  "name": "Daily Cost Report",
  "schedule": { "kind": "cron", "expr": "0 20 * * *", "tz": "Europe/Berlin" },
  "payload": {
    "kind": "agentTurn",
    "message": "Run a cost report across all agents. Check session_status for each. Report: total tokens, cost per agent, top spender, budget warnings. Send summary to user."
  },
  "sessionTarget": "isolated",
  "delivery": { "mode": "announce" }
}
```

## æˆæœ¬æŠ¥å‘Šæ ¼å¼

ç”ŸæˆæŠ¥å‘Šæ—¶ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹æ ¼å¼ï¼š

```markdown
## ğŸ’° Agent Cost Report â€” [Date]

### Per-Agent Breakdown
| Agent | Model | Tokens (24h) | Est. Cost | Status |
|-------|-------|-------------|-----------|--------|
| Central | Opus 4.6 | 125K | $1.87 | âš ï¸ High |
| Techops | Opus 4.6 | 89K | $1.33 | âœ… Normal |
| Atlas | Sonnet 4.5 | 45K | $0.27 | âœ… Low |
| Closer | Haiku 4.5 | 23K | $0.02 | âœ… Minimal |
| Heartbeats | Ollama | 12K | $0.00 | âœ… Free |

### Summary
- **Total 24h:** 294K tokens (~$3.49)
- **Projected weekly:** ~$24.43
- **Budget:** $20/week â†’ âš ï¸ 122% projected

### Recommendations
1. Move Techops from Opus â†’ Sonnet for routine tasks (-40% cost)
2. Increase heartbeat interval from 15m â†’ 30m
3. Enable context pruning on Atlas (idle sessions burning cache)
```

## æ¨¡å‹æˆæœ¬å‚è€ƒ

ä»¥ä¸‹æ˜¯æˆªè‡³ 2026 å¹´çš„æ¨¡å‹æˆæœ¬å‚è€ƒï¼š

### Anthropicï¼ˆClaude OAuth / APIï¼‰
| æ¨¡å‹ | æ¯ç™¾ä¸‡æ¬¡è¾“å…¥æˆæœ¬ | æ¯ç™¾ä¸‡æ¬¡è¾“å‡ºæˆæœ¬ | æ¯ç™¾ä¸‡æ¬¡ç¼“å­˜è¯»å–æˆæœ¬ | æ¯ç™¾ä¸‡æ¬¡ç¼“å­˜å†™å…¥æˆæœ¬ |
|-------|----------|-----------|---------------|----------------|
| Opus 4.6 | $5.00 | $25.00 | $0.50 | $6.25 |
| Sonnet 4.5 | $3.00 | $15.00 | $0.30 | $3.75 |
| Haiku 4.5 | $1.00 | $5.00 | $0.08 | $1.25 |

### å…è´¹é€‰é¡¹
| æ¨¡å‹ | æˆæœ¬ | é€‚ç”¨åœºæ™¯ |
|-------|------|---------|
| Ollamaï¼ˆæœ¬åœ°ï¼‰ | $0 | å¿ƒè·³è¯·æ±‚ã€ç®€å•ä»»åŠ¡ |
| Gemini OAuth | $0* | å¤‡ç”¨æ–¹æ¡ˆï¼ˆæœ‰è´¹ç‡é™åˆ¶ï¼‰ |

*å…è´¹ tier æœ‰è´¹ç‡é™åˆ¶*

## ä¼˜åŒ–ç­–ç•¥

### å¿«é€Ÿè§æ•ˆçš„ä¼˜åŒ–æªæ–½ï¼ˆä¼˜å…ˆå°è¯•è¿™äº›ï¼‰

1. **å…³é—­ Ollama çš„å¿ƒè·³è¯·æ±‚**  
```json5
{ "heartbeat": { "model": "ollama/llama3.2:3b" } }
```  
èŠ‚çœï¼š100% çš„å¿ƒè·³è¯·æ±‚æˆæœ¬ï¼ˆä½¿ç”¨ Opus å¯èŠ‚çœæ¯å‘¨ $5-10 ç¾å…ƒï¼‰

2. **å…³é—­ Haiku çš„ç¼“å­˜åŠŸèƒ½**  
```json5
{ "anthropic/claude-haiku-4-5": { "params": { "cacheRetention": "none" } } }
```  
èŠ‚çœï¼šåœ¨æˆæœ¬è¾ƒä½çš„æ¨¡å‹ä¸Šé¿å…ç¼“å­˜å†™å…¥æ“ä½œ

3. **ä¸Šä¸‹æ–‡å‰ªæ**  
```json5
{ "contextPruning": { "mode": "cache-ttl", "ttl": "5m" } }
```  
é¿å…åœ¨æ¯è½®æ¸¸æˆä¸­é‡æ–°è¯»å–è¿‡æ—¶çš„ä¸Šä¸‹æ–‡æ•°æ®

4. **å»¶é•¿ Opus/Sonnet çš„ç¼“å­˜æœ‰æ•ˆæœŸ**  
```json5
{ "anthropic/claude-opus-4-6": { "params": { "cacheRetention": "long" } } }
```  
é¿å…åœ¨æ¯è½®æ¸¸æˆä¸­é‡æ–°å‘é€ç³»ç»Ÿæç¤ºï¼ˆæœ€å¤§çš„å•æ¬¡èŠ‚çœï¼‰

### æ¨¡å‹é€‰æ‹©ï¼ˆå½±å“æœ€å¤§ï¼‰

| ä»»åŠ¡ç±»å‹ | ä½¿ç”¨æ¨¡å‹ | ä¸ä½¿ç”¨æ¨¡å‹ | èŠ‚çœæˆæœ¬ |
|-----------|----------|----------|--------|
| åè°ƒã€å¤æ‚æ¨ç† | Opus | â€” | åˆç†é€‰æ‹© |
| é‡‘èã€æ•°æ®åˆ†æ | Sonnet | Opus | èŠ‚çœ 40% |
| é”€å”®è‰ç¨¿ã€è¥é”€æ–‡æ¡ˆ | Haiku | Sonnet | èŠ‚çœ 67% |
| å¿ƒè·³è¯·æ±‚ã€å¥åº·æ£€æŸ¥ | Ollama | ä»»ä½•ä»˜è´¹æ¨¡å‹ | èŠ‚çœ 100% |
| æ¨æ–‡è‰ç¨¿ | Haiku æˆ– Grok | Opus | èŠ‚çœ 80% |

### ä¼šè¯ç®¡ç†

- **æ¯æ—¥é‡ç½®**ï¼šåœ¨è®¾å®šæ—¶é—´è‡ªåŠ¨æ¸…é™¤ä¼šè¯æ•°æ®ï¼ˆå‡å°‘ä»£å¸ç§¯ç´¯ï¼‰  
```json5
{ "session": { "reset": { "mode": "daily", "atHour": 4, "idleMinutes": 45 } } }
```  
- **å†…å­˜åˆ·æ–°**ï¼šåœ¨æ•°æ®å‹ç¼©å‰ä¿å­˜é‡è¦ä¸Šä¸‹æ–‡ä¿¡æ¯  
```json5
{ "compaction": { "memoryFlush": { "enabled": true } } }
```

## è­¦æŠ¥é˜ˆå€¼

åœ¨æ‚¨çš„ç›‘æ§ä»£ç†é…ç½®ä¸­è®¾ç½®ç›¸åº”çš„é˜ˆå€¼ï¼š

```markdown
## Budget Alerts
- Daily budget: $5.00 (warn at 80% = $4.00)
- Weekly budget: $20.00 (warn at 70% = $14.00)
- Per-agent daily max: $2.00
- Alert channel: Telegram DM
```

## ä¸ DevOps ä»£ç†é›†æˆ

å¦‚æœæ‚¨æœ‰ DevOps/ç›‘æ§ä»£ç†ï¼ˆä¾‹å¦‚æ‚¨çš„ DevOps ä»£ç†ï¼‰ï¼Œè¯·å°†å…¶æ·»åŠ åˆ°å…¶ AGENTS.md æ–‡ä»¶ä¸­ï¼š

```markdown
## Cost Monitoring
- Run daily cost report at 20:00
- Alert if any agent exceeds $2/day
- Weekly summary every Monday 09:00
- Track trends: is usage going up or down?
```

## å¸¸è§é—®é¢˜è§£ç­”

**Qï¼šæ­¤åŠŸèƒ½ä¼šè°ƒç”¨å¤–éƒ¨ API å—ï¼Ÿ**  
Aï¼šä¸ä¼šã€‚å®ƒä½¿ç”¨ OpenClaw å†…ç½®çš„ `session_status` å·¥å…·ï¼Œæ— éœ€å¤–éƒ¨ APIï¼Œä¹Ÿä¸ä¼šäº§ç”Ÿé¢å¤–è´¹ç”¨ã€‚

**Qï¼šæˆæœ¬ä¼°ç®—çš„å‡†ç¡®æ€§å¦‚ä½•ï¼Ÿ**  
Aï¼šåŸºäºå…¬å¼€çš„æ¨¡å‹å®šä»·ã€‚å®é™…æˆæœ¬å¯èƒ½å› ç¼“å­˜ä½¿ç”¨æƒ…å†µè€Œæœ‰æ‰€ä¸åŒã€‚ä¼°ç®—ç»“æœè¾ƒä¸ºä¿å®ˆï¼ˆç•¥é«˜ï¼‰ã€‚

**Qï¼šå¯ä»¥æŒ‰å¯¹è¯è®°å½•æˆæœ¬å—ï¼Ÿ**  
Aï¼šä¸èƒ½ç›´æ¥æŒ‰å¯¹è¯è®°å½•æˆæœ¬ã€‚æˆæœ¬æ˜¯æŒ‰ä¼šè¯è®°å½•çš„ã€‚å¯ä»¥ä½¿ç”¨ `sessions_list` æŸ¥çœ‹æ¯ä¸ªä¼šè¯çš„ä»£å¸ä½¿ç”¨æƒ…å†µã€‚

**Qï¼šè¯¥åŠŸèƒ½æ”¯æŒé Anthropic æ¨¡å‹å—ï¼Ÿ**  
Aï¼šæ”¯æŒã€‚æ‰€æœ‰æä¾›å•†çš„ä»£å¸ä½¿ç”¨æƒ…å†µéƒ½å¯ä»¥è¢«è®°å½•ã€‚æˆæœ¬ä¼°ç®—éœ€è¦çŸ¥é“ç›¸åº”çš„æ¨¡å‹å®šä»·ï¼ˆè¯·åœ¨æˆæœ¬å‚è€ƒéƒ¨åˆ†æ·»åŠ è‡ªå®šä¹‰è´¹ç‡ï¼‰ã€‚

## æ›´æ–°æ—¥å¿—

### v1.1.0  
- ç»Ÿä¸€äº†ç¤ºä¾‹ä¸­çš„æ‰€æœ‰ä»£ç†åç§°  
- ç§»é™¤äº†å…·ä½“çš„é…ç½®è¦æ±‚

### v1.0.0  
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ