---
name: kdp-publisher
description: 该工具帮助作者创建、格式化儿童书籍和活动手册，并将其发布到 Amazon KDP（Kindle Digital Publishing Platform）上。它涵盖了从故事构思到 PDF 文件生成、封面设计以及上传到 Amazon KDP 的整个流程。当作者在 Amazon KDP 上进行书籍发布、儿童书籍创作、活动手册生成、书籍格式化或封面设计时，该工具会自动触发相应的操作。
---
# kdp-publisher

该技能帮助代理创建、格式化并将儿童书籍和活动书籍发布到 Amazon Kindle Direct Publishing (KDP) 平台。涵盖了从故事创作到 KDP 上传的整个流程。

## 触发条件

当用户提及以下内容时，加载此技能：
- KDP、Kindle Direct Publishing、亚马逊自助出版
- 儿童书籍创作、图画书、故事书
- 活动书籍、涂色书、练习册、谜题书
- 书籍格式化、适合打印的 PDF 格式、封面设计
- KDP 上传、手稿上传、内页 PDF 文件

---

## 支持的书籍类型

| 类型 | 尺寸 | 内页内容 | 备注 |
|------|-----------|----------|-------|
| 儿童图画书 | 8.5×8.5英寸 | 全彩 | 插图 + 文字 |
| 活动书籍 | 8.5×11英寸 | 彩色或黑白 | 如“我发现了”（I Spy）等游戏类型 |
| 涂色书 | 8.5×11英寸 | 黑白 | 线条粗且无阴影 |
| 数学练习册 | 8.5×11英寸 | 黑白 | 练习题 + 答案 |
| 谜题书 | 8.5×11英寸 | 黑白 | 词语搜索、数独、填字游戏 |

---

## 核心工作流程

```
prompt → story generation → illustration → interior PDF → cover PDF → metadata → KDP upload
```

### 第一步 — 创作故事并制定计划

使用 `scripts/generate-book.py` 脚本来制作图画书。对于练习册/谜题书，可以使用专门的谜题生成工具（如 BookBolt）或自定义脚本。

```bash
python3 scripts/generate-book.py "a curious octopus who learns to share" \
  --type picture-book \
  --age-group 3-5 \
  --style watercolor \
  --output-dir output/
```

**故事要求：**
- 标题长度不超过 60 个字符
- 12 页内容 → 总共约 28 页（包括标题、献词、结尾和作者简介）
- 3-5 岁年龄段：每页 10-20 个单词，句子简单且重复
- 5-8 岁年龄段：每页 20-40 个单词，故事情节清晰
- 必须包含道德教育或寓意、献词、封底描述以及 7 个关键词

### 第二步 — 生成插图

**关键图像规则：**
- 每个图像提示中必须明确标注“无文字、无字母、无书写内容”
- 在生成第 1 页插图之前，先定义角色的特征和外观
- 在后续的所有提示中保持与第一张图片的风格一致（例如“与第 1 页的水彩风格相匹配”）
- 8.5×8.5 英寸的图画书使用 1:1 的宽高比；8.5×11 英寸的活动书籍使用 3:4 的宽高比
- 打印质量要求最低为 300 DPI — 1024px 的图像在 300 DPI 下约为 3.4 英寸，适合放大后的 8.5×8.5 英寸页面
- 在将图像嵌入 PDF 之前，检查其中是否包含人工智能生成的文字

### 第三步 — 组装内页 PDF

具体尺寸请参考 `references/kdp-specs.md`。

**8.5×8.5 英寸图画书的排版规则（无出血边距）：**
- 页面大小：612×612 磅
- 内容区域：576×576 磅（四周边距为 0.25 英寸）
- 图像必须完全位于内容区域内，不能超出边距
- 奇数页放置插图，偶数页放置文字（或交替排列）

**文字规则：**
- 需要嵌入字体（ReportLab：使用前需注册 TTFont 字体）
- 3-5 岁年龄段的字体大小至少为 14 磅；文字居中显示，行距要足够大
- 人工智能生成的图像中不允许出现文字 — 必须在生成后通过编程方式添加文字

### 第四步 — 创建封面

使用 `scripts/create-cover.py` 脚本来制作完整的封面 PDF（包括封面正面、书脊、封底及出血边距）：

```bash
python3 scripts/create-cover.py \
  --title "The Curious Octopus" \
  --author "Your Name" \
  --pages 28 \
  --paper white \
  --front-image output/curious-octopus/images/cover.png \
  --back-text "Follow Otto the octopus as he discovers the joy of sharing..." \
  --output output/curious-octopus/cover.pdf
```

**书脊宽度计算公式（KDP 标准）：**
- 白色纸张（黑白印刷）：页面数 × 0.002252 英寸
- 奶油色纸张（黑白印刷）：页面数 × 0.0025 英寸
- 白色纸张（彩色印刷）：页面数 × 0.002347 英寸

**8.5×8.5 英寸书籍的封面尺寸（白色，28 页）：**
- 书脊宽度：28 × 0.002347 = 0.0657 英寸
- 封面总宽度：8.5 + 0.0657 + 8.5 + 0.25 英寸 = 17.316 英寸
- 封面总高度：8.5 + 0.25 英寸 = 8.75 英寸

**封面设计规则：**
- 将标题和作者信息以 PDF 形式叠加在封面图片上 — 切勿将文字直接嵌入到 AI 生成的封面图片中
- 封底右下角保留 2 英寸 × 1.5 英寸的空间用于放置 ISBN 条码
- 页数少于 100 页的书籍可以不添加书脊文字（书脊太窄，不易阅读）
- KDP 会自动在封底添加自己的条形码 — 因此无需额外设置

### 第五步 — 编写元数据

**描述规则：**
- 根据最终完成的书籍内容来编写描述，而非根据初始提示或大纲
- 使用书中出现的实际角色名称
- 描述内容包含 2-3 句话，涵盖故事情节和寓意
- 在描述中注明适用年龄范围（例如“适合 3-6 岁儿童”）
- 避免过度使用关键词；亚马逊会自动进行内容索引

**KDP 元数据字段：**
- 标题 + 副标题（副标题可选，有助于提高搜索排名）
- 作者：使用笔名
- 7 个后台关键词（每个字段最多 50 个字符；使用短语而非单个单词）
- 选择 2 个分类（选择前请先进行市场调研）
- 语言、出版日期
- 如果内容或图像是由人工智能生成的，必须进行相关披露

### 第六步 — 上传前的验证

检查页面数量、尺寸是否符合要求、图像分辨率是否正确、图片中是否没有文字，以及描述内容是否与故事一致。

### 第七步 — 上传到 KDP

**浏览器自动化注意事项：**
- 在 KDP 的表单字段中不要使用 Playwright 的 `type` 方法 — 这会导致输入焦点移动和输入错误
- 使用 JavaScript 的 `evaluate` 方法结合元素 ID 来处理表单输入：
  ```js
  document.getElementById('data-print-book-title').value = 'The Curious Octopus';
  document.getElementById('data-print-book-title').dispatchEvent(new Event('input', {bubbles:true}));
  ```
- 文件上传需要使用 CDP 的 `DOM.setFileInputFiles` 方法和相应的事件监听（Playwright 的上传功能可能不适用）：
  ```js
  // After DOM.setFileInputFiles:
  document.querySelector('input[type=file]').dispatchEvent(new Event('change', {bubbles:true}));
  ```
- 等待 `#data-print-book-interior-processing-status` 的状态变为 COMPLETED 后再继续操作
- 每次上传前请重新加载 KDP 页面 — 旧的状态可能导致上传失败

**分类选择：**
- 使用分类模态框中的下拉菜单进行选择
- 选择所有分类后，通过 JavaScript 点击对应的复选框完成选择（不要使用 Playwright 的点击操作）

---

## 活动书籍和练习册

对于非叙事类书籍，可以跳过故事创作步骤，直接按照以下步骤操作：
1. 规划内容结构（章节划分、问题数量、难度等级）
2. 通过编程或谜题生成工具生成内容
3. 使用 ReportLab 或工作表模板进行排版
4. 应用相同的封面和元数据制作流程

**数学练习册的特别要求：**
- 方程式下方不要添加答案栏 — 孩子们可以直接在问题下方作答
- 问题编号的字体大小至少为 14 磅；数学内容的字体大小至少为 20 磅
- 答案部分应放在最后一页
- 书籍尺寸为 8.5×11 英寸，内页为黑白格式

**涂色书的规则：**
- 图像提示应为“简单的黑白涂色页，线条粗且无阴影”
- 禁用灰度图像 — 必须使用纯黑色线条和白色背景
- 保持页面背面空白，以防标记笔渗透到其他页面

---

## 定价快速参考

| 书籍类型 | 平装书价格 | 预计版税/销售额 |
|-----------|----------------|-----------------------|
| 儿童图画书 | $12.99 | 约 $5.00 |
| 活动书籍（彩色） | $8.99-$10.99 | 约 $3.10-$4.50 |
| 数学/谜题练习册 | $9.99-$12.99 | 约 $4.30-$6.00 |
| 涂色书 | $7.99-$9.99 | 约 $3.30-$4.50 |

电子书的版税比例为 70%；平装书的版税比例为 60%。

---

## Amazon 广告快速入门

详细设置请参考 `references/ads-quickstart.md`：
- 首先使用自动定位广告策略，每天费用为 $5
- 两周后，根据搜索词调整广告策略，转为手动精确匹配广告
- 目标转化率（ACoS）建议设置为 30-45%
- 如果某个关键词的点击量超过 8 次但未产生销售，可将出价降低至 $0.02
- 根据 ACoS（广告转化率）调整出价：如果 ACoS 低于 20%，则将出价提高 20%

---

## 关键经验教训

这些经验是在实际操作中总结出来的，从 KDP 的官方文档中可能无法直接了解到：
1. **KDP 表单自动化**：使用 JavaScript 的 `evaluate` 方法和元素 ID 来处理表单输入。切勿使用浏览器的 `type` 方法，因为这会导致输入焦点移动。
2. **文件上传**：使用 CDP 的 `DOM.setFileInputFiles` 方法进行文件上传；Playwright 的上传功能可能不适用。具体脚本路径请参考 `TOOLS.md`。
3. **书脊宽度计算**：白色纸张（黑白印刷）的书脊宽度计算公式为 `页面数 × 0.002252 英寸；彩色纸张为 `页面数 × 0.002347 英寸`。KDP 的封面计算器也会提供相应的计算公式。
4. **8.5×8.5 英寸书籍的排版规则**：图像必须完全位于 612×612 磅页面内的 576×576 磅内容区域内；超出边距的图像会导致上传失败。
5. **人工智能生成的图像**：所有图像提示中必须明确标注“无文字、无字母、无书写内容”。直接将文字嵌入 AI 生成的图像中可能会导致显示混乱。
6. **描述内容**：根据最终完成的书籍内容来编写描述，而非根据初始提示。使用书中的实际角色名称和情节。
7. **KDP 分类**：通过分类模态框中的下拉菜单进行选择，然后使用 JavaScript 点击复选框完成设置。不要依赖 Playwright 的点击操作。
8. **数学练习册**：方程式下方不要添加答案栏；孩子们应在问题下方直接作答。
9. **避免使用旧表单状态**：每次上传前请重新加载 KDP 页面。如果尝试上传已部分处理的文件，可能会导致上传失败。
10. **人工智能内容披露**：如果书籍中的内容或图像是由人工智能生成的，必须进行相关披露。上传时务必选择“是”选项；否则可能会影响账户功能。

---

## 参考资料

- `references/kdp-specs.md` — 书籍尺寸、边距、出血边距、书脊宽度等详细规范
- `references/qa-checklist.md` — 上传前的质量检查清单
- `references/niche-guide.md` — 利润较高的细分市场及其定价和竞争情况
- `references/ads-quickstart.md` — Amazon 广告的设置和优化指南

## 相关脚本

- `scripts/generate-book.py` — 完整的书籍制作流程（包括故事创作、插图生成和内页 PDF 制作）
- `scripts/create-cover.py` — 独立的封面生成脚本
- `scripts/validate-book.py` — 上传前的验证脚本

## 依赖项

```bash
pip install reportlab Pillow google-genai PyPDF2
# Optional for validation:
pip install pytesseract  # OCR-based text-in-image detection
```

API 密钥：设置环境变量 `GOOGLE.AI_API_KEY`，或者通过命令行参数 `--api-key` 传递，或者创建文件 `~/.clawdbot/credentials/google_ai.json`，内容如下：`{"api_key": "..."}`。