---
name: self-evolving-agent
version: 5.0.0
description: "AI助手通过分析自身日志来生成AGENTS.md文件的改进建议，实现了自动化流程。  
**v5.0**：引入了语义嵌入技术（Ollama nomic-embed-text），准确率提升约8%；实现了实时流式监控功能（<30秒内提供通知）；支持多实例协同工作。  
**v4.3**：新增了交互式审批流程；支持多种格式的报告生成；集成到了GitHub Issues系统中。  
**v4.2**：开始使用Ollama Large Language Model（LLM）进行智能分析。  
**v4.1**：实现了跨平台的部署功能。  
**v4.0**：优化了处理流程，采用四阶段的工作流程；仅提供改进建议，不允许用户直接修改代码。"
author: ramsbaby
tags: [self-improvement, automation, agents, meta, exec-safety, multi-agent, semantic-analysis, effect-measurement, ollama, local-llm, zero-cost, embeddings, streaming, fleet-analysis]
---
# 自进化代理 🧠 (v5.0.0)

这是一个自动化系统，它会每周阅读日志文件，利用语义嵌入技术寻找其中的模式，通过实时监控及时发现异常情况，并提出针对 AGENTS.md 文件的改进建议。不过，它仅提出建议，实际修改仍需用户批准。

---

## 直观说明

尽管这个工具被称为“AI 自进化系统”，但其工作原理其实相当透明：

1. **实时监控**：通过流式监控工具持续监视日志，一旦超过预设阈值就会立即发出警报。
2. **每周日 22:00**：系统启动为期六阶段的处理流程。
3. **数据收集代理**：负责扫描日志并整合实时警报信息。
4. **语义分析代理**：利用 Ollama 的语义嵌入技术识别模式。
5. **趋势分析代理**：对比四周内的模式变化（新出现的模式或已解决的模式）。
6. **集群分析代理**：对多个代理实例的分析结果进行交叉验证。
7. **效果评估代理**：评估之前建议的实际效果（是有所改进还是恶化）。
8. **综合生成代理**：汇总所有数据并生成修改建议的草稿。
9. 最后将建议通过 Discord 发送给用户，用户需批准后才能应用这些修改。

---

## v5.0 的主要改进（2026-02-18）：

- **语义嵌入技术**（核心功能1）：采用 Ollama 的 `nomic-embed-text` 技术进行语义分析，将误报率从约 15% 降低到约 8%。
- **实时监控**：升级后的监控工具能更快速地检测到日志异常（响应时间小于 30 秒）。
- **集群分析**：新增了对多个代理实例的分析功能。
- **趋势分析**：能够分析四周内的模式变化趋势。
- **系统容错性**：即使 Ollama 无法正常运行，系统也能自动回退到 v4.0 的备用方案，确保服务不中断。
- **新增命令行工具**：提供了 `sea monitor`、`sea alerts`、`sea trends` 和 `sea fleet` 等命令行工具。

---

## v4.3 的主要改进：

- **交互式审批流程**：引入了 30 秒的轮询机制，并在 macOS 桌面上提供通知功能，用户可以通过终端直接批准或拒绝建议。
- **自动添加反馈提示**：在发送建议时，系统会自动在 Discord 中添加相应的反馈提示（✅、❌、🔍）。
- **多格式报告**：支持输出 markdown、html、json 和 pdf 等格式的报告。
- **集成 GitHub Issues**：系统会为每个建议创建对应的 GitHub 问题，审批完成后会自动关闭问题并更新问题标签。

## v4.2 的主要改进：

- **全面支持 Ollama 和本地 LLM**：只需在 `config.yaml` 中设置 `provider: "ollama"` 即可。
- **零成本模式**：通过配置 `provider: "none"`，即可完全免除 API 使用费用。
- **通用 LLM 接口**：统一了调用 LLM 的脚本 `scripts/v4/llm-call.sh`，支持 anthropic、openai 和 ollama 等 LLM。
- **强化综合生成功能**：`synthesize-proposal.sh` 脚本通过 llm-call.sh 生成更准确的建议。

## v4.1 的主要改进：

- **同时支持韩语和英语的投诉模式**：在 `config.yaml` 中分离了韩语（`ko`）和英语（`en`）的配置项。
- **自动语言检测**：根据用户会话前 10 条消息中韩语的比例自动选择使用哪种语言进行分析。
- **配置选项**：用户可以通过 `auto_detect: true` 来启用或禁用这一功能。

## v4.0 的主要改进：

- **多代理协同工作**：不再依赖单个 Claude 代理，而是由四个专业代理协同处理任务。
- **改进了基于上下文的分析机制**：不再仅依赖关键词匹配，而是综合考虑了语境、位置和角色等因素。
- **效果评估机制**：在应用建议后，系统会在下个周期重新评估其实际效果。
- **误报率大幅降低**：误报率从约 40% 降至约 15%。

---

## 文件结构

---

## 🛠️ sea CLI (v2.0.0)

`sea` 是 Self-Evolving Agent 的命令行接口，允许用户在终端直接管理建议、执行处理流程以及应用修改。

### 环境变量设置

---

## 主要命令

---

## `sea approve` 的工作原理：

1. 从 `data/proposals/<id>.json` 文件中读取建议内容。
2. 显示修改前后的差异。
3. 将 `AGENTS.md` 文件中的修改前内容替换为修改后的内容。
4. 将建议的状态更新为 `"applied"`。
5. 执行 `git commit` 命令，提交更改。

---

## 安装说明

（非交互式安装方式，适用于持续集成/自动化场景）

---

## 配置验证

---

## Cron 任务设置（手动注册/更新）

---

## Cron 任务示例（添加到 `~/.openclaw/cron/jobs.json` 文件中）：

---

## 📊 本地仪表板（v4.1 新功能）

这是一个用于可视化展示建议历史、质量趋势、模式频率和规则效果的本地网页仪表板。

---

## 主要面板内容：
- 📈 质量趋势：显示随时间变化的质量评分。
- 🏥 AGENTS.md 健康状况：显示系统结构评分及历史变化趋势。
- 🔍 模式频率：显示投诉模式的分布情况。
- 📋 建议历史：列出所有建议的详细信息。
- ⚡ 规则效果：显示规则的实际效果（绿色/红色表示效果好坏）。

> 详情请参阅：`dashboard/README.md`

---

## 四阶段处理流程（v4.0）

### 第一阶段：数据收集（collect）

---

### 第二阶段：数据分析（analyze）

---

### 第三阶段：效果评估（benchmark）

---

### 第四阶段：建议生成（synthesize）

---

### 第五阶段：效果验证（measure-effects）

---

## 分析细节（v4.0 版本）

### 1. 基于上下文的智能分析（新功能）

在关键词匹配的基础上，增加了对上下文的分析，从而提高了分析的准确性。

### 2. 用户投诉模式分析（v4.1 版本）

从 v4.1 开始，系统能够区分韩语和英语的投诉模式，并自动检测会话语言。

### 自动语言检测逻辑：

如果会话前 10 条消息中包含超过 50% 的韩语内容，系统会使用韩语模式进行分析；否则使用英语模式。

**注意：** 如果某个词不在预定义的词汇表中，系统可能无法识别该词。

### 3. 检测连续执行的错误命令

---

### 4. 检测 Cron 任务中的错误

---

### 5. 检测 AGENTS.md 规则的违反情况

---

### 6. 会话健康状况评估

---

### 7. 效果评估循环（新功能）

---

## 建议的发布格式

建议会以如下格式通过 Discord 发送：

---

## LLM 提供者配置（v4.2 新功能）

在 `config.yaml` 的 `llm` 部分可以配置用于生成建议的 LLM 提供者。

---

| 提供者 | 使用成本 | API 密钥 | 是否需要网络连接 | 是否需要 API 订阅 |
|--------|--------|--------|------------|------------|
| **anthropic** | 约 $0.05/周 | ANTHROPIC_API_KEY | 是 | ★★★★ |
| **openai** | 约 $0.05/周 | OPENAI_API_KEY | 是 | ★★★★ |
| **ollama** | **免费** | 不需要 API | ★★★★ |
| **none** | **免费** | 不需要 API | 仅使用内置提示机制 |

### 💡 Ollama 配置（完全免费）

即使不使用 Ollama，系统也能通过 shell 脚本进行提示分析，无需支付 API 使用费用。

---

## 注意：在配置文件中选择 LLM 提供者时，请根据实际需求进行配置。

---

## 自定义设置

---

## 提交建议的渠道设置

在 `config.yaml` 的 `delivery` 部分可以配置建议的发送渠道。

---

## Discord（默认设置）

系统使用 OpenClaw 的 Cron 任务进行发送，无需手动执行 `deliver.sh` 脚本。

---

## Slack

系统支持 Slack 的 Webhook 功能。

## Telegram

需要使用 BotFather 提供的令牌和聊天室 ID。

## 通用 Webhook

建议可以通过 JSON POST 格式发送到任意目标端点。

---

## 安全性规定

- 系统仅提出修改建议，不会直接修改 AGENTS.md 文件。
- 通过 `before` 和 `after` 的差异格式明确显示修改内容。
- 必须提供数据支持，否则系统不会提出任何建议。
- 建议只有在用户明确批准后才会被应用，并通过 git 提交。
- 系统会记录拒绝原因，以便在下一个分析周期中参考。
- 分析任务在本地完成，API 调用仅由专门的代理执行一次。
- 全部分析脚本长度约为 400 行，阅读时间约为 15 分钟。
- 系统会在下个周期报告修改建议的实际效果。

---

## 存在的局限性（如实说明）

| 旧版本的限制 | v3.0 的改进 | v4.0 的改进 | v5.0 的改进 |
|----------------|------------------|------------------|----------------|
| 关键词匹配（缺乏语义理解） | 错报率约 40% | 通过提示机制降至约 15% | 通过语义嵌入技术降至约 8% |
| 辅助语言的过滤不够准确 | 会重复计算某些短语（如“再次”、“继续”） | 通过 `role_filter` 机制进行了优化 | 保持不变 |
| 未收录的词汇无法被识别 | 会错过一些需要自动处理的投诉模式 | 仍无法识别 | 通过语义相似度识别未收录的词汇 |
| 无法评估改进效果 | 无法判断建议是否有效 | 通过效果评估循环进行了优化 | 保持不变 |
| 不支持英语会话的投诉模式 | 无法识别英语内容 | 现在支持韩语和英语模式 | 支持自动语言检测 |
| 数据不足时建议质量下降 | 仅提供通用建议 | 问题依旧存在 |
| 初始阶段数据不足 | 无法进行有效分析 | 问题依旧存在 | 通过实时监控解决了这个问题 |
| 只能每周处理一次数据 | 存在分析盲区 | 通过实时监控解决了这个问题 |
| 仅能分析单个代理的会话数据 | 无法分析多个代理的会话数据 | 通过集群分析解决了这个问题 |

## v5.0 进一步的改进计划：

- 更精确地处理混合语言的会话数据。
- 改进效果评估机制，从相关性分析转向因果关系分析（计划在 v5.2 版本实现）。
- 需要单独的流程来处理实时监控任务。
- 集群分析需要至少四周的数据才能得出有意义的趋势。

---

## v5.0 的其他更新（2026-02-18）：

- 新增了 `scripts/v5/embedding-analyze.sh`、`scripts/v5/stream-monitor.sh`、`scripts/v5/fleet-analyzer.sh` 和 `scripts/v5/trend-analyzer.sh` 等脚本，以实现新的功能。
- 更新了 `config.yaml` 和 `docs` 目录，包含了新的架构文档和迁移指南。
- 更新了 `Makefile`，以便构建和测试 v5.0 版本。

---

## v4.3 的其他更新（2026-02-18）：

- 新增了交互式审批流程和 macOS 桌面通知功能。
- 改进了报告输出格式和 GitHub 问题管理功能。
- 更新了 `config.yaml` 和 `scripts` 目录，以支持更多的平台和配置选项。

---

## v4.1 的其他更新：

- 分离了韩语和英语的投诉模式配置。
- 引入了自动语言检测功能。
- 更新了脚本，提升了报告的输出格式和 GitHub 问题管理功能。

---

## v4.0 的其他更新：

- 引入了多代理协同处理的流程。
- 改进了基于上下文的分析机制。
- 优化了效果评估机制。
- 降低了误报率。
- 提高了系统性能，确保总处理时间低于 3 分钟，每次使用的成本低于 0.05 美元。
- 更新了文件目录结构。

---

## 与 self-improving-agent 的区别

| self-improving-agent | self-evolving-agent |
|--|--|
| 处理范围 | 单个会话 | 所有会话（过去 7 天内的数据） |
| 处理时机 | 每个会话结束后立即分析 | 每周日自动分析 |
| 输出内容 | 提供会话的质量评分和改进建议 | 提供 AGENTS.md 文件的差异对比 |
| 优势 | 可立即提供反馈 | 能发现系统中的问题模式 |
| 与 v4.0 的结合使用**：** self-improving-agent 生成会话质量数据，self-evolving-agent 对这些数据进行处理，从而发现系统层面的问题并评估效果。