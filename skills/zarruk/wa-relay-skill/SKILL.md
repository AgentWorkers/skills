---
name: wa-relay
description: "OpenClaw的WhatsApp消息中继功能：将第三方用户的私信（DM）路由到专门的代理服务器，该服务器会通知消息的接收者（即OpenClaw的所有者），并且仅在收到授权后才会进行响应。此功能适用于为第三方联系人设置WhatsApp消息过滤、中继或防火墙的场景。"
---
# wa-relay

该插件会将来自第三方 WhatsApp 的私信（DM）路由到专门的转发代理，该代理会通知消息的所有者，并且只有在获得授权后才会进行回复。

## 工作原理

- **主代理** 仅接收来自所有者的消息。
- **转发代理** 接收来自其他用户的消息，会通知所有者，并且只有在获得明确授权后才会进行回复。

## 设置步骤

1. 运行 `scripts/setup.sh <所有者电话号码>`（例如：`+573001234567`）。
2. 运行 `scripts/configure.sh <所有者电话号码>` 以生成配置文件（JSON 格式）。
3. 将生成的配置文件应用到您的 OpenClaw 设置中（详见 `references/SETUP.md`）。

## 硬件要求

- OpenClaw 版本需达到 v2026.2.14 或更高，并且已配置 WhatsApp 通道。
- 所有者的电话号码必须采用国际格式（例如：`+573001234567`）。

## 安全注意事项

该插件执行两项需要提升权限的操作。这两项操作对于实现多代理 WhatsApp 路由功能是必需的，以下是对这些操作的详细说明：

### 1. 认证凭证的共享
设置脚本会将 `auth-profiles.json` 文件从主代理复制到转发代理。这是必要的，因为 OpenClaw 的各个代理具有独立的认证机制；如果没有共享的凭证，转发代理将无法与任何模型提供者进行身份验证，从而导致服务无法正常运行。脚本在复制凭证之前会请求用户的确认。

### 2. 会话 ID 正则表达式修复（临时措施）
OpenClaw 的会话 ID 验证机制会拒绝 WhatsApp 电话号码格式中包含的 `:` 和 `+` 字符（例如：`agent:wa-relay:whatsapp:+15551234567`）。设置脚本会修改 OpenClaw 的配置文件中的 `SAFE_SESSION_ID_RE` 正则表达式，以允许这些字符的存在。这是一个已知的 bug（openclaw/openclaw#16211），目前已有修复提案（PR #16531）。一旦修复提案被合并，此临时修复措施即可被移除。脚本在修改配置之前会创建备份文件并请求用户的确认。