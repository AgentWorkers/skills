---
name: polymarket-arbitrage
description: 在 Polymarket 的预测市场中监控并执行套利机会。能够识别数学套利（多种结果概率不匹配的情况）、跨市场套利（同一事件在不同市场出现不同价格的情况）以及订单簿中的效率低下问题。适用于用户希望寻找或交易 Polymarket 套利机会、监控预测市场以发现套利机会，或实现自动化交易策略的场景。该工具包含风险管理、盈亏跟踪和警报功能。
---

# Polymarket套利

在Polymarket的预测市场中寻找并执行套利机会。

## 快速入门

### 1. 纸上交易（推荐的第一步）

运行一次扫描以查看当前的可套利机会：

```bash
cd skills/polymarket-arbitrage
pip install requests beautifulsoup4
python scripts/monitor.py --once --min-edge 3.0
```

结果保存在`polymarket_data/arbs.json`文件中。

### 2. 持续监控

每5分钟监控一次，并在新出现的机会时发出警报：

```bash
python scripts/monitor.py --interval 300 --min-edge 3.0
```

使用`Ctrl+C`停止监控。

### 3. 理解结果

每个检测到的套利机会包含以下信息：
- **net_profit_pct**：扣除2%费用后的净利润率
- **risk_score**：0-100，分数越低风险越小
- **volume**：市场流动性
- **action**：应采取的行动（买入/卖出所有结果）

好的套利机会应满足以下条件：
- 净利润率：3-5%以上
- 风险评分：<50
- 市场成交量：>100万美元
- 套利类型：`math_arb_buy`（更安全）

## 检测到的套利类型

### 数学套利（主要关注）

**类型A：买入所有结果**（概率总和<100%）
- 最安全的套利类型
- 如果能够执行，可以保证盈利
- 例如：48% + 45% = 93% → 扣除费用后净利润约为5%

**类型B：卖出所有结果**（概率总和>100%）
- 风险较高（需要足够的流动性）
- 需要资金作为抵押
- 在有经验之前请避免尝试

详细示例和策略请参阅`references/arbitrage_types.md`。

### 跨市场套利

同一事件在不同市场上的价格不同（尚未实现——需要语义匹配功能）。

### 订单簿套利

需要实时订单簿数据（Polymarket首页显示的是中间价，而非可执行价格）。

## 脚本

### fetch_markets.py

从Polymarket首页抓取活跃市场的信息。

```bash
python scripts/fetch_markets.py --output markets.json --min-volume 50000
```

返回包含市场概率、成交量和元数据的JSON数据。

### detect_arbitrage.py

分析市场中的套利机会。

```bash
python scripts/detect_arbitrage.py markets.json --min-edge 3.0 --output arbs.json
```

脚本考虑了以下因素：
- 每笔交易的2%手续费
- 多个结果的手续费计算
- 风险评分

### monitor.py

持续监控并触发警报。

```bash
python scripts/monitor.py --interval 300 --min-edge 3.0 [--alert-webhook URL]
```

功能包括：
- 定期获取市场数据
- 检测套利机会
- 仅对新出现的套利机会发出警报（避免重复通知）
- 将监控状态保存到`polymarket_data/`目录中

## 工作流程阶段

### 第1阶段：纸上交易（1-2周）

**目标：**了解套利机会的频率和质量

1. 每天运行监控脚本2-3次
2. 将检测到的机会记录在电子表格中
3. 确认这些机会在后续仍可执行
4. 计算可能的利润

**决策点：**如果每周发现3-5个好的套利机会，进入第2阶段。

### 第2阶段：小额测试（50-100加元）

**目标：**熟悉平台操作

1. 创建Polymarket账户
2. 存入50-100加元的USDC
3. 仅进行手动交易（不使用自动化工具）
4. 每次交易的最大金额不超过5-10加元
5. 在电子表格中记录每笔交易

**决策点：**如果20笔交易后盈利，进入第3阶段。

### 第3阶段：扩大规模（500加元）

**目标：**增加每次交易的金额

1. 将资金增加到500加元
2. 每笔交易的最大金额不超过5%（即25加元）
3. 仍然采用手动交易方式
4. 实施严格的风险管理

### 第4阶段：自动化（未来计划）

需要以下条件：
- 钱包集成（管理私钥）
- Polymarket API或浏览器自动化工具
- 执行逻辑
- 监控系统

**只有在手动交易持续盈利后，才考虑自动化。**

详细设置指南请参阅`references/getting_started.md`。

## 风险管理

### 重要规则

1. **每次交易的最大持仓比例：**资金总额的5%
2. **最低净利润率：**扣除费用后的3%
3. **每日亏损限额：**资金总额的10%
4. **优先选择买入套利**：在有经验之前，避免卖出套利

### 警示信号

- 净利润率超过10%：数据可能过时
- 市场成交量低于10万美元：存在流动性风险
- 概率数据最近更新：套利机会可能已经消失
- 卖出套利：需要更多的资金和流动性

## 费用结构

Polymarket的收费标准：
- **做市商费用：**0%
- **撮合商费用：**2%

**保守估计：**每笔交易收取2%的费用

**盈亏平衡计算：**
- 2个结果的市场：需要4%的毛利利润率
- 3个结果的市场：需要6%的毛利利润率
- N个结果的市场：需要N%的毛利利润率

**目标：**扣除费用后的净利润为3-5%

## 常见问题

### “利润率很高，但随后消失了”

Polymarket首页显示的概率可能是过时的数据，代表的是中间价而非可执行价格。真实的套利机会通常会在几秒钟内消失。

### “无法以显示的价格执行交易”

可能是流动性问题。成交量低的市场会导致概率显示不准确。请选择成交量大于100万美元的市场。

### “扣除费用后的利润率太低”

调整`--min-edge`阈值。可以尝试将阈值设置为4-5%，以获得更严格的筛选标准。

## 文件和数据

所有监控数据存储在`./polymarket_data/`目录中：
- `markets.json`：最新的市场扫描结果
- `arbs.json`：检测到的套利机会
- `alert_state.json`：已通知的套利机会状态（避免重复通知）

## 高级主题

### Telegram集成（未来计划）

将Webhook地址传递给监控脚本，以便接收警报：

```bash
python scripts/monitor.py --alert-webhook "https://api.telegram.org/bot<token>/sendMessage?chat_id=<id>"
```

### 持仓规模调整

对于一个有p₁和p₂两个结果的数学套利机会（p₁ + p₂ < 100%）：

**最佳分配方式：**
- 对结果1的投注金额：（100% / p₁） / [(100%/p₁) + (100%/p₂)] 的资金
- 对结果2的投注金额：（100% / p₂） / [(100%/p₁) + (100%/p₂)] 的资金

这样可以确保无论哪个结果获胜，都能获得相同的利润。

**简化规则：**对于利润率较低的情况，将资金平均分配给两个结果。

### 执行速度

套利机会消失得很快。如果计划使用自动化工具：
- 使用WebSocket连接（而非轮询）
- 同时下达限价单
- 提前准备好足够的资金
- 监控Polygon网络的Gas费用

## 资源

- **Polymarket官网：** https://polymarket.com
- **文档：** https://docs.polymarket.com
- **API（如可用）：** 查看Polymarket的官方文档
- **社区：** Polymarket的Discord频道

## 帮助支持

- 如有技术问题，请参阅`references/arbitrage_types.md`了解策略细节
- 参考`references/getting_started.md`获取设置帮助
- 查看`polymarket_data/`目录中的输出文件
- 确保已安装以下依赖库：`pip install requests beautifulsoup4`