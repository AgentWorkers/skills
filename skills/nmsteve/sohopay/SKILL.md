---
name: sohopay
description: "使用 EIP-712 签名在 SOHO Pay 信用层发起支付。"
---
# SOHO Pay - 信用层支付功能

该功能允许代理通过SOHO Pay的`Creditor`智能合约，使用`spendWithAuthorization` EIP-712流程来发起支付操作。

代理使用预先配置的钱包在链下签署支付授权，随后代表用户将交易提交到网络中。

## 核心命令

使用该功能的主要方式是通过以下自然语言命令：

`pay <金额> to <商户地址>`

- `<金额>`：要支付的金额（例如：`10`、`0.5`）。
- `<商户地址>`：接收方的EVM地址（格式为`0x...`）。**不支持使用名称**，且该功能不会生成随机地址。

## 工作流程

当该功能被触发时，脚本会执行以下操作：

1. **解析输入**：从用户请求中提取金额和商户地址。
2. **验证商户地址**：确认商户是一个有效的EVM地址；否则直接终止操作。
3. **预检查**：在签署之前，进行一系列检查以确保交易能够成功：
    - 验证借款人是否已注册且处于活跃状态。
    - 检查借款人的信用额度是否足够。
4. **生成授权信息**：为支付生成一个符合EIP-712格式的授权消息。
5. **链下签名**：使用环境变量中配置的`PRIVATE_KEY`钱包对授权消息进行签名。
6. **链上执行**：调用`Creditor`合约上的`spendWithAuthorization`函数，并传递已签名的授权消息。
7. **返回结果**：在交易确认后，将交易哈希值返回给用户。

## 配置要求

- **环境变量（运行时）**：必须通过`PRIVATE_KEY`环境变量提供用于签名的私钥。
- **技能元数据**：该技能将`PRIVATE_KEY`声明为必需的敏感信息，**仅用于测试网环境下的签名操作**。
- **网络**：所有交易都在**Base Sepolia**测试网上执行。如果连接到主网或其他非Base Sepolia网络，脚本将终止操作。

## 默认值

为保持一致性，脚本中硬编码了以下默认值：

- **Creditor合约地址**：`0x669324C8c8011c3C0cA31faFBdD9C76219C06dB1`
- **借款人管理合约地址**：`0xFdcb4abf261944383dbac37cB8E9147E50E2a609`
- **资产（USDC）地址**：`0x08B1797bB535C4cf86f93424137Cb3e004476624`（6位小数）
- **支付计划ID**：`0`

## 安全性与测试网使用注意事项

- 该功能仅允许使用**TESTNET-ONLY**私钥，**严禁**使用主网或实际资金钱包。
- 该功能**仅适用于Base Sepolia网络**。如果连接到其他网络，脚本将终止操作。
- 代理**无法自动调用**该功能，必须由用户或更高级别的工作流程手动触发。
- 必须明确提供商户的`merchant_address`；如果地址错误，测试网上的资金可能会被错误地发送到其他账户。
- 该功能不会生成随机商户地址，对于非有效的商户地址，系统会拒绝执行支付请求。

## 使用示例

> `pay 10 to 0x1234567890abcdef1234567890abcdef12345678`

此命令将在Base Sepolia网络上触发一笔10 USDC的支付操作，签名工作由配置好的测试网钱包完成。