---
name: claude-code-usage
description: æ£€æŸ¥ Claude Code çš„ OAuth ä½¿ç”¨é™åˆ¶ï¼ˆä¼šè¯é™åˆ¶å’Œæ¯å‘¨é…é¢ï¼‰ã€‚å½“ç”¨æˆ·è¯¢é—® Claude Code çš„ä½¿ç”¨æƒ…å†µã€å‰©ä½™é™åˆ¶ã€é€ŸçŽ‡é™åˆ¶æˆ–ä»–ä»¬è¿˜å‰©å¤šå°‘ä½¿ç”¨é‡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¤åŠŸèƒ½ã€‚è¯¥åŠŸèƒ½è¿˜åŒ…æ‹¬è‡ªåŠ¨ä¼šè¯åˆ·æ–°æé†’ä»¥åŠé‡ç½®æ£€æµ‹ç›‘æŽ§ã€‚
metadata:
  clawdbot:
    emoji: "ðŸ“Š"
    os:
      - darwin
      - linux
    requires:
      bins:
        - curl
---

# Claude Code ä½¿ç”¨è¯´æ˜Ž

è¯·æŸ¥çœ‹æ‚¨çš„ Claude Code OAuth API ä½¿ç”¨é™åˆ¶ï¼ŒåŒ…æ‹¬ä¼šè¯é™åˆ¶ï¼ˆ5å°æ—¶ï¼‰å’Œæ¯å‘¨é™åˆ¶ï¼ˆ7å¤©ï¼‰ã€‚

## å¿«é€Ÿå…¥é—¨

```bash
cd {baseDir}
./scripts/claude-usage.sh
```

## ä½¿ç”¨æ–¹æ³•

```bash
# Default: show cached usage (if fresh)
./scripts/claude-usage.sh

# Force refresh from API
./scripts/claude-usage.sh --fresh

# JSON output
./scripts/claude-usage.sh --json

# Custom cache TTL
./scripts/claude-usage.sh --cache-ttl 300
```

## è¾“å‡ºç»“æžœ

**æ–‡æœ¬æ ¼å¼**ï¼ˆé»˜è®¤ï¼‰ï¼š
```
ðŸ¦ž Claude Code Usage

â±ï¸  Session (5h): ðŸŸ¢ â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘ 40%
   Resets in: 2h 15m

ðŸ“… Weekly (7d): ðŸŸ¡ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 60%
   Resets in: 3d 8h
```

**JSON æ ¼å¼**ï¼ˆä½¿ç”¨ `--json` å‚æ•°ï¼‰ï¼š
```json
{
  "session": {
    "utilization": 40,
    "resets_in": "2h 15m",
    "resets_at": "2026-01-19T22:15:00Z"
  },
  "weekly": {
    "utilization": 60,
    "resets_in": "3d 8h",
    "resets_at": "2026-01-22T04:00:00Z"
  },
  "cached_at": "2026-01-19T20:00:00Z"
}
```

## ä¸»è¦åŠŸèƒ½

- ðŸ“Š **ä¼šè¯é™åˆ¶**ï¼ˆ5å°æ—¶å‘¨æœŸï¼‰â€”â€”çŸ­æœŸé€ŸçŽ‡é™åˆ¶
- ðŸ“… **æ¯å‘¨é™åˆ¶**ï¼ˆ7å¤©å‘¨æœŸï¼‰â€”â€”é•¿æœŸé€ŸçŽ‡é™åˆ¶
- âš¡ **æ™ºèƒ½ç¼“å­˜**â€”â€”60ç§’ç¼“å­˜æœºåˆ¶ï¼Œé˜²æ­¢ API è¿‡åº¦è¯·æ±‚
- ðŸŽ¨ **ç¾Žè§‚çš„è¾“å‡ºç•Œé¢**â€”â€”è¿›åº¦æ¡ã€è¡¨æƒ…ç¬¦å·ã€é¢œè‰²ç¼–ç çš„çŠ¶æ€æç¤º
- ðŸ”„ **å¼ºåˆ¶åˆ·æ–°**â€”â€”ä½¿ç”¨ `--fresh` å‚æ•°å¯ç»•è¿‡ç¼“å­˜
- ðŸ“¤ **JSON æ ¼å¼è¾“å‡º**â€”â€”æœºå™¨å¯è¯»çš„æ ¼å¼
- ðŸ”” **è‡ªåŠ¨ç›‘æŽ§**â€”â€”å½“é…é¢é‡ç½®æ—¶æ”¶åˆ°é€šçŸ¥

## çŠ¶æ€æŒ‡ç¤ºå™¨

- ðŸŸ¢ **ç»¿è‰²**â€”â€”ä½¿ç”¨é‡åœ¨ 0-50% ä¹‹é—´ï¼ˆæ­£å¸¸ï¼‰
- ðŸŸ¡ **é»„è‰²**â€”â€”ä½¿ç”¨é‡åœ¨ 51-80% ä¹‹é—´ï¼ˆä¸­ç­‰ï¼‰
- ðŸ”´ **çº¢è‰²**â€”â€”ä½¿ç”¨é‡åœ¨ 81-100% ä¹‹é—´ï¼ˆé«˜/ä¸´ç•Œï¼‰

## ç³»ç»Ÿè¦æ±‚

- **macOS**ï¼šä½¿ç”¨ Keychain å­˜å‚¨ Claude Code å‡­æ®
- **Linux**ï¼šä½¿ç”¨ `secret-tool` å­˜å‚¨å‡­è¯
- **å‡­è¯è¦æ±‚**ï¼šå¿…é¡»é€šè¿‡ Claude Code CLI è¿›è¡Œèº«ä»½éªŒè¯

## å·¥ä½œåŽŸç†

1. ä»Žç³»ç»Ÿ Keychain ä¸­èŽ·å– OAuth ä»¤ç‰Œ
2. ä½¿ç”¨ OAuth ä»¤ç‰Œå‘ `api.anthropic.com/api/oauth/usage` å‘é€è¯·æ±‚
3. è§£æž `five_hour` å’Œ `seven_day` çš„ä½¿ç”¨é‡æ•°æ®
4. è®¡ç®—é…é¢é‡ç½®å‰çš„å‰©ä½™æ—¶é—´
5. ä»¥è¿›åº¦æ¡å’ŒçŠ¶æ€æŒ‡ç¤ºå™¨çš„å½¢å¼å±•ç¤ºè¾“å‡ºç»“æžœ
6. ç»“æžœç¼“å­˜ 60 ç§’ï¼ˆå¯é…ç½®ï¼‰

## ç¼“å­˜è®¾ç½®

é»˜è®¤ç¼“å­˜è·¯å¾„ï¼š`/tmp/claude-usage-cache`ï¼ˆç¼“å­˜æœ‰æ•ˆæœŸ 60 ç§’ï¼‰

**ç¼“å­˜é…ç½®ä¿®æ”¹**ï¼š
```bash
CACHE_FILE=/tmp/my-cache CACHE_TTL=300 ./scripts/claude-usage.sh
```

## ä½¿ç”¨ç¤ºä¾‹

**å¼€å§‹å·¥ä½œå‰æ£€æŸ¥ä½¿ç”¨æƒ…å†µï¼š**
```bash
./scripts/claude-usage.sh --fresh
```

**ä¸ŽçŠ¶æ€æ é›†æˆï¼š**
```bash
usage=$(./scripts/claude-usage.sh | grep "Session" | awk '{print $NF}')
echo "Session: $usage"
```

**èŽ·å– JSON æ•°æ®ä»¥ä¾›ç›‘æŽ§ï¼š**
```bash
./scripts/claude-usage.sh --json | jq '.session.utilization'
```

## è‡ªåŠ¨ç›‘æŽ§

### ä¼šè¯åˆ·æ–°æé†’ï¼ˆæŽ¨èï¼‰

å½“æ‚¨çš„ 5 å°æ—¶ä¼šè¯é…é¢å³å°†é‡ç½®æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æé†’æ‚¨ï¼

**å¿«é€Ÿè®¾ç½®æ­¥éª¤ï¼š**
```bash
./scripts/session-reminder.sh
```

æ­¤è®¾ç½®ä¼šåˆ›å»ºä¸€ä¸ªè‡ªåŠ¨è°ƒåº¦çš„ cron ä»»åŠ¡é“¾ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š
1. æ£€æŸ¥å½“å‰ä¼šè¯çš„è¿‡æœŸæ—¶é—´
2. å®‰æŽ’ä¸‹ä¸€æ¬¡ä¼šè¯åˆ·æ–°çš„æé†’
3. å‘æ‚¨å‘é€å½“å‰çš„ä½¿ç”¨é‡ç»Ÿè®¡ä¿¡æ¯
4. ä»»åŠ¡å®ŒæˆåŽè‡ªåŠ¨åˆ é™¤ï¼ˆæ–°çš„ cron ä»»åŠ¡ä¼šæŽ¥ç®¡ï¼‰

**æ‚¨å°†èŽ·å¾—ï¼š**
```
ðŸ”„ Claude Code Session Status

â±ï¸  Current usage: 44%
â° Next refresh: 2h 15m

Your 5-hour quota will reset soon! ðŸ¦ž

âœ… Next reminder scheduled for: Jan 22 at 01:22 AM
```

**å·¥ä½œåŽŸç†ï¼š**
- æ¯ä¸ªæé†’ä»»åŠ¡ä¼šè¿è¡Œ `claude-usage.sh` è„šæœ¬ä»¥èŽ·å–å‡†ç¡®çš„ä¼šè¯é‡ç½®æ—¶é—´
- ä¸ºè¯¥æ—¶é—´ç‚¹å®‰æŽ’ä¸€æ¬¡æ€§çš„ cron ä»»åŠ¡
- æ¯ 5 å°æ—¶è‡ªåŠ¨é‡å¤æ‰§è¡Œä¸€æ¬¡
- å¦‚æžœä¼šè¯æ—¶é—´å‘ç”Ÿåå·®ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒæ•´æé†’æ—¶é—´

**ä¼˜åŠ¿ï¼š**
- âœ… ç²¾ç¡®åˆ°åˆ†é’Ÿ
- âœ… æ— éœ€æ‰‹åŠ¨è°ƒåº¦
- âœ… ä¼šæ ¹æ®æ‚¨çš„å®žé™…ä½¿ç”¨æƒ…å†µè‡ªåŠ¨è°ƒæ•´
- âœ… å‡å°‘ä¸å¿…è¦çš„ API è¯·æ±‚ï¼ˆä»…åœ¨å¿…è¦æ—¶è°ƒç”¨ï¼‰

### é…é¢é‡ç½®æ£€æµ‹ï¼ˆå¯é€‰ï¼‰

å½“æ‚¨çš„ Claude Code é…é¢é‡ç½®æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å‘é€é€šçŸ¥ï¼š

**å¿«é€Ÿè®¾ç½®æ­¥éª¤ï¼š**
```bash
# Test once
./scripts/monitor-usage.sh

# Setup automated monitoring (runs every 30 minutes)
./scripts/setup-monitoring.sh
```

æˆ–è€…é€šè¿‡ Clawdbot ç›´æŽ¥é…ç½®ï¼š
```bash
# Check every 30 minutes
clawdbot cron add --cron "*/30 * * * *" \
  --message "cd /Users/ali/clawd/skills/claude-code-usage && ./scripts/monitor-usage.sh" \
  --name "Claude Code Usage Monitor" \
  --session isolated --deliver --channel telegram
```

**æ‚¨å°†èŽ·å¾—ï¼š**
```
ðŸŽ‰ Claude Code Session Reset!

â±ï¸  Your 5-hour quota has reset
ðŸ“Š Usage: 2%
â° Next reset: 4h 58m

Fresh usage available! ðŸ¦ž
```

**å·¥ä½œåŽŸç†ï¼š**
- **æ¯ 30 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ä½¿ç”¨é‡**ï¼ˆå¯é…ç½®ï¼‰
- **å½“ä½¿ç”¨é‡å‘ç”Ÿæ˜¾è‘—å˜åŒ–ï¼ˆ>10% æˆ– <5%ï¼‰æ—¶æ£€æµ‹é…é¢é‡ç½®**
- **é€šè¿‡ Telegram å‘é€é€šçŸ¥**
- **åœ¨ `/tmp/claude-usage-state.json` æ–‡ä»¶ä¸­è®°å½•çŠ¶æ€å˜åŒ–**

**è‡ªå®šä¹‰è®¾ç½®ï¼š**
```bash
# Change check interval
clawdbot cron add --cron "*/15 * * * *" ...  # Every 15 minutes
clawdbot cron add --cron "0 * * * *" ...      # Every hour

# Custom state file location
STATE_FILE=/path/to/state.json ./scripts/monitor-usage.sh
```

### é€‰æ‹©å“ªç§ç›‘æŽ§æ–¹å¼ï¼Ÿ

| åŠŸèƒ½          | ä¼šè¯æé†’        | é…é¢é‡ç½®æ£€æµ‹        |
|---------------|-----------------|-----------------|
| ç²¾ç¡®åº¦          | âœ… ç²¾ç¡®åˆ°åˆ†é’Ÿ        | çº¦ 30 åˆ†é’Ÿçš„ç»Ÿè®¡çª—å£     |
| API è°ƒç”¨æ¬¡æ•°       | æœ€å°åŒ–          | æ¯æ¬¡æ£€æŸ¥éƒ½ä¼šè°ƒç”¨      |
| é€šçŸ¥æ—¶é—´        | é…é¢é‡ç½®æ—¶ç«‹å³å‘é€    | æœ€å¤šå»¶è¿Ÿ 30 åˆ†é’Ÿ      |
| è®¾ç½®éš¾åº¦        | ä»…éœ€ä¸€æ¡å‘½ä»¤       | éœ€è¦é…ç½® cron ä»»åŠ¡     |
| ç»´æŠ¤æˆæœ¬        | è‡ªåŠ¨è°ƒåº¦          | cron ä»»åŠ¡æŒç»­è¿è¡Œ      |

**å»ºè®®ï¼š** é€‰æ‹© **ä¼šè¯æé†’** ä»¥èŽ·å¾—æœ€å‡†ç¡®ã€å®žæ—¶çš„é€šçŸ¥ã€‚

## å¸¸è§é—®é¢˜è§£å†³æ–¹æ³•

**æœªæ‰¾åˆ°å‡­è¯ï¼š**
- ç¡®ä¿å·²å®‰è£…å¹¶ç™»å½• Claude Code CLI
- è¿è¡Œ `claude` å‘½ä»¤ä»¥è§¦å‘ OAuth è®¤è¯æµç¨‹

**API è¯·æ±‚å¤±è´¥ï¼š**
- æ£€æŸ¥ç½‘ç»œè¿žæŽ¥æ˜¯å¦æ­£å¸¸
- ç¡®è®¤ OAuth ä»¤ç‰Œæœªè¿‡æœŸ
- å°è¯•ä½¿ç”¨ `--fresh` å‚æ•°å¼ºåˆ¶é‡æ–°è¯·æ±‚

**Linux ç”¨æˆ·ï¼š**
è¯·å®‰è£… `libsecret` ä»¥æ”¯æŒå‡­è¯å­˜å‚¨ï¼š
```bash
# Debian/Ubuntu
sudo apt install libsecret-tools

# Fedora/RHEL
sudo dnf install libsecret
```