---
name: acestep-simplemv
description: 使用 Remotion 从音频文件和歌词生成音乐视频。该工具支持输入音频文件、LRC/JSON 格式的歌词以及视频标题，能够生成包含波形可视化效果和同步歌词显示的 MP4 视频。适用于需要生成音乐视频、从音频或歌词创建视频，或对歌曲进行可视化的场景。
---

# MV Render

该工具用于根据音频文件和歌词文件生成包含波形可视化效果及同步歌词的音乐视频。

## 先决条件

- 该功能依赖于 `scripts/` 目录下的 Remotion 项目。
- 已安装 Node.js 及其相关依赖包（npm）。
- 必须安装 `ffprobe`（用于检测音频文件的时长）。

### 首次使用前的设置

在使用该工具之前，请检查并安装所有必要的依赖包：

```bash
# 1. Check Node.js
node --version

# 2. Install npm dependencies
cd {project_root}/{.claude or .codex}/skills/acestep-simplemv/scripts && npm install

# 3. Check ffprobe
ffprobe -version
```

如果系统中没有 `ffprobe`，请安装 `ffmpeg`（`ffprobe` 包含在 `ffmpeg` 中）：
- **Windows**：使用 `choco install ffmpeg` 进行安装，或从 https://ffmpeg.org/download.html 下载后将其添加到系统路径（PATH）中。
- **macOS**：使用 `brew install ffmpeg` 进行安装。
- **Linux**：在 Debian/Ubuntu 系统中使用 `sudo apt-get install ffmpeg`，在 Fedora 系统中使用 `sudo dnf install ffmpeg`。

## 快速入门

执行脚本后，输出文件将保存在 `out/<audio_basename>.mp4`（或根据 `--output` 参数指定的路径）中。

## 脚本用法

```bash
./scripts/render-mv.sh --audio <file> --lyrics <lrc_file> --title "Title" [options]

Options:
  --audio        Audio file path (absolute paths supported)
  --lyrics       LRC format lyrics file (timestamped)
  --lyrics-json  JSON lyrics file [{start, end, text}] (alternative to --lyrics)
  --title        Video title (default: "Music Video")
  --subtitle     Subtitle text
  --credit       Bottom credit text
  --offset       Lyric timing offset in seconds (default: -0.5)
  --output       Output file path (default: out/<audio_basename>.mp4)
  --codec        h264|h265|vp8|vp9 (default: h264)
  --browser      Custom browser executable path (Chrome/Edge/Chromium)

Environment variables:
  BROWSER_EXECUTABLE  Path to browser executable (overrides auto-detection)
```

## 浏览器检测

Remotion 需要基于 Chromium 的浏览器来生成视频。脚本会按以下优先级自动检测浏览器：
1. `BROWSER_EXECUTABLE` 环境变量
2. `--browser` 命令行参数
3. Remotion 自动下载的 `chrome-headless-shell` 工具
4. 系统自带的 Chrome 浏览器（默认使用 `--chrome-mode=chrome-for-testing` 模式）
5. **系统自带的 Edge 浏览器**（Windows 10/11 自带，默认使用 `--chrome-mode=chrome-for-testing` 模式）
6. 系统自带的 Chromium 浏览器（默认使用 `--chrome-mode=chrome-for-testing` 模式）

**注意**：新版 Chrome/Edge 已移除了旧的头less 模式。使用普通版本的 Chrome/Edge 时，脚本会自动设置 `--chrome-mode=chrome-for-testing`（此时使用 `--headless=new` 模式）；如果使用 `chrome-headless-shell`，则会使用默认的头less 模式（此时使用 `--headless=old` 模式）。这一过程是透明的。

如果无法找到合适的浏览器，Remotion 会尝试从 Google 服务器下载 `chrome-headless-shell`。**如果网络无法访问 Google 服务器，此操作将失败。**

### 网络受限环境下的解决方法

由于 Windows 10/11 系统预装了 Edge 浏览器，因此系统应能自动检测到该浏览器并使用正确的头less 模式。如果自动检测失败，可以尝试以下方法：

```bash
# Option 1: Set environment variable
export BROWSER_EXECUTABLE="/path/to/msedge.exe"

# Option 2: Pass as CLI argument
./scripts/render-mv.sh --audio song.mp3 --lyrics song.lrc --title "Song" --browser "/path/to/msedge.exe"

# Option 3: Enable proxy and let Remotion download chrome-headless-shell
```

## 示例

```bash
# Basic render
./scripts/render-mv.sh --audio /tmp/abc123_1.mp3 --lyrics /tmp/abc123.lrc --title "夜桜"

# Custom output path
./scripts/render-mv.sh --audio song.mp3 --lyrics song.lrc --title "My Song" --output /tmp/my_mv.mp4

# With subtitle and credit
./scripts/render-mv.sh --audio song.mp3 --lyrics song.lrc --title "Song" --subtitle "Artist Name" --credit "Generated by ACE-Step"
```

## 文件命名规则

**重要提示**：请使用音频文件的作业 ID 作为输出文件的名称，以避免文件覆盖。**请勿使用自定义名称（例如 `--output my_song.mp4`）**，让脚本根据音频文件名自动生成文件名。

默认的输出文件命名规则如下：
- 音频文件：`acestep_output/{job_id}_1.mp3`
- 歌词文件：`acestep_output/{job_id}_1.lrc`
- 视频文件：使用 `--output acestep_output/{job_id}.mp4`（其中 `{job_id}` 来自音频文件名）

示例：如果音频文件名为 `chatcmpl-abc123_1.mp3`，则应使用 `--output acestep_output/chatcmpl-abc123.mp4`。

## 标题格式要求

- `--title` 参数应简短且为单行（最多 50 个字符，超出长度会自动截断）
- 使用 `--subtitle` 参数添加额外信息
- **请勿在 `--title` 参数中包含换行符**

正确示例：`--title "Open Source" --subtitle "ACE-Step v1.5"`
错误示例：`--title "Open Source - ACE-Step v1.5\nCelebrating Music AI"`

## 其他说明

- 使用绝对路径的音频文件会被 `render.mjs` 脚本自动复制到 `public/` 目录中。
- 音频文件的时长由 `ffprobe` 自动检测。
- 通常情况下，90 秒长的音频文件渲染时间约为 1-2 分钟。
- 输出视频的分辨率为 1920x1080，帧率为 30fps。