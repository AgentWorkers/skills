---
name: swift-architecture-skill
description: 适用于 Swift 架构设计与实现模式的代理技能，提供特定于架构的实践指南和审查清单。在为新功能设计、重构现有模块、审查 Pull Request 时，或在 SwiftUI/UIKit 项目中调试可维护性问题时，若需要关于 MVVM、MVI、TCA、Clean Architecture、VIPER 或 Reactive 模式的具体指导，可参考此技能。
---
# Swift 架构技能

## 概述

使用此技能为 SwiftUI/UIKit 代码库选择最适合的架构方案，并将其应用于用户的任务中。

## 工作流程

### 第 1 步：分析请求背景

在选择架构之前，需要收集以下信息：
- 任务类型（新功能、重构、代码审查、调试）
- UI 框架（SwiftUI、UIKit 或混合使用）
- 应用范围（单屏幕、多屏幕、全应用）
- 需要保留的现有开发规范

### 第 2 步：选择架构

如果用户明确指定了所需的架构，请直接使用该架构；否则，请阅读 `references/selection-guide.md` 文件，并根据实际情况（如状态复杂性、团队熟悉度、测试目标、框架偏好等）来推断最合适的架构。简要说明推荐的理由。

**常见架构参考文档**：
- MVVM → `references/mvvm.md`
- MVI → `references/mvi.md`
- TCA → `references/tca.md`
- Clean Architecture → `references/clean-architecture.md`
- VIPER → `references/viper.md`
- Reactive → `references/reactive.md`

### 第 3 步：分析现有代码库（如适用）

如果代码已经存在，请执行以下操作：
- 识别当前的架构和依赖注入（DI）风格
- 注意并发模型（异步/await、Combine、GCD、混合使用）
- 确保推荐方案符合本地开发规范

### 第 4 步：生成具体交付成果

阅读所选架构的参考文档，并将其指导内容转化为适用于用户需求的实际成果：
- **文件和模块结构**：包含特定于该功能的文件和目录布局
- **状态与依赖关系**：明确的状态类型、协议以及依赖注入的实现方式
- **异步处理策略**：包括取消机制、actor 隔离以及错误处理方式
- **测试策略**：确定需要测试的内容、如何模拟依赖项以及测试结构的示例
- **迁移路径**（针对重构任务）：从当前架构逐步迁移到目标架构的步骤
- **UI 框架适配**：说明在所选架构下 SwiftUI 和 UIKit 的使用差异

### 第 5 步：使用检查表进行验证

最后，使用参考文档中提供的特定于该架构的代码审查检查表，根据用户的具体需求进行调整。

## 输出要求：
- 确保建议仅针对请求的功能或审查任务。
- 倡导基于协议的依赖注入和明确的状态建模。
- 指出现有代码中的不良实践并提供相应的修复方案。
- 在所有异步处理流程中加入取消机制和错误处理。
- 编写代码时，仅包含与任务相关的部分内容，避免复制整个架构方案。
- 默认情况下，将参考文档中的示例代码视为说明性内容；只有在用户要求提供可运行代码时，才提供完整的编译环境。
- 仅提出必要的问题；否则，请在开始之前明确说明所有假设。
- 在审查代码提交（PR）时，使用特定的架构检查表，并针对具体问题指出错误并进行修复。