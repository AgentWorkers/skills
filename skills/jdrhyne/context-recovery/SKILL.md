---
name: context-recovery
description: åœ¨ä¼šè¯å‹ç¼©åï¼Œæˆ–è€…å½“éœ€è¦ç»§ç»­ä¼šè¯ä½†ä¸Šä¸‹æ–‡ä¿¡æ¯ä¸¢å¤±æ—¶ï¼Œèƒ½å¤Ÿè‡ªåŠ¨æ¢å¤å·¥ä½œçŠ¶æ€ã€‚è¯¥åŠŸèƒ½æ”¯æŒ Discordã€Slackã€Telegramã€Signal ä»¥åŠå…¶ä»–å—æ”¯æŒçš„èŠå¤©å¹³å°ã€‚
metadata: {"clawdbot":{"emoji":"ğŸ”„"}}
---

# ä¸Šä¸‹æ–‡æ¢å¤

åœ¨ä¼šè¯è¢«å‹ç¼©åï¼Œæˆ–è€…å½“éœ€è¦ç»§ç»­å¯¹è¯ä½†ä¸Šä¸‹æ–‡ç¼ºå¤±æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ¢å¤å¯ç”¨çš„å·¥ä½œä¸Šä¸‹æ–‡ã€‚è¯¥åŠŸèƒ½æ”¯æŒ Discordã€Slackã€Telegramã€Signal ç­‰å¹³å°ã€‚

**ä½¿ç”¨åœºæ™¯**ï¼šä¼šè¯å¼€å§‹æ—¶ä¸Šä¸‹æ–‡è¢«æˆªæ–­ï¼›ç”¨æˆ·åœ¨æ²¡æœ‰æä¾›è¯¦ç»†ä¿¡æ¯çš„æƒ…å†µä¸‹æåŠä¹‹å‰çš„å·¥ä½œï¼›æˆ–è€…å‡ºç°ä¼šè¯å‹ç¼©çš„æç¤ºã€‚

---

## è§¦å‘æ¡ä»¶

### è‡ªåŠ¨è§¦å‘æ¡ä»¶
- ä¼šè¯ä»¥ `<summary>` æ ‡ç­¾å¼€å¤´ï¼ˆæ£€æµ‹åˆ°ä¼šè¯è¢«å‹ç¼©ï¼‰
- ç”¨æˆ·æ¶ˆæ¯ä¸­åŒ…å«ä¼šè¯å‹ç¼©çš„æç¤ºä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šâ€œSummary unavailableâ€ï¼ˆæ‘˜è¦ä¸å¯ç”¨ï¼‰ã€â€œcontext limitsâ€ï¼ˆä¸Šä¸‹æ–‡é™åˆ¶ï¼‰æˆ–â€œtruncatedâ€ï¼ˆå†…å®¹è¢«æˆªæ–­ï¼‰

### æ‰‹åŠ¨è§¦å‘æ¡ä»¶
- ç”¨æˆ·å‘é€â€œcontinueâ€ï¼ˆç»§ç»­ï¼‰ã€â€œdid this happen?â€ï¼ˆå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿï¼‰ã€â€œwhere were we?â€ï¼ˆæˆ‘ä»¬åˆšæ‰åœ¨è®¨è®ºä»€ä¹ˆï¼Ÿï¼‰æˆ–â€œwhat was I working on?â€ï¼ˆæˆ‘åœ¨åšä»€ä¹ˆï¼Ÿï¼‰
- ç”¨æˆ·æåŠâ€œthe projectâ€ï¼ˆé¡¹ç›®ï¼‰ã€â€œthe PRâ€ï¼ˆåˆå¹¶è¯·æ±‚ï¼‰ã€â€œthe branchâ€ï¼ˆåˆ†æ”¯ï¼‰æˆ–â€œthe issueâ€ï¼ˆé—®é¢˜ï¼‰ï¼Œä½†æ²¡æœ‰æ˜ç¡®å…·ä½“æŒ‡ä»£
- ç”¨æˆ·è¡¨ç¤ºä¹‹å‰æœ‰å·¥ä½œå†…å®¹ï¼Œä½†ä¸Šä¸‹æ–‡ä¸æ˜ç¡®
- ç”¨æˆ·è¯¢é—®â€œdo you remember...?â€ï¼ˆä½ è®°å¾—å—ï¼Ÿï¼‰æˆ–â€œwe were working on...â€ï¼ˆæˆ‘ä»¬ä¹‹å‰åœ¨è®¨è®ºä»€ä¹ˆï¼Ÿï¼‰

---

## æ‰§è¡Œæµç¨‹

### ç¬¬ä¸€æ­¥ï¼šæ£€æµ‹å½“å‰ä½¿ç”¨çš„é€šé“

ä»è¿è¡Œæ—¶ä¸Šä¸‹æ–‡ä¸­æå–ä»¥ä¸‹ä¿¡æ¯ï¼š
- `channel`ï¼šDiscordã€Slackã€Telegramã€Signal ç­‰å¹³å°çš„é€šé“åç§°
- `channelId`ï¼šå…·ä½“çš„é€šé“/å¯¹è¯ ID
- `threadId`ï¼šå¯¹äºåˆ†å±‚çš„å¯¹è¯ï¼ˆå¦‚ Slack å’Œ Discord çš„çº¿ç¨‹ï¼‰ï¼Œéœ€è¦è·å–çº¿ç¨‹ ID

### ç¬¬äºŒæ­¥ï¼šè·å–é€šé“å†å²è®°å½•ï¼ˆè‡ªé€‚åº”æ·±åº¦ï¼‰

**åˆå§‹è·å–ï¼š**
```
message:read
  channel: <detected-channel>
  channelId: <detected-channel-id>
  limit: 50
```

**è‡ªé€‚åº”æ‰©å±•é€»è¾‘ï¼š**
1. ä»è¿”å›çš„æ¶ˆæ¯ä¸­è§£ææ—¶é—´æˆ³
2. è®¡ç®—æ—¶é—´è·¨åº¦ï¼š`newest_timestamp - oldest_timestamp`
3. å¦‚æœæ—¶é—´è·¨åº¦å°äº 2 å°æ—¶ä¸”æ¶ˆæ¯æ•°é‡å°äºç­‰äºé™åˆ¶å€¼ï¼ˆ`limit`ï¼‰ï¼š
   - å†è·å– 50 æ¡æ¶ˆæ¯ï¼ˆå¦‚æœå¹³å°æ”¯æŒ `before` å‚æ•°ï¼Œåˆ™ä½¿ç”¨è¯¥å‚æ•°ï¼‰
   - é‡å¤æ­¤æ­¥éª¤ï¼Œç›´åˆ°æ—¶é—´è·¨åº¦å¤§äºç­‰äº 2 å°æ—¶æˆ–æ€»æ¶ˆæ¯æ•°é‡å¤§äºç­‰äº 100 æ¡
4. æœ€å¤§è·å– 100 æ¡æ¶ˆæ¯ï¼ˆå—ä»¤ç‰Œé¢„ç®—é™åˆ¶ï¼‰

**é’ˆå¯¹åˆ†å±‚å¯¹è¯çš„æ¢å¤æœºåˆ¶ï¼ˆSlack/Discordï¼‰ï¼š**
```
# If threadId is present, fetch thread messages first
message:read
  channel: <detected-channel>
  threadId: <thread-id>
  limit: 50

# Then fetch parent channel for broader context
message:read
  channel: <detected-channel>
  channelId: <parent-channel-id>
  limit: 30
```

**è§£æå†…å®¹ï¼š**
- ç”¨æˆ·æœ€è¿‘æå‡ºçš„è¯·æ±‚
- è¾…åŠ©ç³»ç»Ÿæœ€è¿‘çš„å›å¤å†…å®¹
- URLã€æ–‡ä»¶è·¯å¾„ã€åˆ†æ”¯åç§°ã€åˆå¹¶è¯·æ±‚ï¼ˆPRï¼‰ç¼–å·
- æœªå®Œæˆçš„æ“ä½œï¼ˆç”¨æˆ·æå‡ºä½†æœªå®Œæˆçš„ä»»åŠ¡ï¼‰
- é¡¹ç›®æ ‡è¯†ç¬¦å’Œå·¥ä½œç›®å½•

### ç¬¬ä¸‰æ­¥ï¼šè·å–ä¼šè¯æ—¥å¿—ï¼ˆå¦‚æœå¯ç”¨ï¼‰

```bash
# Find most recent session files for this agent
SESSION_DIR=$(ls -d ~/.clawdbot-*/agents/*/sessions 2>/dev/null | head -1)
SESSIONS=$(ls -t "$SESSION_DIR"/*.jsonl 2>/dev/null | head -3)

for SESSION in $SESSIONS; do
  echo "=== Session: $SESSION ==="
  
  # Extract user requests
  jq -r 'select(.message.role == "user") | .message.content[0].text // empty' "$SESSION" | tail -20
  
  # Extract assistant actions (look for tool calls and responses)
  jq -r 'select(.message.role == "assistant") | .message.content[]? | select(.type == "text") | .text // empty' "$SESSION" | tail -50
done
```

### ç¬¬å››æ­¥ï¼šæ£€æŸ¥å…±äº«å†…å­˜ä¸­çš„ä¿¡æ¯

```bash
# Extract keywords from channel history (project names, PR numbers, branch names)
# Search memory for relevant entries
grep -ri "<keyword>" ~/clawd-*/memory/ 2>/dev/null | head -10

# Check for recent daily logs
ls -t ~/clawd-*/memory/202*.md 2>/dev/null | head -3 | xargs grep -l "<keyword>" 2>/dev/null
```

### ç¬¬äº”æ­¥ï¼šåˆæˆä¸Šä¸‹æ–‡

æ•´ç†å¹¶ç”Ÿæˆç»“æ„åŒ–çš„æ‘˜è¦ï¼š

```markdown
## Recovered Context

**Channel:** #<channel-name> (<platform>)
**Time Range:** <oldest-message> to <newest-message>
**Messages Analyzed:** <count>

### Active Project/Task
- **Repository:** <repo-name>
- **Branch:** <branch-name>
- **PR:** #<number> â€” <title>

### Recent Work Timeline
1. [<timestamp>] <action/request>
2. [<timestamp>] <action/request>
3. [<timestamp>] <action/request>

### Pending/Incomplete Actions
- â³ "<quoted incomplete action>"
- â³ "<another incomplete item>"

### Key References
| Type | Value |
|------|-------|
| PR | #<number> |
| Branch | <name> |
| Files | <paths> |
| URLs | <links> |

### Last User Request
> "<quoted request that may not have been completed>"

### Confidence Level
- Channel context: <high/medium/low>
- Session logs: <available/partial/unavailable>
- Memory entries: <found/none>
```

### ç¬¬å…­æ­¥ï¼šç¼“å­˜æ¢å¤çš„ä¸Šä¸‹æ–‡

å°†æ¢å¤çš„ä¸Šä¸‹æ–‡ä¿å­˜åˆ°å†…å­˜ä¸­ï¼Œä»¥ä¾›åç»­ä½¿ç”¨ï¼š

```bash
# Write to daily memory file
MEMORY_FILE=~/clawd-*/memory/$(date +%Y-%m-%d).md

cat >> "$MEMORY_FILE" << EOF

## Context Recovery â€” $(date +%H:%M)

**Channel:** #<channel-name>
**Recovered context for:** <project/task summary>

### Key State
- <bullet points of critical context>

### Pending Items
- <incomplete actions>

EOF
```

è¿™æ ·å¯ä»¥åœ¨æœªæ¥çš„ä¼šè¯å‹ç¼©ä¸­ä¿ç•™ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚

### ç¬¬ä¸ƒæ­¥ï¼šå±•ç¤ºæ¢å¤çš„ä¸Šä¸‹æ–‡

å±•ç¤ºæ¢å¤çš„ä¸Šä¸‹æ–‡ï¼Œå¹¶æç¤ºç”¨æˆ·ï¼š
> â€œä¸Šä¸‹æ–‡å·²æ¢å¤ã€‚æ‚¨ä¸Šæ¬¡çš„è¯·æ±‚æ˜¯ [X]ã€‚è¯¥æ“ä½œ [å·²å®Œæˆ/æœªå®Œæˆ]ã€‚æ‚¨æ˜¯å¦å¸Œæœ› [ç»§ç»­/é‡è¯•/è¿›ä¸€æ­¥è¯´æ˜]ï¼Ÿâ€

---

## å„å¹³å°ç‰¹å®šè¯´æ˜

### Discord
- ä½¿ç”¨æ¥è‡ªä¼ å…¥æ¶ˆæ¯å…ƒæ•°æ®çš„ `channelId`
- å…¬ä¼šé€šé“å¯ä»¥è®¿é—®å®Œæ•´çš„ä¼šè¯å†å²è®°å½•
- å¯¹äºåˆ†å±‚å¯¹è¯ï¼Œéœ€è¦æ£€æŸ¥æ¶ˆæ¯å…ƒæ•°æ®ä¸­çš„ `threadId`
- ç§äººæ¶ˆæ¯ï¼ˆDMï¼‰çš„å†å²è®°å½•å¯èƒ½æœ‰é™

### Slack
- ä½¿ç”¨ `channel` å‚æ•°å’Œ Slack é€šé“ ID
- åˆ†å±‚å¯¹è¯çš„ä¸Šä¸‹æ–‡éœ€è¦ `threadId`ï¼Œè¯·åŠ¡å¿…å…ˆæ£€æŸ¥è¯¥ä¿¡æ¯
- é€šè¿‡çˆ¶é€šé“å¯ä»¥è·å–å®Œæ•´çš„å¯¹è¯ä¸Šä¸‹æ–‡
- å¯èƒ½éœ€è¦å·¥ä½œåŒºçº§åˆ«çš„æƒé™æ‰èƒ½è®¿é—®å…¨éƒ¨å†å²è®°å½•

### Telegram / Signal / å…¶ä»–å¹³å°
- ä½¿ç”¨ç›¸åŒçš„ `message:read` æ¥å£
- ä¸åŒå¹³å°çš„å†å²è®°å½•æ·±åº¦å¯èƒ½æœ‰æ‰€ä¸åŒ
- ç»„å†…å¯¹è¯å’Œç§ä¿¡çš„ä¸Šä¸‹æ–‡å¯èƒ½å­˜åœ¨å·®å¼‚

---

## é™åˆ¶æ¡ä»¶
- **å¼ºåˆ¶è¦æ±‚**ï¼šåœ¨å›å¤â€œæ•°æ®ä¸è¶³â€æˆ–è¯¢é—®è¡¥å……ä¿¡æ¯ä¹‹å‰ï¼Œå¿…é¡»å…ˆæ‰§è¡Œä¸Šè¿°æ¢å¤æµç¨‹
- è‡ªé€‚åº”æ‰©å±•æ·±åº¦ï¼šåˆå§‹è·å– 50 æ¡æ¶ˆæ¯ï¼Œæœ€å¤šæ‰©å±•åˆ° 100 æ¡
- æ—¶é—´ç›®æ ‡ï¼šå°½å¯èƒ½æ•è·è‡³å°‘ 2 å°æ—¶çš„ä¼šè¯å†…å®¹
- ä¼šè¯æ—¥å¿—çš„è·å–èŒƒå›´ï¼šæœ€å¤šè·å–æœ€è¿‘ 3 ä¸ªä¼šè¯çš„æ—¥å¿—æ–‡ä»¶
- å†…å­˜ç¼“å­˜ï¼šå°†æ¢å¤çš„ä¸Šä¸‹æ–‡è¿½åŠ åˆ°æ¯æ—¥æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œé¿å…è¦†ç›–åŸæœ‰å†…å®¹
- å¦‚æœæ¢å¤å¤±è´¥ï¼Œéœ€è¯´æ˜å°è¯•äº†å“ªäº›æ“ä½œä»¥åŠå“ªäº›æ•°æ®æºæ— æ³•è·å–

---

## è‡ªåŠ¨è§¦å‘æœºåˆ¶çš„æ£€æµ‹

åœ¨ä¼šè¯å¼€å§‹æ—¶ï¼Œç³»ç»Ÿä¼šæ‰«ææ˜¯å¦å­˜åœ¨ä¼šè¯å‹ç¼©çš„æç¤ºä¿¡æ¯ï¼š

```python
# Pseudocode for trigger detection
if message contains "<summary>":
    trigger_context_recovery()
elif message contains any of ["Summary unavailable", "context limits", "truncated", "compacted"]:
    trigger_context_recovery()
elif message matches continuation_patterns:
    # "continue", "where were we", "did this happen", etc.
    trigger_context_recovery()
```

**æ— éœ€ç­‰å¾…ç”¨æˆ·æé—®**â€”â€”å¦‚æœæ£€æµ‹åˆ°ä¼šè¯è¢«å‹ç¼©ï¼Œç³»ç»Ÿä¼šä¸»åŠ¨æ¢å¤ä¸Šä¸‹æ–‡å¹¶å±•ç¤ºç»™ç”¨æˆ·ã€‚

---

## ç¤ºä¾‹

**åœºæ™¯**ï¼šä¼šè¯å¼€å§‹æ—¶æ˜¾ç¤ºäº†å‹ç¼©æç¤º

```
User message: "<summary>Summary unavailable due to context limits...</summary>"
User message: "did this happen?"
```

**è¾…åŠ©ç³»ç»Ÿçš„å¤„ç†æµç¨‹ï¼š**
1. é€šè¿‡ `<summary>` æ ‡ç­¾æ£€æµ‹åˆ°ä¼šè¯è¢«å‹ç¼©
2. å‘é€è¯·æ±‚ï¼š`message:read channel=discord channelId=1460342116516364533 limit=50`
3. è®¡ç®—æ—¶é—´è·¨åº¦ï¼š2.5 å°æ—¶ï¼ˆè¶³å¤Ÿçš„æ—¶é—´èŒƒå›´ï¼Œæ— éœ€è¿›ä¸€æ­¥æ‰©å±•ï¼‰
4. è§£ææ¶ˆæ¯ï¼Œæ‰¾åˆ°ç”¨æˆ·æœ€åçš„è¯·æ±‚ï¼šâ€œç°åœ¨æˆ‘æ¥æå–ä¸ PR #137ï¼ˆSkills & Agents Systemï¼‰ç›¸å…³çš„ç¼–æ’å†³ç­–â€¦â€
5. æ£€æŸ¥ä¼šè¯æ—¥å¿—ï¼Œæå–ç”¨æˆ·æœ€è¿‘çš„è¯·æ±‚å†…å®¹
6. å°†ä¸Šä¸‹æ–‡æ‘˜è¦ä¿å­˜åˆ° `memory/YYYY-MM-DD.md` æ–‡ä»¶ä¸­
7. å›å¤ç”¨æˆ·ï¼š
> â€œä¸Šä¸‹æ–‡å·²æ¢å¤ã€‚æ‚¨ä¸Šæ¬¡çš„è¯·æ±‚æ˜¯æå–ä¸ PR #137 ç›¸å…³çš„ç¼–æ’å†³ç­–ã€‚ç”±äºä¸Šä¸‹æ–‡è¢«æˆªæ–­ï¼Œè¯¥æ“ä½œæœªèƒ½å®Œæˆã€‚
>
> **æ¢å¤çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼š**
> - PR #137ï¼šåŒ…å« 15,053 ä¸ªæ–°å¢å†…å®¹ï¼Œæ¶‰åŠ 91 ä¸ªæ–‡ä»¶ï¼Œå­˜åœ¨åˆå¹¶å†²çª
> - ç›¸å…³æ–‡ä»¶ä½ç½®ï¼š`content/spec-skills-agents-system.md`ï¼ˆ2,067 è¡Œï¼‰
> - ä¼šè¯æ–‡ä»¶ä½ç½®ï¼š`~/.clawdbot-duke-leto/archive/nexus-sessions/`ï¼ˆ96 ä¸ªæ–‡ä»¶ï¼‰
>
> æ‚¨æ˜¯å¦å¸Œæœ›ç»§ç»­æ‰§è¡Œæå–æ“ä½œï¼Ÿ**