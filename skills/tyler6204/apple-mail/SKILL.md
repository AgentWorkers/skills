---
name: apple-mail
description: macOSä¸Šçš„Apple Mail.appé›†æˆåŠŸèƒ½ï¼šæ‚¨å¯ä»¥å¿«é€Ÿç›´æ¥åœ°æŸ¥çœ‹æ”¶ä»¶ç®±ã€æœç´¢é‚®ä»¶ã€å‘é€é‚®ä»¶ã€å›å¤é‚®ä»¶ä»¥åŠç®¡ç†æ¶ˆæ¯ï¼ˆæ— éœ€é€ä¸€æµè§ˆé‚®ä»¶åˆ—è¡¨ï¼‰ã€‚
metadata: {"clawdbot":{"emoji":"ğŸ“§","os":["darwin"],"requires":{"bins":["sqlite3"]}}}
---

# Apple Mail

æ‚¨å¯ä»¥é€šè¿‡ AppleScript å’Œ SQLite ä¸ Mail.app è¿›è¡Œäº¤äº’ã€‚è„šæœ¬çš„æ‰§è¡Œè·¯å¾„ä¸ºï¼š`cd {baseDir}`

## å‘½ä»¤

| å‘½ä»¤ | ç”¨æ³• |
|---------|-------|
| **åˆ·æ–°** | `scripts/mail-refresh.sh [account] [wait_seconds]` |
| åˆ—å‡ºæœ€è¿‘çš„æ¶ˆæ¯ | `scripts/mail-list.sh [mailbox] [account] [limit]` |
| æœç´¢ | `scripts/mail-search.sh "query" [mailbox] [limit]` |
| å¿«é€Ÿæœç´¢ | `scripts/mail-fast-search.sh "query" [limit]` |
| é˜…è¯»é‚®ä»¶ | `scripts/mail-read.sh <message-id> [message-id...]` |
| åˆ é™¤é‚®ä»¶ | `scripts/mail-delete.sh <message-id> [message-id...]` |
| æ ‡è®°ä¸ºå·²è¯» | `scripts/mail-mark-read.sh <message-id> [message-id...]` |
| æ ‡è®°ä¸ºæœªè¯» | `scripts/mail-mark-unread.sh <message-id> [message-id...]` |
| å‘é€é‚®ä»¶ | `scripts/mail-send.sh "to@email.com" "Subject" "Body" [from-account] [attachment]` Â¹ |
| å›å¤é‚®ä»¶ | `scripts/mail-reply.sh <message-id> "body" [reply-all]` |
| åˆ—å‡ºè´¦æˆ· | `scripts/mail-accounts.sh` |
| åˆ—å‡ºé‚®ç®± | `scripts/mail-mailboxes.sh [account]` |

## åˆ·æ–°é‚®ä»¶

å¼ºåˆ¶ Mail.app æ£€æŸ¥æ˜¯å¦æœ‰æ–°æ¶ˆæ¯ï¼š

```bash
scripts/mail-refresh.sh                    # All accounts, wait up to 10s
scripts/mail-refresh.sh Google             # Specific account only
scripts/mail-refresh.sh "" 5               # All accounts, max 5 seconds
scripts/mail-refresh.sh Google 0           # Google account, no wait
```

**æ™ºèƒ½åŒæ­¥æ£€æµ‹ï¼š**
- è„šæœ¬ä¼šç›‘æ§æ•°æ®åº“ä¸­çš„æ¶ˆæ¯æ•°é‡ï¼›
- å¦‚æœ 2 ç§’å†…æ²¡æœ‰å˜åŒ–ï¼Œåˆ™æå‰è¿”å›ç»“æœï¼›
- å¦‚æœæœ‰æ–°æ¶ˆæ¯ï¼Œä¼šæ˜¾ç¤ºï¼šâ€œåŒæ­¥å®Œæˆï¼ˆ2 ç§’åï¼Œæ–°å¢äº† 3 æ¡æ¶ˆæ¯ï¼‰â€ã€‚

**æ³¨æ„ï¼š**
- Mail.app å¿…é¡»æ­£åœ¨è¿è¡Œä¸­ï¼ˆå¦åˆ™è„šæœ¬ä¼šå‡ºé”™ï¼‰ï¼›
- `mail-list.sh` ä¸ä¼šè‡ªåŠ¨åˆ·æ–°æ•°æ®â€”â€”å¦‚æœéœ€è¦æœ€æ–°æ•°æ®ï¼Œè¯·å…ˆè¿è¡Œ `mail-refresh.sh`ã€‚

## è¾“å‡ºæ ¼å¼

åˆ—è¡¨/æœç´¢ç»“æœæ ¼å¼ï¼š`ID | å·²è¯»çŠ¶æ€ | å‘ä»¶æ—¶é—´ | å‘ä»¶äºº | ä¸»é¢˜`
- `â—` è¡¨ç¤ºæœªè¯»ï¼Œç©ºç™½è¡¨ç¤ºå·²è¯»ã€‚

## Gmail é‚®ç®±

âš ï¸ Gmail çš„ç‰¹æ®Šæ–‡ä»¶å¤¹éœ€è¦åŠ ä¸Š `[Gmail]/` å‰ç¼€ï¼š

| æ˜¾ç¤ºæ–¹å¼ | ä½¿ç”¨æ–¹å¼ |
|----------|-----|
| `Spam` | `[Gmail]/Spam` |
| `Sent Mail` | `[Gmail]/Sent Mail` |
| `All Mail` | `[Gmail]/All Mail` |
| `Trash` | `[Gmail]/Trash` |

è‡ªå®šä¹‰æ ‡ç­¾å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€æ·»åŠ å‰ç¼€ã€‚

## å¿«é€Ÿæœç´¢ï¼ˆä½¿ç”¨ SQLiteï¼‰

âœ¨ **ç°åœ¨å³ä½¿ Mail.app æ­£åœ¨è¿è¡Œä¹Ÿå¯ä»¥ä½¿ç”¨**â€”â€”è„šæœ¬ä¼šå…ˆå°†æ•°æ®åº“å†…å®¹å¤åˆ¶åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­å†è¿›è¡ŒæŸ¥è¯¢ã€‚

```bash
scripts/mail-fast-search.sh "query" [limit]  # ~50ms vs minutes
```

ä»¥å‰éœ€è¦å…³é—­ Mail.app æ‰èƒ½ä½¿ç”¨å¿«é€Ÿæœç´¢åŠŸèƒ½ã€‚ç°åœ¨åªéœ€å°†æ•°æ®åº“å†…å®¹å¤åˆ¶åˆ°ä¸´æ—¶æ–‡ä»¶åå³å¯è¿›è¡ŒæŸ¥è¯¢ã€‚

## æ€§èƒ½è¯´æ˜

**å„æ“ä½œçš„è€—æ—¶ï¼š**
| æ“ä½œ | è€—æ—¶ | å¤‡æ³¨ |
|-----------|-------|-------|
| `mail-fast-search.sh` | çº¦ 50 æ¯«ç§’ | ä½¿ç”¨ SQLite æŸ¥è¯¢ï¼Œé€Ÿåº¦æœ€å¿« |
| `mail-accounts.sh` | å°äº 1 ç§’ | ä½¿ç”¨ç®€å•çš„ AppleScript |
| `mail-list.sh` | 1-3 ç§’ | ä½¿ç”¨ AppleScript ç›´æ¥è®¿é—®é‚®ç®± |
| `mail-send.sh` | 1-2 ç§’ | åˆ›å»ºå¹¶å‘é€é‚®ä»¶ |
| `mail-read.sh` | çº¦ 2 ç§’ | é‡‡ç”¨ä½ç½®ä¼˜åŒ–æŸ¥è¯¢æ–¹å¼ |
| `mail-delete.sh` | çº¦ 0.5 ç§’ | é‡‡ç”¨ä½ç½®ä¼˜åŒ–æŸ¥è¯¢æ–¹å¼ |
| `mail-mark-*.sh` | çº¦ 1.5 ç§’ | é‡‡ç”¨ä½ç½®ä¼˜åŒ–æŸ¥è¯¢æ–¹å¼ |

**ä¼˜åŒ–æŠ€å·§ï¼š**
SQLite æä¾›äº†è´¦æˆ·çš„ UUID å’Œæ¶ˆæ¯çš„å¤§è‡´ä½ç½®ä¿¡æ¯ã€‚AppleScript ä¼šç›´æ¥è·³è½¬åˆ°è¯¥ä½ç½®ï¼Œè€Œä¸æ˜¯ä»å¤´å¼€å§‹éå†ã€‚

**æ”¯æŒæ‰¹é‡æ“ä½œï¼š**
- `mail-read.sh 123 456 789` â€” ä¸€æ¬¡æ€§è¯»å–å¤šå°é‚®ä»¶ï¼ˆå„é‚®ä»¶ä¹‹é—´ç”¨ `=` åˆ†éš”ï¼‰ |
- `mail-delete.sh 123 456 789` â€” ä¸€æ¬¡æ€§åˆ é™¤å¤šå°é‚®ä»¶ |
- `mail-mark-read.sh 123 456` â€” ä¸€æ¬¡æ€§å°†å¤šå°é‚®ä»¶æ ‡è®°ä¸ºå·²è¯» |
- `mail-mark-unread.sh 123 456` â€” ä¸€æ¬¡æ€§å°†å¤šå°é‚®ä»¶æ ‡è®°ä¸ºæœªè¯» |

**âš ï¸ ä¸æ”¯æŒè‡ªåŠ¨åˆ·æ–°ï¼š** è„šæœ¬ä¼šè¯»å–ç¼“å­˜çš„æ•°æ®ã€‚å¦‚æœéœ€è¦æœ€æ–°é‚®ä»¶ï¼Œè¯·å…ˆè¿è¡Œ `mail-refresh.sh`ã€‚

## ç®¡ç†é‚®ä»¶

**åˆ é™¤é‚®ä»¶ï¼š**
```bash
scripts/mail-delete.sh 12345                    # Delete one
scripts/mail-delete.sh 12345 12346 12347        # Delete multiple
```

**æ ‡è®°ä¸ºå·²è¯»/æœªè¯»ï¼š**
```bash
scripts/mail-mark-read.sh 12345 12346           # Mark as read
scripts/mail-mark-unread.sh 12345               # Mark as unread
```

**æ‰¹é‡æ“ä½œç¤ºä¾‹ï¼š**
```bash
# Find spam emails
scripts/mail-fast-search.sh "spam" 50 > spam.txt

# Extract IDs and delete them
grep "^[0-9]" spam.txt | cut -d'|' -f1 | xargs scripts/mail-delete.sh
```

## é˜…è¯»é‚®ä»¶å†…å®¹

```bash
scripts/mail-read.sh 12345              # Single email
scripts/mail-read.sh 12345 12346 12347  # Multiple emails (separated output)
```

é‡‡ç”¨ä½ç½®ä¼˜åŒ–æŸ¥è¯¢æ–¹å¼ï¼ˆæ¯å°é‚®ä»¶å¤§çº¦éœ€è¦ 2 ç§’ï¼‰ã€‚å¤šå°é‚®ä»¶ä¹‹é—´ç”¨ `========` åˆ†éš”ï¼Œæœ€åä¼šæ˜¾ç¤ºé‚®ä»¶æ‘˜è¦ã€‚

## é”™è¯¯ä¿¡æ¯

| é”™è¯¯ | åŸå›  |
|-------|-------|
| `Mail.app æœªè¿è¡Œ` | è¿è¡Œè„šæœ¬å‰è¯·ç¡®ä¿ Mail.app å·²å¯åŠ¨ |
| è´¦æˆ·æœªæ‰¾åˆ° | è´¦æˆ·æ— æ•ˆâ€”â€”è¯·æ£€æŸ¥ `mail-accounts.sh` |
| é‚®ä»¶æœªæ‰¾åˆ° | é‚®ä»¶ ID æ— æ•ˆæˆ–å·²è¢«åˆ é™¤â€”â€”è¯·é€šè¿‡ `mail-list.sh` è·å–æœ€æ–°ä¿¡æ¯ |
| æ— æ³•è·å–é‚®ç®± | é‚®ç®±åç§°æ— æ•ˆâ€”â€”è¯·æ£€æŸ¥ `mail-mailboxes.sh` |
| é‚®ä»¶æ•°æ®åº“æœªæ‰¾åˆ° | SQLite æ•°æ®åº“ç¼ºå¤±â€”â€”è¯·æ£€æŸ¥ `~/Library/Mail/V{9,10,11}/MailData/` |

## æŠ€æœ¯ç»†èŠ‚

**æ•°æ®åº“ä½ç½®ï¼š** `~/Library/Mail/V{9,10,11}/MailData/Envelope Index`

**é‚®ä»¶æŸ¥æ‰¾æ–¹æ³•ï¼ˆç»è¿‡ä¼˜åŒ–ï¼‰ï¼š**
1. å‘ SQLite æŸ¥è¯¢è´¦æˆ·çš„ UUIDã€é‚®ç®±è·¯å¾„å’Œæ¶ˆæ¯çš„å¤§è‡´ä½ç½®ï¼›
2. AppleScript ç›´æ¥è®¿é—®ç›¸åº”çš„è´¦æˆ·ï¼ˆæ— éœ€éå†æ‰€æœ‰é‚®ä»¶ï¼‰ï¼›
3. æœç´¢ä»å¤§è‡´ä½ç½®å¼€å§‹ï¼ˆè¯¯å·®èŒƒå›´ä¸º 5 å°é‚®ä»¶ï¼‰ï¼›
- å¦‚æœä½ç½®ä¿¡æ¯ä¸å‡†ç¡®ï¼Œæ‰ä¼šè¿›è¡Œå…¨é‚®ç®±æœç´¢ã€‚

**å®‰å…¨æ€§ï¼š**
- å¿«é€Ÿæœç´¢ä¼šåœ¨æŸ¥è¯¢å‰å°†æ•°æ®åº“å†…å®¹å¤åˆ¶åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­ï¼›
- å³ä½¿ Mail.app æ­£åœ¨è¿è¡Œï¼Œä¹Ÿå¯ä»¥å®‰å…¨ä½¿ç”¨è¿™äº›è„šæœ¬ï¼›
- åˆ é™¤/é˜…è¯»/æ ‡è®°æ“ä½œä¼šæŸ¥è¯¢å®æ—¶æ•°æ®åº“ï¼Œä½†å¯¹æ•°æ®åº“çš„è®¿é—®é‡å¾ˆå°ã€‚

## å…¶ä»–è¯´æ˜ï¼š
- é‚®ä»¶ ID æ˜¯ç³»ç»Ÿå†…éƒ¨çš„ç¼–å·ï¼Œéœ€è¦é€šè¿‡åˆ—è¡¨/æœç´¢åŠŸèƒ½è·å–æœ€æ–°ä¿¡æ¯ï¼›
- å‘é€é‚®ä»¶å‰è¯·ç¡®è®¤æ”¶ä»¶äººä¿¡æ¯ï¼›
- AppleScript çš„æœç´¢åŠŸèƒ½è™½ç„¶è¾ƒæ…¢ï¼Œä½†æŸ¥è¯¢èŒƒå›´è¾ƒå¹¿ï¼›SQLite åœ¨å¤„ç†å…ƒæ•°æ®æ—¶é€Ÿåº¦è¾ƒå¿«ï¼›
- åˆ é™¤/æ ‡è®°æ“ä½œæ”¯æŒæ‰¹é‡æ“ä½œï¼ˆå¯ä»¥ä¼ é€’å¤šä¸ªé‚®ä»¶ IDï¼‰ï¼›
- å¦‚æœéœ€è¦è·å–æœ€æ–°é‚®ä»¶ï¼Œè¯·åœ¨åˆ—å‡ºé‚®ä»¶ä¹‹å‰å…ˆæ‰§è¡Œåˆ·æ–°æ“ä½œã€‚

Â¹ **å·²çŸ¥é™åˆ¶ï¼š** Mail.app ä¼šåœ¨å·²å‘é€çš„é‚®ä»¶å‰æ·»åŠ ç©ºè¡Œã€‚è¿™æ˜¯ AppleScript å’Œ Mail.app çš„ç³»ç»Ÿè¡Œä¸ºï¼Œæ— æ³•æ›´æ”¹ã€‚