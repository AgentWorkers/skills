---
name: web-monitor
version: 3.1.0
description: "监控网页上的变化、价格下降、库存情况以及自定义条件。适用于用户需要监视/跟踪某个网址、接收价格变动通知、检查商品是否重新上架，或跟踪网站更新的情况。该工具还支持对现有监控项进行添加、删除、检查及报告操作。v3版本新增了变化摘要、可视化差异对比、价格比较功能、模板支持、JavaScript渲染以及Webhook集成。"
metadata:
  {
    "openclaw":
      {
        "emoji": "👁️",
        "requires": { "bins": ["python3", "curl"] },
      },
  }
---
# Web Monitor Pro v3.0.0

Web Monitor Pro v3.0.0 是一款强大的网页监控工具，可实时跟踪任何网页上的变化，包括价格下降、库存更新和内容更改，并在发生变化时发送警报。

## v3.0 的新功能

- **详细的变化说明**：当页面内容发生变化时，会提供具体的说明，例如“价格从 3,899 卢比降至 3,314 卢比（降价 15%）”，而不仅仅是简单显示“价格变化”。
- **可视化差异对比**：提供并排的 HTML 对比结果，通过绿色/红色高亮显示具体差异。
- **价格比较**：可以比较多个店铺的价格，找出最便宜的店铺及其价格优惠幅度。
- **模板**：提供预设的监控模板，只需一条命令即可开始监控价格下降、商品补货或促销活动。
- **JavaScript 渲染**：支持与 Playwright 的集成，适用于需要浏览器加载内容的网站。
- **Webhook**：当满足特定条件时，可以将变化信息发送到 Slack、Discord 或任意指定的 URL。

## 设置

无需 API 密钥，工具使用 `curl` 来获取数据，并将结果存储在 `~/.web-monitor/` 目录下。

运行 `monitor.py setup` 可以查看欢迎信息及快速使用指南。

**可选**：对于依赖 JavaScript 的网站，需要安装 Playwright：`pip3 install playwright && python3 -m playwright install chromium`。

## 快速开始

使用 `watch` 命令即可开始监控。该命令会自动识别页面类型，并设置相应的监控规则：
- 如果是产品页面，会监控价格变化；
- 如果是库存页面，会监控商品是否在售；
- 如果是普通页面，会跟踪页面内容的更新。

## 模板

无需手动配置，预设的模板适用于常见的使用场景：

- `price-drop`：监控价格下降，记录当前价格作为基准。
- `restock`：监控商品是否补货（显示“有货”、“已售罄”等状态）。
- `content-update`：跟踪页面内容的更新。
- `sale`：监控促销信息（如“特价”、“折扣”等关键词）。
- `new-release`：监控新商品或新版本的发布。

每个模板都预先设置了监控条件、检查间隔和优先级。

## 所有命令

所有操作都通过 `scripts/monitor.py` 文件来执行：

### 添加监控规则

**推荐使用 `watch` 命令**：
```bash
monitor.py watch
```

**如需完全控制监控规则，可以使用 `add` 命令**：
```bash
monitor.py add --label "产品价格监控" --selector "#price" --condition "price < 500" --interval 300
```

**`add` 和 `watch` 命令的常用参数**：
- `--label`：监控规则的名称。
- `--selector`：要监控的 CSS 选择器（例如 `#price` 或 `.stock-status`）。
- `--condition`：触发警报的条件。
- `--interval`：检查间隔（单位：分钟，默认为 360 分钟）。
- `--group`：监控规则所属的类别。
- `--priority`：监控优先级（高/中/低，默认为中等）。
- `--target`：价格目标值（例如 3000）。
- `--browser`：对于需要 JavaScript 渲染的页面，使用 Playwright 无头浏览器。
- `--webhook`：变化发生时发送通知的 URL（可同时关联多个 webhook）。

### 检查监控规则

`monitor.py check` 命令会返回包含状态（是否变化）、条件信息、价格数据及详细变化说明的 JSON 数据。

变化说明会提供具体信息：
- 价格监控：例如“价格从 3,899 卢比降至 3,314 卢比（降价 15%），30 天内的最低价格为 3,314 卢比”。
- 库存监控：例如“商品已补货！之前缺货了 3 天”。
- 内容监控：例如“新消息：AI 模型达到了新的基准……”。

当检测到变化时，系统会自动生成差异对比文件，文件路径会显示在 `diff_path` 字段中。

## 可视化差异对比

`diff` 命令会生成一个 HTML 页面，左侧显示旧内容，右侧显示新内容。新增的文本用绿色高亮显示，删除的文本用红色高亮显示，修改的文本用黄色高亮显示。该页面会自动在浏览器中打开。

## 价格比较

可以比较同一组内所有监控规则的价格信息，显示最便宜的店铺及其价格优惠幅度。

## 仪表盘

仪表盘可以一目了然地查看所有监控规则的状态、最后一次检查时间、监控时长、当前价格、目标达成情况以及浏览器/Webhook 的配置状态。监控规则会按类别分组显示。

## 价格趋势

可以查看价格的变化趋势（上涨/下跌/稳定），以及价格的历史数据。

## 管理监控规则

可以对监控规则进行各种操作。

### 备注

可以为任何监控规则添加备注。

### 手动截图

可以立即生成页面快照，并可选性地添加备注。

### 历史记录

系统会记录所有监控规则的历史数据。

### 报告

每周会生成格式化的报告，可通过 WhatsApp 发送。

## 组织管理

可以方便地管理和分组监控规则。

## 导出和导入

支持导出和导入监控规则配置。

## 条件语法

- `price below 500` 或 `price < 500`：当价格低于指定阈值时触发警报。
- `price above 1000` 或 `price > 1000`：当价格高于指定阈值时触发警报。
- `contains 'in stock'`：当页面上出现“有货”等文字时触发警报。
- `not contains 'out of stock'`：当页面上消失“缺货”等文字时触发警报。

## 优先级设置

- **高**：立即触发警报（用火元素符号表示）。
- **中**：正常触发警报（默认设置）。
- **低**：信息汇总到每日/每周的报告。

## JavaScript 渲染

部分网站（如 Takealot、Amazon 和大多数现代单页应用）使用 JavaScript 来加载内容。默认的 `curl` 方法无法获取这些内容。可以使用 `--browser` 参数来启用 Playwright 的无头浏览器进行内容渲染。

**注意**：如果未安装 Playwright，工具会回退到使用 `curl`，但会提示这一限制。请安装 Playwright。

## Webhook

当满足监控条件或页面内容发生变化时，可以通过 Webhook 收到通知。Webhook 会接收包含以下信息的 JSON 数据：
- `monitor_id`：监控规则的唯一标识。
- `label`：监控规则的名称。
- `url`：需要通知的 URL。
- `event_details`：事件详情（状态、条件是否满足、变化说明、当前价格等）。
- `timestamp`：事件发生的时间戳。

## 自动化监控

可以通过 Cron 作业定期检查监控规则并在发生变化时发送警报。建议设置为每 6 小时执行一次（`0 */6 * * *`）。

## 反馈

如果您发现漏洞或有任何建议，请告诉我们。

**注意**：如需提交详细的错误报告，请运行 `monitor.py debug` 以获取系统相关信息。

## 使用技巧

- 对于依赖 JavaScript 的网站，建议使用 `--browser` 参数或 OpenClaw 浏览器工具来获取页面内容。
- 每个监控规则最多保存 50 张快照。
- 每张快照的大小限制为 10KB。
- 使用 `--selector` 参数可以精确监控特定元素，减少不必要的信息。
- 当用户请求“监控这个页面”或“发生变化时通知我”时，可以创建相应的监控规则并设置定时任务。
- 价格目标值会在仪表盘和检查结果中显示进度。
- `watch` 命令是最简单的监控规则设置方式。
- 使用 `template use` 命令可以快速设置监控规则，无需手动配置条件。
- 将相关的监控规则分组，然后使用 `compare` 命令比较价格情况。