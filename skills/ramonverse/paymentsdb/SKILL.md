---
name: stripe
description: 从已同步的 PostgreSQL 数据库中查询 Stripe 客户和账单数据。当用户询问关于 Stripe 客户、订阅服务、发票、费用或任何与 Stripe 相关的信息时，可以使用此功能。
---

所有Stripe数据都存储在PostgreSQL数据库中。您可以通过运行`./query.sh "SELECT now();"`来查询该数据库。

所有的表都位于`stripe`模式下，具体表结构如下：

```sql
CREATE TABLE stripe.accounts (
    _raw_data jsonb NOT NULL,
    first_synced_at timestamp WITH TIMEZONE DEFAULT NOW() NOT NULL,
    _last_synced_at timestamp WITH TIMEZONE DEFAULT NOW() NOT NULL,
    _updated_at timestamp WITH TIMEZONE DEFAULT NOW() NOT NULL,
    business_name TEXT,
    email TEXT,
    type TEXT,
    charges_enabled BOOLEAN,
    payouts_enabled BOOLEAN,
    details_submitted BOOLEAN,
    country TEXT,
    default_currency TEXT,
    created INTEGER,
    api_key_hashes TEXT[] DEFAULT '{}'::TEXT [],
    id TEXT;
);

CREATE TABLE stripe.active_entitlements (
    _updated_at timestamp WITH TIMEZONE DEFAULT 'UTC'::TEXT, NOW() NOT NULL,
    _last_synced_at timestamp WITH TIMEZONE,
    _raw_data jsonb,
    _account_id TEXT NOT NULL,
    object TEXT,
    livemode BOOLEAN,
    feature TEXT,
    customer TEXT,
    lookup_key TEXT,
    id TEXT;
);

CREATE TABLE stripe.balance_transactions (
    _raw_data jsonb NOT NULL,
    _last_synced_at timestamp WITH TIMEZONE,
    _updated_at timestamp WITH TIMEZONE DEFAULT NOW(),
    _account_id TEXT NOT NULL,
    id TEXT,
    object TEXT,
    amount BIGINT,
    available_on INTEGER,
    created INTEGER,
    currency TEXT,
    description TEXT,
    exchange_rate NUMBER,
    fee BIGINT,
    fee_details jsonb,
    net BIGINT,
    reporting_category TEXT,
    source TEXT,
    status TEXT,
    type TEXT;
);

CREATE TABLE stripe.charges (
    _updated_at timestamp WITH TIMEZONE DEFAULT 'UTC'::TEXT, NOW() NOT NULL,
    _last_synced_at timestamp WITH TIMEZONE,
    _raw_data jsonb,
    _account_id TEXT NOT NULL,
    object TEXT,
    paid BOOLEAN,
    "order" TEXT,
    amount BIGINT,
    review TEXT,
    source jsonb,
    status TEXT,
    created INTEGER,
    dispute TEXT,
    invoice TEXT,
    outcome jsonb,
    refunds jsonb,
    updated INTEGER,
    captured BOOLEAN,
    currency TEXT,
    customer TEXT,
    livemode BOOLEAN,
    metadata jsonb,
    refunded BOOLEAN,
    shipping jsonb,
    application TEXT,
    description TEXT,
    destination TEXT,
    failure_code TEXT,
    on_behalf_of TEXT,
    fraud_details jsonb,
    receipt_email TEXT,
    payment_intent TEXT,
    receipt_number TEXT,
    transfer_group TEXT,
    amount_refunded BIGINT,
    application_fee TEXT,
    failure_message TEXT,
    source_transfer TEXT,
    balance_transaction TEXT,
    statement_descriptor TEXT,
    payment_method_details jsonb,
    id TEXT;
);

CREATE TABLE stripe.checkout_session_line_items (
    _updated_at timestamp WITH TIMEZONE DEFAULT 'UTC'::TEXT, NOW() NOT NULL,
    _last_synced_at timestamp WITH TIMEZONE,
    _raw_data jsonb,
    _account_id TEXT NOT NULL,
    object TEXT,
    currency TEXT,
    description TEXT,
    price TEXT,
    quantity INTEGER,
    checkout_session TEXT,
    id TEXT,
    amount_discount BIGINT,
    amount_subtotal BIGINT,
    amount_tax BIGINT,
    amount_total BIGINT;
);

CREATE TABLE stripe.checkout_sessions (
    _updated_at timestamp WITH TIMEZONE DEFAULT 'UTC'::TEXT, NOW() NOT NULL,
    _last_synced_at timestamp WITH TIMEZONE,
    _raw_data jsonb,
    _account_id TEXT NOT NULL,
    object TEXT,
    adaptive_pricing jsonb,
    after_expiration jsonb,
    allow_promotion_codes BOOLEAN,
    automatic_tax jsonb,
    billing_address_collection TEXT,
    cancel_url TEXT,
    client_reference_id TEXT,
    client_secret TEXT,
    collected_information jsonb,
    consent jsonb,
    consent_collection jsonb,
    created INTEGER,
    currency TEXT,
    currency_conversion jsonb,
    custom_fields jsonb,
    custom_text TEXT,
    customer TEXT,
    customer_creation TEXT,
    customer_details jsonb,
    customer_email TEXT,
    discounts jsonb,
    expires_at INTEGER,
    invoice TEXT,
    invoice_creation TEXT,
    livemode BOOLEAN,
    locale TEXT,
    metadata jsonb,
    mode TEXT,
    optional_items jsonb,
    payment_intent TEXT,
    payment_link TEXT,
    payment_method_collection TEXT,
    payment_method_configuration_details jsonb,
    payment_method_options jsonb,
    payment_method_types TEXT,
    payment_status TEXT,
    permissions jsonb,
    phone_number_collection TEXT,
    presentment_details jsonb,
    recovered_from TEXT,
    redirect_on_completion TEXT,
    return_url TEXT,
    saved_payment_method_options jsonb,
    setup_intent TEXT,
    shipping_address_collection TEXT,
    shipping_cost TEXT,
    shipping_details TEXT,
    shipping_options TEXT,
    status TEXT,
    submit_type TEXT,
    subscription TEXT,
    success_url TEXT,
    tax_id_collection TEXT,
    total_details TEXT,
    ui_mode TEXT,
    url TEXT,
    wallet_options TEXT,
    id TEXT,
    amount_subtotal BIGINT,
    amount_total BIGINT;
);

CREATE TABLE stripe.coupons (
    _updated_at timestamp WITH TIMEZONE DEFAULT 'UTC'::TEXT, NOW() NOT NULL,
    _last_synced_at timestamp WITH TIMEZONE,
    _raw_data jsonb,
    object TEXT,
    name TEXT,
    valid BOOLEAN,
    created INTEGER,
    updated INTEGER,
    currency TEXT,
    duration TEXT,
    livemode BOOLEAN,
    metadata jsonb,
    redeem_by INTEGER,
    amount_off BIGINT,
    percent_off DOUBLE PRECISION,
    times_redeemed BIGINT,
    max_redemptions BIGINT,
    duration_in_months BIGINT,
    percent_off_precise DOUBLE PRECISION,
    id TEXT;
);

CREATE TABLE stripe.credit_notes (
    _last_synced_at timestamp WITH TIMEZONE,
    _raw_data jsonb,
    _account_id TEXT NOT NULL,
    object TEXT,
    created INTEGER,
    currency TEXT,
    customer TEXT,
    customer_balance_transaction TEXT,
    discount_amounts jsonb,
    invoice TEXT,
    lines jsonb,
    livemode BOOLEAN,
    memo TEXT,
    metadata jsonb,
    number TEXT,
    pdf TEXT,
    reason TEXT,
    refund TEXT,
    shipping_cost TEXT,
    status TEXT,
    tax_amounts TEXT,
    type TEXT,
    voided_at TEXT,
    id TEXT,
    amount BIGINT,
    amount_shipping BIGINT,
    discount_amount BIGINT,
    out_of_band_amount BIGINT,
    subtotal BIGINT,
    subtotal_excluding_tax BIGINT,
    total BIGINT,
    total_excluding_tax BIGINT;
);

CREATE TABLE stripe.customers (
    _updated_at timestamp WITH TIMEZONE DEFAULT 'UTC'::TEXT, NOW() NOT NULL,
    _last_synced_at timestamp WITH TIMEZONE,
    _raw_data jsonb,
    _account_id TEXT NOT NULL,
    object TEXT,
    address JSONB,
    description TEXT,
    email TEXT,
    metadata jsonb,
    name TEXT,
    phone TEXT,
    shipping JSONB,
    created INTEGER,
    currency TEXT,
    default_source TEXT,
    delinquent BOOLEAN,
    discount JSONB,
    invoice_prefix TEXT,
    invoice_settings JSONB,
    livemode BOOLEAN,
    nextinvoice_sequence INTEGER,
    preferred_locales JSONB,
    tax_exempt TEXT,
    deleted BOOLEAN,
    id TEXT,
    balance BIGINT;
);

CREATE TABLE stripe.disputes (
    _updated_at timestamp WITH TIMEZONE DEFAULT 'UTC'::TEXT, NOW() NOT NULL,
    _last_synced_at timestamp WITH TIMEZONE,
    _raw_data jsonb,
    _account_id TEXT NOT NULL,
    object TEXT,
    amount BIGINT,
    charge TEXT,
    reason TEXT,
    status TEXT,
    created INTEGER,
    updated INTEGER,
    currency TEXT,
    evidence JSONB,
    livemode BOOLEAN,
    metadata JSONB,
    evidence_details JSONB,
    balance_transactions JSONB,
    is_charge_refundable BOOLEAN,
    payment_intent TEXT,
    id TEXT;
);

CREATE TABLE stripe.early_fraudWarnings (
    _updated_at timestamp WITH TIMEZONE DEFAULT 'UTC'::TEXT, NOW() NOT NULL,
    _last_synced_at timestamp WITH TIMEZONE,
    _raw_data JSONB,
    _account_id TEXT NOT NULL,
    object TEXT,
    actionable BOOLEAN,
    charge TEXT,
    created INTEGER,
    fraud_type TEXT,
    livemode BOOLEAN,
    payment_intent TEXT,
    id TEXT;
);

CREATE TABLE stripe.events (
    _updated_at timestamp WITH TIMEZONE DEFAULT 'UTC'::TEXT, NOW() NOT NULL,
    _last_synced_at timestamp WITH TIMEZONE,
    _raw_data JSONB,
    object TEXT,
    data JSONB,
    type TEXT,
    created INTEGER,
    request TEXT,
    updated INTEGER,
    livemode BOOLEAN,
    api_version TEXT,
    pending_webhooks BIGINT,
    id TEXT;
);

CREATE TABLE stripe.exchange_rates_from_usd (
    _raw_data JSONB NOT NULL,
    _last_synced_at timestamp WITH TIMEZONE,
    _updated_at timestamp WITH TIMEZONE DEFAULT NOW(),
    _account_id TEXT NOT NULL,
    date DATE NOT NULL,
    sell_currency TEXT NOT NULL,
    buy_currency_exchange_rates TEXT;
);

CREATE TABLE stripe.features (
    _updated_at timestamp WITH TIMEZONE DEFAULT 'UTC'::TEXT, NOW() NOT NULL,
    _last_synced_at timestamp WITH TIMEZONE,
    _raw_data JSONB,
    _account_id TEXT NOT NULL,
    object TEXT,
    livemode BOOLEAN,
    name TEXT,
    lookup_key TEXT,
    active BOOLEAN,
    metadata JSONB,
    id TEXT;
);

CREATE TABLE stripe.invoices (
    _updated_at timestamp WITH TIMEZONE DEFAULT 'UTC'::TEXT, NOW() NOT NULL,
    _last_synced_at timestamp WITH TIMEZONE,
    _raw_data JSONB,
    _account_id TEXT NOT NULL,
    object TEXT,
    auto_advance BOOLEAN,
    collection_method TEXT,
    currency TEXT,
    description TEXT,
    hosted_invoice_url TEXT,
    lines JSONB,
    period_end INTEGER,
    period_start INTEGER,
    status TEXT,
    total BIGINT,
    account_country TEXT,
    account_name TEXT,
    account_tax_ids JSONB,
    amount_due BIGINT,
    amount_paid BIGINT,
    amount_remaining BIGINT,
    application_fee_amount BIGINT,
    attempt_count INTEGER,
    attempted BOOLEAN,
    billing_reason TEXT,
    created INTEGER,
    custom_fields JSONB,
    customer_address JSONB,
    customer_email TEXT,
    customer_name TEXT,
    customer_phone TEXT,
    customer_shipping JSONB,
    customer_tax_exempt TEXT,
    customer_tax_ids JSONB,
    default_tax_rates JSONB,
    discount JSONB,
    discounts JSONB,
    due_date INTEGER,
    footer TEXT,
    invoice_pdf TEXT,
    last_finalization_error JSONB,
    livemode BOOLEAN,
    next_payment_attempt INTEGER,
    number TEXT,
    paid BOOLEAN,
    payment_settings JSONB,
    receipt_number TEXT,
    statement_descriptor TEXT,
    status_transitions JSONB,
    total_discount_amounts JSONB,
    total_tax_amounts JSONB,
    transfer_data JSONB,
    webhooks_delivered_at INTEGER,
    customer TEXT,
    subscription TEXT,
    payment_intent TEXT,
    default_payment_method TEXT,
    default_source TEXT,
    on_behalf_of TEXT,
    charge TEXT,
    metadata JSONB,
    id TEXT,
    ending_balance BIGINT,
    starting_balance BIGINT,
    subtotal BIGINT,
    tax BIGINT,
    post_payment_credit_notes_amount BIGINT,
    pre_payment_credit_notes_amount BIGINT;
);

CREATE TABLE stripe.payment_intents (
    _last_synced_at timestamp WITH TIMEZONE,
    _raw_data JSONB,
    _account_id TEXT NOT NULL,
    object TEXT,
    amount_details JSONB,
    application TEXT,
    automatic_payment_methods TEXT,
    canceled_at INTEGER,
    cancellation_reason TEXT,
    capture_method TEXT,
    client_secret TEXT,
    confirmation_method TEXT,
    created INTEGER,
    currency TEXT,
    customer TEXT,
    description TEXT,
    invoice TEXT,
    last_payment_error TEXT,
    livemode BOOLEAN,
    metadata JSONB,
    next_action TEXT,
    on_behalf_of TEXT,
    payment_method TEXT,
    payment_method_options JSONB,
    payment_method_types TEXT,
    processing TEXT,
    receipt_email TEXT,
    review TEXT,
    setup_future_usage TEXT,
    shipping JSONB,
    statement_descriptor TEXT,
    statement_descriptor_suffix TEXT,
    status TEXT,
    transfer_data JSONB,
    transfer_group TEXT,
    id TEXT,
    amount BIGINT,
    amount_capturable BIGINT,
    amount_received BIGINT,
    application_fee_amount BIGINT;
);

CREATE TABLE stripe.payment_methods (
    _last_synced_at timestamp WITH TIMEZONE,
    _raw_data JSONB,
    _account_id TEXT NOT NULL,
    object TEXT,
    created INTEGER,
    customer TEXT,
    type TEXT,
    billing_details JSONB,
    metadata JSONB,
    card JSONB,
    id TEXT;
);

CREATE TABLE stripe.payouts (
    _updated_at timestamp WITH TIMEZONE DEFAULT 'UTC'::TEXT, NOW() NOT NULL,
    _last_synced_at timestamp WITH TIMEZONE,
    _raw_data JSONB,
    object TEXT,
    date TEXT,
    type TEXT,
    amount BIGINT,
    method TEXT,
    status TEXT,
    created INTEGER,
    updated INTEGER,
    currency TEXT,
    livemode BOOLEAN,
    metadata JSONB,
    automatic BOOLEAN,
    recipient TEXT,
    description TEXT,
    destination TEXT,
    source_type TEXT,
    arrival_date TEXT,
    bank_account JSONB,
    failure_code TEXT,
    transfer_group TEXT,
    amount_reversed BIGINT,
    failure_message TEXT,
    source_transaction TEXT,
    balance_transaction TEXT,
    statement_descriptor TEXT,
    statement_description TEXT,
    failure_balance_transaction TEXT,
    id TEXT;
);

CREATE TABLE stripe.plans (
    _updated_at timestamp WITH TIMEZONE DEFAULT 'UTC'::TEXT, NOW() NOT NULL,
    _last_synced_at timestamp WITH TIMEZONE,
    _raw_data JSONB,
    _account_id TEXT NOT NULL,
    object TEXT,
    name TEXT,
    tiers JSONB,
    active BOOLEAN,
    amount BIGINT,
    created INTEGER,
    product TEXT,
    updated INTEGER,
    currency TEXT,
    "interval" TEXT,
    livemode BOOLEAN,
    metadata JSONB,
    nickname TEXT,
    tiers_mode TEXT,
    usage_type TEXT,
    billing_scheme TEXT,
    interval_count INTEGER,
    aggregate_usage TEXT,
    transform_usage TEXT,
    trial_period_days INTEGER,
    statement_descriptor TEXT,
    statement_description TEXT,
    id TEXT;
);

CREATE TABLE stripe.prices (
    _updated_at timestamp WITH TIMEZONE DEFAULT 'UTC'::TEXT, NOW() NOT NULL,
    _last_synced_at timestamp WITH TIMEZONE,
    _raw_data JSONB,
    _account_id TEXT NOT NULL,
    object TEXT,
    active BOOLEAN,
    currency TEXT,
    metadata JSONB,
    nickname TEXT,
    recurring TEXT,
    type TEXT,
    billing_scheme TEXT,
    created INTEGER,
    livemode BOOLEAN,
    lookup_key TEXT,
    tiers_mode TEXT,
    transform_usage TEXT,
    unit_amount_decimal TEXT,
    product TEXT,
    id TEXT;
);

CREATE TABLE stripe.products (
    _updated_at timestamp WITH TIMEZONE DEFAULT 'UTC'::TEXT, NOW() NOT NULL,
    _last_synced_at timestamp WITH TIMEZONE,
    _raw_data JSONB,
    _account_id TEXT NOT NULL,
    object TEXT,
    active BOOLEAN,
    default_price TEXT,
    description TEXT,
    metadata JSONB,
    name TEXT,
    images JSONB,
    marketing_features JSONB,
    livemode BOOLEAN,
    package_dimensions TEXT,
    shippable BOOLEAN,
    statement_descriptor TEXT,
    unit_label TEXT,
    updated INTEGER,
    url TEXT,
    id TEXT;
);

CREATE TABLE stripe.refunds (
    _updated_at timestamp WITH TIMEZONE DEFAULT 'UTC'::TEXT, NOW() NOT NULL,
    _last_synced_at timestamp WITH TIMEZONE,
    _raw_data JSONB,
    _account_id TEXT NOT NULL,
    object TEXT,
    balance_transaction TEXT,
    charge TEXT,
    created INTEGER,
    currency TEXT,
    destination_details JSONB,
    metadata JSONB,
    payment_intent TEXT,
    reason TEXT,
    receipt_number TEXT,
    source_transfer_reversal TEXT,
    status TEXT,
    transfer_reversal TEXT,
    id TEXT,
    amount BIGINT;
);

CREATE TABLE stripe.reviews (
    _updated_at timestamp WITH TIMEZONE DEFAULT 'UTC'::TEXT, NOW() NOT NULL,
    _last_synced_at timestamp WITH TIMEZONE,
    _raw_data JSONB,
    _account_id TEXT NOT NULL,
    object TEXT,
    billing_zip TEXT,
    charge TEXT,
    created INTEGER,
    closed_reason TEXT,
    livemode BOOLEAN,
    ip_address TEXT,
    ip_address_location JSONB,
    open BOOLEAN,
    opened_reason TEXT,
    payment_intent TEXT,
    reason TEXT,
    session TEXT,
    id TEXT;
);

CREATE TABLE stripe.setup_intents (
    _last_synced_at timestamp WITH TIMEZONE,
    _raw_data JSONB,
    _account_id TEXT NOT NULL,
    object TEXT,
    created INTEGER,
    customer TEXT,
    description TEXT,
    payment_method TEXT,
    status TEXT,
    usage TEXT,
    cancellation_reason TEXT,
    latest_attempt TEXT,
    mandate TEXT,
    single_use_mandate TEXT,
    on_behalf_of TEXT,
    id TEXT;
);

CREATE TABLE stripe.subscription_item_change_events_v2_beta (
    _raw_data JSONB NOT NULL,
    _last_synced_at timestamp WITH TIMEZONE,
    _updated_at timestamp WITH TIMEZONE DEFAULT NOW(),
    _account_id TEXT NOT NULL,
    event_timestamp TIMESTAMP WITH TIMEZONE NOT NULL,
    event_type TEXT NOT NULL,
    subscription_item_id TEXT NOT NULL,
    currency TEXT,
    mrr_change BIGINT,
    quantity_change BIGINT,
    subscription_id TEXT,
    customer_id TEXT,
    price_id TEXT,
    product_id TEXT,
    local_event_timestamp TEXT;
);

CREATE TABLE stripe.subscription_items (
    _last_synced_at timestamp WITH TIMEZONE,
    _raw_data JSONB,
    _account_id TEXT NOT NULL,
    object TEXT,
    billing_thresholds JSONB,
    created INTEGER,
    deleted BOOLEAN,
    metadata JSONB,
    quantity INTEGER,
    price TEXT,
    subscription TEXT,
    tax_rates JSONB,
    current_period_end INTEGER,
    current_period_start INTEGER,
    id TEXT;
);

CREATE TABLE stripe.subscription_schedules (
    _last_synced_at timestamp WITH TIMEZONE,
    _raw_data JSONB,
    _account_id TEXT NOT NULL,
    object TEXT,
    application TEXT,
    canceled_at INTEGER,
    completed_at INTEGER,
    created INTEGER,
    current_phase JSONB,
    customer TEXT,
    default_settings JSONB,
    end_behavior TEXT,
    livemode BOOLEAN,
    metadata JSONB,
    phases JSONB,
    released_at INTEGER,
    released_subscription TEXT,
    status TEXT,
    subscription TEXT,
    test_clock TEXT,
    id TEXT;
);

CREATE TABLE stripesubscriptions (
    _updated_at timestamp WITH TIMEZONE DEFAULT 'UTC'::TEXT, NOW() NOT NULL,
    _last_synced_at timestamp WITH TIMEZONE,
    _raw_data JSONB,
    _account_id TEXT NOT NULL,
    object TEXT,
    cancel_at_period_end BOOLEAN,
    current_period_end INTEGER,
    current_period_start INTEGER,
    default_payment_method TEXT,
    items JSONB,
    metadata JSONB,
    pending_setup_intent TEXT,
    pending_update JSONB,
    status TEXT,
    application_fee_percent DOUBLE PRECISION,
    billing_cycle_anchor INTEGER,
    billing_thresholds JSONB,
    cancel_at INTEGER,
    canceled_at INTEGER,
    collection_method TEXT,
    created INTEGER,
    days_until_due INTEGER,
    default_source TEXT,
    default_tax_rates JSONB,
    discount JSONB,
    ended_at INTEGER,
    livemode BOOLEAN,
    next_pendinginvoice_item_invoice INTEGER,
    pause_collection JSONB,
    pendinginvoice_item_interval JSONB,
    start_date INTEGER,
    transfer_data JSONB,
    trial_end TEXT,
    trial_start TEXT,
    schedule TEXT,
    customer TEXT,
    latestinvoice TEXT,
    plan TEXT,
    id TEXT;
);

CREATE TABLE stripe.tax_ids (
    _updated_at timestamp WITH TIMEZONE DEFAULT 'UTC'::TEXT, NOW() NOT NULL,
    _raw_data JSONB,
    _account_id TEXT NOT NULL,
    object TEXT,
    country TEXT,
    customer TEXT,
    type TEXT,
    value TEXT,
    created INTEGER,
    livemode BOOLEAN,
    owner JSONB,
    id TEXT;
);
```

这些表包含了Stripe系统的所有核心数据结构，包括账户信息、交易记录、价格设置、优惠券、退款信息等。