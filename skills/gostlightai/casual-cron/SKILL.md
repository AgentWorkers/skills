---
name: casual-cron
description: "**使用自然语言创建具有严格运行规则的Clawdbot定时任务**  
**适用场景：**  
当用户请求安排提醒或消息（无论是定期发送还是一次性发送），尤其是通过Telegram发送时；或者当用户使用命令 `/at` 或 `/every` 来设置定时任务时。  
**示例：**  
- “创建一个每天早上8点的提醒。”  
- “20分钟后提醒我。”  
- “下午3点给我发一条Telegram消息。”  
- “每2小时发送一次消息。”"
metadata: {"openclaw":{"emoji":"⏰","requires":{"bins":["python3","openclaw"],"env":["CRON_DEFAULT_CHANNEL"]}}}
---

# Casual Cron

该工具支持从自然语言生成用于Clawdbot的Cron作业，支持一次性执行和定期执行的任务，并具备安全运行保护机制。

## Cron作业运行规则（硬性规定）

- 在Cron作业执行期间：禁止进行故障排查、禁止重启网关、禁止检查时间。
- 禁止发送任何确认信息或解释性内容。
- 作业执行完成后，仅输出指定的消息内容，然后立即停止。

---

## 工作原理

1. 代理程序从用户输入的消息或`/at`/`every`命令中检测到调度意图。
2. 解析用户提供的时间、执行频率、消息发送渠道和目标接收地址。
3. 根据解析结果生成正确的`openclaw cron add`命令。
4. 在执行任务前，会与用户确认解析后的时间、作业名称和作业ID。

---

## 调度规则

当用户输入以`/at`或`/every`开头的命令时，通过命令行界面（CLI）来调度任务（而非使用Cron工具的API）。

**使用方法：** `openclaw cron add`

### /at（一次性执行）

- 如果用户提供了具体时间（例如“3pm”），系统会将其转换为美国/纽约时区的ISO格式（考虑夏令时）。
- 对于短期提醒，建议使用相对时间表达（例如`--at "20m"`）。
- 必须包含`--delete-after-run`选项，以确保任务执行完成后自动删除。
- 必须包含`--deliver --channel <channel> --to <destination>`选项，以指定消息发送渠道和接收地址。

### /every（定期执行）

- 如果需要指定执行间隔，使用`--every "<duration>"`（无需指定时区）。
- 如果需要指定具体时间，使用`--cron "<expr>" --tz "America/New_York"`。
- 必须包含`--session isolated --message "Output exactly: <task>"`选项，以确保任务在独立会话中执行。
- 必须包含`--deliver --channel <channel> --to <destination>`选项，以指定消息发送渠道和接收地址。

### 确认步骤

在执行任务前，系统会与用户再次确认解析后的时间、作业名称和作业ID。

---

## 命令参考

- **一次性执行（指定时间，考虑夏令时）：** [命令示例]
- **一次性执行（相对时间）：** [命令示例]
- **定期执行（指定时间，考虑夏令时）：** [命令示例]
- **定期执行（指定间隔）：** [命令示例]

---

## 配置选项

| 配置项 | 默认值 |
|---------|---------|
| 默认时区 | `America/New_York`（考虑夏令时） |
| 默认消息发送渠道 | `telegram`（可通过`CRON_DEFAULT_CHANNEL`环境变量进行修改） |
| 支持的消息发送渠道 | telegram、whatsapp、slack、discord、signal |

---

## 支持的时间和频率格式

| 时间格式 | Cron表达式示例 |
|---------|-------------------|
| `8am`    | `0 8 * * *`         |
| `8:45pm`   | `45 20 * * *`         |
| `noon`    | `0 12 * * *`         |
| `midnight`  | `0 0 * * *`         |
| `14:30`   | `14 30 * * *`         |

| 执行频率 | 表示方式            |
|---------|-------------------|
| `daily`   | 每天指定时间         |
| `weekdays` | 周一至周五指定时间         |
| `mondays` | 每周一             |
| `hourly`   | 每小时00分         |
| `every 2 hours` | 每两小时一次         |
| `weekly`   | 每周一次（默认为周一）       |
| `monthly` | 每月1日           |