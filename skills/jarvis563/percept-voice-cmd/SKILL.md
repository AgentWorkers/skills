# percept-voice-cmd

用于 OpenClaw 代理的语音命令检测与执行功能。

## 功能概述

该功能能够检测环境语音中的唤醒词，并将语音命令转发给 OpenClaw 代理进行执行。支持发送电子邮件、文本消息、设置提醒、执行搜索操作、查询日历事件、创建便签以及执行自定义命令。

## 使用场景

- 用户说出唤醒词（如 “Hey Jarvis” 或自定义命令）；
- 用户希望实现无需手动操作即可控制代理的功能；
- 用户需要设置新的语音命令或唤醒词。

## 系统要求

- 必须安装并运行 `percept-listen` 技能；
- 确保 OpenClaw 代理可通过命令行界面（CLI）进行访问。

## 支持的操作类型

| 操作类型 | 示例 |
|--------|---------|
| 发送电子邮件 | “Hey Jarvis, 通知 Rob 报告已经准备好” |
| 发送文本消息 | “Hey Jarvis, 告诉 David 我要迟到了” |
| 设置提醒 | “Hey Jarvis, 30 分钟后提醒我去看牙医” |
| 执行搜索 | “Hey Jarvis, 查看旧金山的天气” |
| 查询日历 | “Hey Jarvis, 今天我的日历上有什么安排？” |
| 创建便签 | “Hey Jarvis, 记录下服务器密码已更改” |
| 其他命令 | “Hey Jarvis, [任意指令]” → 转发至 OpenClaw 代理执行 |

## 唤醒词配置

默认唤醒词：`hey jarvis`、`take notes`、`send an email`。

可通过 Percept 仪表板（端口 8960）→ 设置 → 唤醒词，或直接在数据库中进行配置。

## 工作原理

1. Percept 功能会缓冲接收到的语音数据；
2. 检测到唤醒词后，会延长缓冲区时长 5 秒以完整捕获命令内容；
3. 唤醒词后会有 10 秒的延时窗口，用于接收后续指令（无需再次输入唤醒词）；
4. 采用两级意图解析机制：首先使用正则表达式快速识别指令，对于复杂指令则依赖大型语言模型（LLM）进行解析；
5. 命令的执行会通过地址簿文件（`percept/data/contacts.json`）来确定执行对象；
6. 最终，命令会被发送到 OpenClaw 的命令行界面（CLI）进行执行。

## 说话者权限控制

只有经过授权的说话者才能触发语音命令。权限配置方式如下：
- 在 `percept/data/speakers.json` 文件中，将说话者 ID 与对应的名称关联起来；
- 通过仪表板 → 设置 → 说话者 → 设置说话者的授权状态（批准/所有者）。

未经授权的说话者虽然会被记录在日志中，但其命令不会被执行。

## 链接

- **GitHub 仓库：** https://github.com/GetPercept/percept