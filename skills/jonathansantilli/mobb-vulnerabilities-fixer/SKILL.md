---
name: mobb-vulnerabilities-fixer
description: 使用 Mobb MCP/CLI 扫描、修复并解决本地代码仓库中的安全漏洞。当用户需要扫描漏洞、执行安全检查、自动修复问题或应用 Mobb 提供的修复方案时，可以使用该工具（例如：“扫描这个仓库”、“修复安全问题”、“解决漏洞”、“在我的更改上运行 Mobb”）。
---

# Mobb漏洞修复器

## 概述  
使用 Mobb MCP 的扫描与修复功能来识别本地仓库中的安全问题，并应用生成的补丁。请严格遵循 MCP 的工作流程，包括文件选择、分页以及重新扫描规则。

## 工作流程  

### 扫描与修复（默认设置）  
1. 确认目标仓库路径。  
   使用仓库根目录的绝对路径。拒绝包含遍历模式的路径。如果用户输入了`.`且已知工作区根目录，可以使用该路径。  

2. 确保 Mobb 的身份验证功能可用。  
   建议使用环境变量 `API_KEY` 进行身份验证。如果该变量缺失或无效，系统会弹出一个浏览器窗口，让用户登录并授权 Mobb；授权成功后才能继续操作。如果用户没有账户，请指导他们创建账户并生成 API 密钥。详情请参阅 `references/mobb-auth.md`。  

3. 确保 MCP 已经运行。  
   请勿自行安装或启动 MCP；请用户使用他们授权的进程在本地机器上启动 Mobb MCP 服务器，并确认其正在运行后再进行下一步操作。  

4. 执行 MCP 的扫描与修复任务。  
   调用 `scan_and_fix_vulnerabilities` 工具，并传入仓库路径。只有在用户明确要求时才使用可选参数。  

**必填参数：**  
- `path`：仓库根目录的绝对路径  

**可选参数：**  
- `offset`：用于分页的偏移量  
- `limit`：返回的修复数量上限（默认值为 3）  
- `maxFiles`：扫描最近更改的文件数量（默认值为 10）；设置此参数会触发重新扫描  
- `rescan`：强制进行完整重新扫描（仅在用户明确要求时使用）  
- `scanRecentlyChangedFiles`：如果该参数为 `true` 且未检测到 Git 变更，则从历史记录中扫描最近更改的文件  

5. 仅在用户明确同意的情况下应用修复补丁。  
   如果工具返回了补丁，请汇总修改内容并征求用户的确认后再应用。请严格按照提供的补丁内容进行操作，切勿修改其他内容，并在应用后向用户解释操作结果。如果某个补丁无法应用，请详细说明冲突原因，并继续处理用户已批准的其余补丁。  

6. 绝不要自动重新扫描或自动分页。  
   除非用户明确要求，否则不要自动重新扫描或获取更多修复内容。如果还有更多可用的修复补丁，请告知用户如何请求下一页数据。  

### 获取可用修复补丁（仅提供概要）  
当用户仅需要查看可用修复补丁的概要（而不进行上传、扫描或应用补丁）时，可以使用此功能。  
调用 `fetch_available_fixes`，并传入以下参数：  
- `path`：仓库根目录的绝对路径  
- `offset` 和 `limit`：用于分页的参数  
- `fileFilter`：用于过滤修复文件的相对路径列表  
- `fetchFixesFromAnyFile`：一个布尔值，用于是否从所有文件中获取修复补丁  

`fileFilter` 和 `fetchFixesFromAnyFile` 是互斥的：如果两者均未提供，工具会自动筛选出状态发生变化的文件。  

### 检查是否有新的可用修复补丁（监控功能）  
在编辑或测试结束后，或用户明确要求时，调用 `check_for_new_available_fixes` 功能来检查是否有新的可用修复补丁。  
**注意：**  
- 该功能需要一个包含 `origin` 远程仓库的本地 Git 仓库。  
- 如果启用了自动修复功能，系统可能会自动应用补丁；请用户审核并提交更改。  
- 根据实际情况，该功能可能返回 “初始扫描正在进行中” 或 “没有新的修复补丁”。  

## 文件选择规则（`scan_and_fix_vulnerabilities`）  
- 如果路径是一个有效的 Git 仓库，系统默认只会扫描已更改或处于暂存状态的文件。  
- 如果未检测到任何更改且 `scanRecentlyChangedFiles` 为 `true`（或设置了 `maxFiles`），则会从 Git 历史记录中扫描最近更改的文件。  
- 如果路径不是 Git 仓库，系统会扫描目录中最近更改的文件。  
- 系统会排除大小超过 5 MB 的文件。  

## 无更改情况  
如果未检测到任何更改的文件，系统会向用户说明情况，并提供使用 `scanRecentlyChangedFiles` 和/或 `maxFiles` 进行重新扫描的选项；但除非用户明确请求，否则不会自动执行重新扫描。  

## 参考资源：  
- `references/mcp-scan-fix.md`：MCP 扫描与修复、数据获取及监控工具的详细信息  
- `references/mobb-auth.md`：身份验证和登录流程的详细说明