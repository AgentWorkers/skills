---
name: email-intelligence
description: "使用天气类比来分析电子邮件收件箱的“健康状况”（即收件箱的整洁度），实现垃圾邮件与正常邮件的分类，对邮件进行“信用评分”（即判断邮件的重要性和紧急性），以及检测用户是否在“玩消失”（即是否长时间不回复邮件）。当用户询问收件箱的状态、邮件量是否过多、哪些人在故意不回复邮件，或者邮件处理所花费的时间时，可以使用该功能。该功能需要配置好支持 IMAP 协议的 Himalaya CLI 工具。"
---
# 邮件智能分析

通过创新的天气比喻、智能分类、债务评分以及未读邮件检测功能，来分析您的收件箱状况。将复杂的收件箱分析转化为清晰、可操作的洞察。

## 使用场景

当用户询问以下问题时，可以使用此功能：
- 收件箱的状态或健康状况
- 邮件过多或难以管理的问题
- 自己正在“忽略”哪些人（即未回复他们的邮件）
- 处理收件箱所需的时间成本
- 邮件中的重要信息与杂乱信息的比例
- 未处理的邮件积压情况

## 必备条件

- 配置了 IMAP 访问权限的 **himalaya CLI**
- Python 3.6 或更高版本
- 配置的电子邮件账户应使用标准的文件夹名称（如 INBOX、Archive）

## 快速使用方法

```bash
# Basic analysis (last 7 days)
python3 scripts/email_classify.py

# Extended analysis (last 14 days)
python3 scripts/email_classify.py --days 14

# JSON output for integration
python3 scripts/email_classify.py --format json
```

## 收件箱“天气”状态

收件箱的“天气”状态由需要回复的未读邮件数量决定：

- **🌊 平静的海面**（0-2封邮件）：收件箱状况良好，易于管理
- **🍃 微风**（3-5封邮件）：有少量邮件需要处理，但不紧急
- **🌬️ 波涛汹涌**（6-10封邮件）：多封邮件需要回复
- **⛵ 小型船只警告**（11-20封邮件）：许多人正在等待回复
- **⛈️ 暴风雨预警**（21封及以上邮件）：收件箱负担过重，需要立即处理

## 邮件分类

邮件会自动分为四类：

### 🤖 自动发送的邮件
- 发件人包含以下关键词：noreply、no-reply、donotreply、notifications@、alerts@
- 主题包含以下关键词：unsubscribe、automatic、auto-generated
- 处理时间：0分钟（可以安全忽略）

### 📰 通讯邮件
- 发件人来自：substack.com、email.*、marketing.*、updates@
- 主题包含以下关键词：newsletter、digest、weekly、monthly、roundup
- 处理时间：每封邮件 1分钟（快速浏览或归档）

### 🔔 通知邮件
- 发件人来自：github、slack、jira、linear、aws、google、microsoft 等服务
- 处理时间：每封邮件 30秒（快速处理/确认）

### 👥 人工发送的邮件
- 其他所有邮件（由真人发送）
- 处理时间：每封邮件 3分钟（需要认真回复）

## 指标说明

### 邮件债务评分（0-100分）
根据收件箱中未读的邮件数量及邮件年龄进行评分：
- **< 1 天**：每封邮件 1 分
- **1-3 天**：每封邮件 3 分
- **3-7 天**：每封邮件 5 分
- **7 天以上**：每封邮件 10 分

**评分含义：**
- **0-30 分**：表现优秀！收件箱控制良好
- **31-60 分**：开始忙碌了。建议处理一些未读邮件
- **61-100 分**：债务较高！有许多邮件等待回复

### 重要信息与杂乱信息的比例
显示来自真人（重要信息）的邮件与自动发送/通讯/通知邮件（杂乱信息）的比例。
比例越高，邮件越有价值，垃圾邮件越少。

### 未读邮件报告
显示您“忽略”的最多 5 个人（即未阅读的邮件），按等待时间排序。有助于确定哪些人最急需回复。

### 处理时间预估
根据邮件类型及其处理时间，估算处理当前收件箱所需的时间。

## 输出格式

### 文本格式（默认）
提供易于阅读的报告，包含收件箱状态、债务评分、重要信息与杂乱信息的比例、未读邮件报告以及处理时间预估。非常适合快速了解收件箱状况或进行日常检查。

### JSON 格式
结构化数据，便于与其他工具、API 或仪表板集成：

```json
{
  "weather": {
    "level": "breeze",
    "emoji": "🍃", 
    "description": "Light Breeze - A few emails need attention...",
    "humanCount": 4
  },
  "categories": {
    "automated": 15,
    "newsletter": 8,
    "notification": 12,
    "human": 4
  },
  "debtScore": 18,
  "ghostReport": [...],
  "signalNoiseRatio": {
    "ratio": 0.103,
    "percentage": "10%"
  },
  "timeCost": {
    "minutes": 18,
    "formatted": "18 minutes"
  }
}
```

## 集成建议

### 仪表板集成
JSON 输出格式便于集成到仪表板或状态显示中。天气比喻让用户一目了然地了解收件箱状况。

### 自动化
定期运行脚本（通过 cron 任务）以跟踪收件箱状态的变化。债务评分有助于及时发现需要维护收件箱的情况。

### 警报设置
当以下情况发生时设置警报：
- 收件箱状态达到“暴风雨预警”级别
- 债务评分超过 60 分
- 未读邮件报告显示有人等待回复超过 5 天

## 故障排除

### 未找到邮件
- 确认 Himalaya CLI 是否正确配置：`himalaya envelope list -f INBOX --page-size 1`
- 检查文件夹名称是否与您的电子邮件服务提供商一致（部分服务可能使用“Inbox”而非“INBOX”）

### 分类结果不正确
分类基于发件人模式和主题行进行智能判断。您可以根据实际需求修改脚本中的规则。

### 性能缓慢
- 减少 `--days` 参数的值以减少分析的邮件数量
- 脚本最多会从 Archive 文件夹中获取 200 封邮件——如有需要，请调整代码中的 `page_size`

## 设计理念

邮件智能分析将您的收件箱视为一个具有自身“天气模式”和健康指标的“系统”。它不仅统计未读邮件数量，还帮助您了解：
- 实际需要您关注的内容（人工邮件与自动发送的邮件）
- 您的邮件处理进度（债务评分）
- 您可能无意中忽略的人（未读邮件报告）
- 您实际需要花费的时间

通过天气比喻，收件箱状态变得直观且易于操作——当“暴风雨”来临时，您可以做好准备；而当“海面平静”时，您可以放松心情。

使用此功能，将收件箱的焦虑转化为清晰、有优先级的行动计划。