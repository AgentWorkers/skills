---
name: diet-tracker
description: 该工具可记录用户的每日饮食情况，并计算相应的营养信息，以帮助用户实现减肥目标。当用户提供用餐信息、询问卡路里摄入量、需要了解剩余的卡路里预算或希望接收用餐记录提醒时，该工具即可发挥作用。此外，它还会通过 cron 作业在午餐和晚餐时间自动提醒用户记录用餐情况。
---
# 饮食记录器

该功能帮助用户记录每日饮食情况，并通过自动提醒来帮助实现减肥目标。

## 触发条件

用户可能会说：
- “我午餐/晚餐吃了[食物名称]”
- “我剩余的卡路里预算是多少？”
- “我今天摄入了多少卡路里？”
- “记录我的餐食”
- “查看我的饮食进展”

或者通过 cron 作业自动触发餐食提醒。

## Cron 作业集成

该功能支持与自动 cron 作业配合使用：
- **午餐提醒**：约 12:30（检查是否已记录午餐，未记录则发送提醒）
- **晚餐提醒**：约 18:00（检查是否已记录晚餐，未记录则发送提醒）

Cron 作业系统事件：`饮食记录检查:午餐` 或 `饮食记录检查:晚餐`

## 用户资料（必填）

该功能会从 `USER.md` 文件中读取以下信息：
- 每日卡路里目标（默认：1650 千卡）
- 宏量营养素目标（蛋白质/碳水化合物/脂肪）
- 身高、体重、年龄、性别、活动水平（用于计算总能量消耗 TDEE）

**活动水平**：
- 久坐不动（很少或没有运动）
- 轻度活动（每周 1-3 天进行轻度运动）
- 中等活动（每周 3-5 天进行中等强度运动）
- 高强度活动（每周 6-7 天进行高强度运动）
- 非常活跃（进行高强度运动且从事体力劳动）

## 工作流程

### 当用户记录餐食时：

1. 从用户的描述中识别食物种类
2. 通过 `scripts/get_food_nutrition.py` 获取营养信息
   - 在网上搜索卡路里/蛋白质/碳水化合物/脂肪含量
   - 如需要，可参考 `references/food_database.json` 数据库
3. 通过 `scripts/update_memory.py` 更新每日记录
   - 保存到 `memory/YYYY-MM-DD.md` 文件中
   - 计算餐食的总营养值
   - 更新每日累计摄入量
4. 向用户报告：
   - 餐食的营养成分
   - 当天摄入的卡路里及剩余卡路里
   - 根据摄入量差异预测体重变化
   - 宏量营养素的摄入情况（如果设置了目标）

### 当用户查询状态时：

1. 读取当天的记录文件
2. 计算总摄入量
3. 报告：
   - 剩余卡路里预算
   - 剩余的蛋白质/碳水化合物/脂肪摄入量（如果设置了目标）
   - 体重变化预测

## 脚本

- `scripts/get_food_nutrition.py`：获取营养信息并计算总能量消耗 TDEE
- `scripts/update_memory.py`：使用餐食数据更新每日记录文件
- `references/food_database.json`：包含常见食物的营养信息数据库

## 错误处理

### 常见问题

**问题**：无法读取 `USER.md` 文件或用户资料缺失
- **原因**：用户资料未配置
- **解决方法**：请用户提供身高、体重、年龄、性别和卡路里目标

**问题**：某些食物的营养信息无法查询到
- **原因**：该食物不在在线数据库中
- **解决方法**：请用户提供大致的卡路里含量，或使用数据库中类似的食物作为参考

**问题**：一次餐食中包含多种食物
- **原因**：用户表示吃了披萨、沙拉和可乐
- **解决方法**：分别处理每种食物，然后汇总营养值

## 数据格式

### 每日记录文件（memory/YYYY-MM-DD.md）

```markdown
## Diet Log

**Breakfast**: [food] - [X] kcal (P: [X]g, C: [X]g, F: [X]g)
**Lunch**: [food] - [X] kcal (P: [X]g, C: [X]g, F: [X]g)
**Dinner**: [food] - [X] kcal (P: [X]g, C: [X]g, F: [X]g)

**Daily Total**: [X] / [target] kcal
**Remaining**: [X] kcal
**Predicted weight change**: [-/+ X] kg
```

## 信息逐步披露

- **第 1 级（前置内容）**：功能激活条件
- **第 2 级（SKILL.md）**：完整的工作流程说明
- **第 3 级（references/）**：食物数据库和营养指南