---
name: diet-tracker
description: 该工具可记录用户的每日饮食情况，并计算相关的营养信息，以帮助用户实现减肥目标。当用户提供餐食信息、询问卡路里摄入量、需要了解剩余的卡路里预算或希望接收餐食记录提醒时，该工具便可发挥作用。此外，它还会通过定时任务（cron job）在午餐和晚餐时间自动提醒用户记录当天的餐食。
---
# 饮食记录器

此功能帮助用户记录每日饮食情况，并通过自动提醒来帮助实现减肥目标。

## 触发条件

用户可能会说：
- “我午餐/晚餐吃了[食物名称]”
- “我的剩余卡路里预算是多少？”
- “我今天摄入了多少卡路里？”
- “记录我的饮食”
- “查看我的饮食进展”

或者通过 cron 作业自动触发饮食提醒。

## Cron 作业集成

此功能支持与自动 cron 作业配合使用：
- **午餐提醒**：约 12:30（检查是否已记录午餐，未记录则发送提醒）
- **晚餐提醒**：约 18:00（检查是否已记录晚餐，未记录则发送提醒）

Cron 作业系统事件：`饮食记录检查:午餐` 或 `饮食记录检查:晚餐`

## 用户资料（必填）

该功能会从 `USER.md` 文件中读取以下信息：
- 每日卡路里目标（默认：1650 千卡）
- 宏量营养素目标（蛋白质/碳水化合物/脂肪）
- 身高、体重、年龄、性别、活动水平（用于计算总能量消耗 TDEE）

**活动水平**：
- 久坐不动（很少或没有运动）
- 轻度活跃（每周 1-3 天进行轻度运动）
- 中等活跃（每周 3-5 天进行中等强度运动）
- 非常活跃（每周 6-7 天进行高强度运动）
- 非常活跃（进行高强度运动且从事体力劳动）

## 工作流程

### 当用户记录饮食时：

1. 从用户的描述中识别食物种类
2. 通过 `scripts/get_food_nutrition.py` 获取营养信息：
   - 必须获取的信息：卡路里（kcal）、蛋白质（g）、碳水化合物（g）、脂肪（g）
   - 在网上搜索卡路里/蛋白质/碳水化合物/脂肪的信息
   - 如需时，可参考 `references/food_database.json`
   - 如果无法找到完整的营养数据，必须向用户明确告知预估值
3. 通过 `scripts/update_memory.py` 更新每日记录：
   - 保存到 `memory/YYYY-MM-DD.md` 文件中
   **记录格式**：`食物名称 - XX 千卡 (蛋白质: XXg, 碳水化合物: XXg, 脂肪: XXg)`
   - 计算餐食的总营养摄入量
   - 更新每日累计摄入量
4. 向用户报告：
   - 必须报告：摄入的卡路里总量及蛋白质/碳水化合物/脂肪的摄入量
   - 当天摄入的卡路里与剩余卡路里
   - 剩余的宏量营养素目标
   - 根据摄入量差异预测体重变化

### 当用户询问状态时：

1. 读取当天的记录文件
2. 计算总摄入量
3. 报告：
   - 剩余的卡路里预算
   - 剩余的蛋白质/碳水化合物/脂肪（如果设置了目标）
   - 体重变化预测

## 脚本

- `scripts/get_food_nutrition.py`：获取营养信息并计算总能量消耗 TDEE
- `scripts/update_memory.py`：使用餐食数据更新每日记录文件
- `references/food_database.json`：常见食物的备用数据库

## 错误处理

### 常见问题

**问题**：“无法读取 USER.md”或用户资料缺失
- **原因**：用户资料未配置
- **解决方案**：询问用户的身高、体重、年龄、性别、活动水平和卡路里目标

**问题**：某些食物的营养信息无法查询到
- **原因**：该食物在在线数据库中不存在
- **解决方案**：询问用户该食物的大致卡路里含量，或使用数据库中类似的食物数据

**问题**：一次摄入多种食物
- **原因**：用户表示“我吃了披萨、沙拉和可乐”
- **解决方案**：分别处理每种食物，然后汇总营养值

## 数据格式

### 每日记录文件（memory/YYYY-MM-DD.md）

**必须包含的格式**：卡路里及宏量营养素信息：

```markdown
## Diet Log

**Breakfast**: [food] - [X] kcal (P: [X]g, C: [X]g, F: [X]g)
**Lunch**: [food] - [X] kcal (P: [X]g, C: [X]g, F: [X]g)
**Dinner**: [food] - [X] kcal (P: [X]g, C: [X]g, F: [X]g)

**Daily Total**: [X] / [target] kcal
- Protein: [X] / [target]g (remaining: [X]g)
- Carbs: [X] / [target]g (remaining: [X]g)
- Fat: [X] / [target]g (remaining: [X]g)
**Predicted weight change**: [-/+ X] kg
```

**⚠️ 严禁仅记录卡路里而省略宏量营养素的摄入量！**

## 逐步披露信息

- **第 1 级（前置内容）**：功能激活条件
- **第 2 级（SKILL.md）**：完整的工作流程说明（本文件）
- **第 3 级（references/）**：食物数据库和营养指南