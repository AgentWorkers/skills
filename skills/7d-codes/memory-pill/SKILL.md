---
name: memory-pill
description: 别再重复了。“Memory Pill”为你的 OpenClaw 提供了真正的“记忆”功能：项目、人员、决策等信息都能被持久保存。它采用基于里程碑的执行方式，并内置了严格的纪律机制。首次使用时会自动设置扩展的结构。该工具还兼容 Obsidian 文本编辑器。
---
# Memory Pill v0.7.5

## 问题：  
你与AI进行交流，感觉它很实用，但第二天回来时，AI却什么都不记得了；或者它陷入无限循环；又或者它只完成了一半的任务就宣称任务已经完成。

## Memory Pill可以解决这些问题。  
它为你的OpenClaw提供了真正的“记忆”功能——项目、人员、决策等所有信息都能被持久化并有序地存储起来。同时，它还通过基于里程碑的执行方式以及内置的规则来防止任务陷入循环或半途而废。

---

## 快速入门  
（请参考相应的代码块内容）

完成这些设置后，你的AI就拥有了结构化的长期记忆功能。

---

## 主要功能：  
✅ **自动设置**：AI在首次使用时会自动创建扩展的文件结构（无需脚本，也无需用户授权）  
✅ **基于里程碑的项目管理**：项目被分解为多个里程碑，每个里程碑下包含多个任务。仪表盘可以显示每个里程碑的进度。  
✅ **技能跟踪**：可以追踪已安装的技能、技能版本以及自定义配置。  
✅ **客户资料管理**：可以管理客户信息、偏好设置以及项目历史记录。  
✅ **决策记录**：可以记录决策内容、决策理由及结果。  
✅ **统一写作风格**：所有内容都采用一致的写作风格。  
✅ **提示工程**：简单的任务描述会被扩展成详细的代理执行指令（包括角色、上下文、格式、示例和限制条件）。  
✅ **任务分配**：所有任务都会分配给相应的代理处理；主AI仅负责快速决策。  
✅ **智能优先级系统**：任务分为高/中/低三个级别（无“紧急”级别）。高优先级任务通常时间紧迫，中等优先级任务有截止日期，低优先级任务用于探索或研究。  
✅ **事实记录**：每日笔记会收集所有信息；定时任务会提取通用事实（而非一次性细节）。  
✅ **兼容Obsidian**：可以使用`[[note]]`格式的wiki链接，这些链接在仪表盘和Obsidian中都能正常使用。  
✅ **内置搜索功能**：利用OpenClaw的原生`memory_search`工具进行高效搜索。

---

## 首次使用时的自动设置  
当你开始使用Memory Pill时，AI会自动创建扩展的文件结构。**无需请求用户授权**。

---

## 文件结构  
Memory Pill会使用并扩展你现有的OpenClaw工作空间结构。

---

## 使用搜索功能  
**重要提示：**在搜索之前，请先对文件进行索引，以获得更准确的结果。  
OpenClaw的`memory_search`工具会搜索你的记忆文件。为了获得最佳搜索效果：  
1. **在搜索前**，文件应该已经被索引（这个过程会随着时间自动完成）。  
2. **如果`memory_search`没有返回结果**，可能需要重新索引文件。  
3. **搜索范围**：包括`MEMORY.md`、`memory/daily/*.md`、`projects/**/*.md`和`people/**/*.md`文件。

---

## 扩展后的文件结构  
（请参考相应的代码块内容）

---

## 原始文件结构  
（请参考相应的代码块内容）

---

## 扩展的实体类型  
除了标准的PARA实体（项目、领域、人员）之外，Memory Pill还包含以下类型：  

### 技能注册表（`skills/`）  
用于追踪已安装的技能、技能版本及配置信息：  
（请参考相应的代码块内容）  
**用途**：  
- 用户自定义的技能  
- OpenClaw预装的技能  
- 跟踪技能版本  
- 备份配置设置  

### 客户资料（`clients/`）  
用于管理客户信息及项目历史记录：  
（请参考相应的代码块内容）  
**用途**：  
- 适用于自由职业/咨询工作  
- 管理供应商关系  
- 跟踪合作伙伴  

### 决策记录（`decisions/`）  
用于记录重要的决策及其背景信息：  
（请参考相应的代码块内容）  
**用途**：  
- 用于记录架构决策、招聘选择、战略调整等关键决策  

### 写作风格（`resources/voice.md`）  
确保所有内容都采用统一的写作风格：  
（请参考相应的代码块内容）  

---

## ID系统（项目级）  
**格式**：`{project-slug}-{milestone-slug}-{number}` 或 `{project-slug}-{number}`（针对顶级项目）  
**示例**：  
- `website-redesign-research-1`（里程碑：研究）  
- `website-redesign-research-2`  
- `mobile-app-api-1`（里程碑：API开发）  
- `openclaw-setup-1`（无里程碑）  

**规则**：  
- 每个里程碑对应一个唯一的ID（或项目级ID）  
- ID从1开始编号  
- 可以在不同项目中重复使用  
- 保持ID的易读性和效率  

---

## 优先级系统（高/中/低）  
| 优先级 | 含义 | 示例 |  
|----------|---------|----------|  
| **高** | 时间紧迫，会阻碍其他工作 | 提交交付物、修复生产中的错误 |  
| **中** | 有截止日期，需要持续推进 | 草稿编写、研究总结 |  
| **低** | 用于探索性工作或辅助性任务 | 竞争对手研究、工具评估、阅读资料 |  
**适用范围**：项目、里程碑和任务  

---

## 搜索建议  
**在回答关于以往工作的问题时，请遵循以下步骤：**  
1. **先搜索记忆**  
2. **如果没有结果，再查看每日笔记**  
3. **如果仍然找不到，就承认自己忘记了**  
> “我查看了记忆和最近的每日笔记，但没有找到相关记录。你能提醒我吗？”  

### 保持记忆的准确性：  
- **将重要信息写入`MEMORY.md`：**用于保存用户的长期见解和偏好设置。  
- **将临时事件或一次性细节写入每日笔记**。  
- **使用wiki链接**：`[[project-slug]]`可以创建文件之间的关联。  
- **提取通用事实**：将通用信息（如偏好设置、工作流程）保存到`memory/facts/`文件夹中。  

---

## 创建项目（含里程碑）  
**步骤1：**创建项目结构  
**步骤2：**创建项目摘要  
**步骤3：**创建项目元数据  
**步骤4：**（可选）创建里程碑摘要  

---

## 创建任务（使用提示工程）  
**步骤1：**捕捉用户的简单请求**  
例如：用户请求“创建一个登录页面”。  

**步骤2：**使用提示工程系统进行扩展**  
按照上述流程，生成详细的代理执行指令：  
- 明确任务角色（如“高级全栈开发者”）  
- 提供完整上下文（技术栈、当前项目状态、现有代码情况）  
- 明确任务范围  
- 指定输出格式和文件结构  
- 提供示例（参考现有代码）  
- 设定具体限制条件  

**步骤3：**生成任务JSON文件**  
**步骤4：**使用扩展后的指令创建代理任务**  

---

## 提示工程系统  
每个任务都会从用户的简单请求被扩展成详细的代理执行指令。  

### 扩展流程：  
**步骤1：**捕捉用户请求的要点**  
**步骤2：**生成详细执行指令**  
分析用户请求，然后生成详细的执行指令：  
- **角色**：指定具有相关专长的角色  
- **上下文**：提供项目背景、当前状态和技术栈信息  
- **任务内容**：明确具体的任务内容  
- **输出格式**：指定输出文件的路径和结构  
- **示例**：参考现有代码或提供样式示例  
- **限制条件**：明确任务的具体要求和限制  

**步骤3：**保存两个版本的指令**  
**步骤4：**将扩展后的指令作为代理的任务描述发送给代理。**  

---

## 提示工程示例：  
**示例1：简单请求 → 详细执行指令**  
*简单请求：“创建一个登录页面” → **详细执行指令：**  
**示例2：研究任务**  
*简单请求：“研究竞争对手” → **详细执行指令：**  
**示例3：设计任务**  
*简单请求：“设计一个设置页面” → **详细执行指令：**  

---

## 使用提示工程时的注意事项：  
在创建代理之前，请确认：  
- 角色是否具体（避免使用泛化的“开发者”）  
- 上下文是否包含技术栈和当前项目状态  
- 任务范围是否明确  
- 输出格式是否指定  
- 是否参考了现有代码  
- 限制条件是否具体可衡量  
- 成功标准是否明确  

---

## 代理优先原则  
**默认规则：**对于任何需要复杂处理的任务，都会创建相应的代理来执行。**  
主AI仅负责处理以下任务：  
- 快速响应（少于2分钟）  
- 路由决策  
- 阅读/总结文件  
- 简单编辑  

**何时创建代理？**  
- 当需要创建新文件或组件时  
- 当需要研究或收集数据时  
- 当需要执行多步骤操作时  
- 当需要做出设计或架构决策时  
- 当任务需要特定专业知识时  

**注意：**不要过度使用代理。如果任务看起来需要耗费大量时间，就直接由主AI处理。  

**任务分配逻辑：**  
- `uiux-craftsman`：负责UI组件、CSS、React等视觉相关任务  
- `system-designer`：负责架构设计、API开发、数据模型审核  
- `business-strategist`：负责定价、营销文案、市场调研  
- `integrator`：负责组件集成和bug修复  
- 新的代理任务会存储在`subagents/`文件夹中。  

---

## 日志系统（每日笔记）  
**模板：**  
（请参考相应的代码块内容）  

**使用规则：**  
1. **每天记录一条笔记**  
2. **使用`[[wiki-links]]`格式以确保与Obsidian兼容**  
3. **记录所有内容**：事实、想法、任务、会议记录  
4. **为任务设置优先级标签**（#高、#中、#低）  
5. **每天结束时**，可以使用定时任务提取笔记内容  

---

## 事实提取系统  
**事实类型：**  
**通用事实**（保存到`memory/facts/`文件夹）：**  
- 用户偏好设置  
- 工作流程  
- 限制条件  
- 人员信息  

**一次性细节**（忽略，已记录在每日笔记中）：  
- “将这个按钮设置为蓝色”  
- “明天下午3点开会”  
- “修复这个特定的bug”  

**提取流程：**  
**选项1：**每天结束时查看笔记，提取通用事实并保存到`memory/facts/`文件夹  
**选项2：**使用定时任务（建议）：**  
每天凌晨3点自动运行：  
  - 扫描昨天的笔记  
  - 提取通用事实  
  - 生成`memory/facts/{project-slug}-{number}.json`文件  
  - 更新项目元数据  
  - 从笔记中补充项目信息  
  - 发送每日工作简报  

---

## Obsidian兼容性  
**wiki链接格式：**  
使用`[[target|Display Text]]`或`[[target]]`格式：  
- 项目：`[[project-slug]]`  
- 里程碑：`[[project-milestone]]`  
- 任务：`[[project-milestone-number]]`  
- 人员：`[[person-slug]]`  
- 日志：`[[YYYY-MM-DD]]`  

**仪表盘与Obsidian的集成：**  
- 两种系统都可以使用wiki链接  
- 仪表盘会解析JSON格式的数据  
- 两者都能显示图表（Obsidian通过`graph.json`文件显示图表）  

---

## 数据结构（必填/可选字段）  
**项目元数据（必填）**  
（请参考相应的代码块内容）  

**任务信息（必填）**  
（请参考相应的代码块内容）  

**事实信息（必填）**  
（请参考相应的代码块内容）  

## 图表结构  
**节点类型：**  
`project`、`milestone`、`task`、`agent`、`person`、`fact`、`area`  

**边类型：**  
- `belongs_to`：任务/里程碑 → 项目  
- `part_of`：里程碑 → 项目  
- `assigned_to`：任务 → 代理  
- `depends_on`：任务 → 任务  
- `extracted_from`：事实 → 日志  
- `references`：任意节点之间的链接  

---

**重要规则：**  
1. **首次使用时务必查看`MEMORY.md`文件**（如果文件不存在，请创建）  
2. **在将任务分配给代理之前，务必扩展任务描述**  
3. **使用`[[target]]`格式的wiki链接以确保与Obsidian兼容**  
4. **使用简洁的ID格式**（`{project}-{milestone}-{number}`）  
5. **主AI仅负责快速决策**  
6. **每天记录一条笔记**  
7. **仅记录通用事实**，忽略一次性细节  
8. **任务优先级分为高/中/低**  
9. **为项目设置里程碑**  
10. **在回答问题前先搜索记忆**  
11. **在结构发生变化后重新生成数据图表**  
12. **建议使用定时任务**（但无需强制设置）  

---

## 执行规范协议  
（改编自@thejayden的EXECUTION_DISCIPLINE_PROTOCOL v1.0）  
**适用于所有非简单任务。**无例外。**  

### 核心规则：**  
**执行前先制定计划。**  
在开始执行任务之前，明确以下内容：  
- 最终的交付物是什么？  
- “完成”意味着什么？  
- 什么会导致任务失败？  

如果目标不明确，请先澄清问题，不要盲目开始。  

### 任务分解（必填）  
将任务分解为以下部分：  
- 主要目标  
- 子任务  
- 限制条件  
- 未知变量  
- 依赖关系  
- 成功标准  

如果无法分解任务，说明你还没有完全理解任务内容。**在未明确任务结构之前，不要尝试解决问题。**  

### 假设声明**  
明确列出所有假设：  
- 每个假设是否已经确认？  
- 是否可以推断？  
- 是否存在风险？  

如果某个关键假设未经验证，请标记出来并询问相关细节。切勿基于未经验证的假设进行操作。  

### 单层执行原则**  
**一次只解决一个子任务**：  
- 执行任务  
- 验证结果  
- 确认结果是否符合目标  

**循环预防**：  
在回答用户问题之前，先检查以下内容：  
- 是否在重复之前的思考过程？  
- 是否在解决已经解决的问题？  
- 新信息是否改变了计划？  
- 是否在陷入无意义的优化过程中？  

如果发现这些问题，请调整策略，避免重复相同的操作。**循环通常发生在计划不明确的情况下。**  

### 完成验证**：  
在输出最终结果之前，确认：  
- 任务是否完全符合目标？  
- 是否有子任务被遗漏？  
- 是否有隐含的细节需要明确说明？  
- 任务是否可以交付？  

**失败处理**：  
如果遇到问题，请清楚地说明：  
- 失败的原因  
- 缺少哪些信息  
- 下一步该怎么做  

**注意事项：**  
- 不要默默地拖延或猜测。  
- 在生成输出之前，去除冗余的信息和重复的内容，专注于当前需要处理的步骤。  

---

**示例：**  
**用户请求：“我们需要重新设计网站。当前网站已经过时，需要在产品发布前完成设计，并更新品牌。”**  
**处理步骤：**  
1. **查看/创建`MEMORY.md`文件**（如果文件不存在，则创建）  
2. **创建项目**：`projects/website-redesign/`  
3. **设置里程碑**：研究（高优先级）、设计（中等优先级）、开发（中等优先级）  
4. **创建任务**：  
   - `website-redesign-research-1`：竞争对手分析  
   - `website-redesign-research-2`：用户访谈  
   - `website-redesign-design-1`：创建首页原型  
5. **为每个任务生成详细执行指令**  
6. **分配代理执行任务**  
7. **记录对话内容并提取相关事实**  
8. **更新数据图表**  
9. **建议使用定时任务**：安排夜间审查  

**结果：**  
项目结构清晰、任务分配合理、所有信息都有链接，且保持了完整的上下文。  

---

## 版本历史：  
- **v0.7.5**：简化了文件结构，去掉了`life/areas/`文件夹，项目、人员等信息直接存储在工作空间根目录下，更加简洁明了。  
- **v0.7.4**：增加了AI自动设置功能，用户首次使用时AI会自动创建扩展文件结构（无需脚本或权限）。  
- **v0.7.3**：移除了初始化脚本，OpenClaw的基础文件已经包含了核心文件（`MEMORY.md`、`AGENTS.md`、`SOUL.md`），技能模块专注于扩展的文件结构和流程管理。  
- **v0.7.2**：优化了示例内容，去除了个人相关信息，改进了文档和快速入门指南。  
- **v0.7.1**：引入了执行规范协议（来自@thejayden），强制要求按步骤解决问题：明确目标、分解任务、声明假设、单层执行、避免循环、验证结果。  
- **v0.7.0**：增加了新的实体类型（技能注册表、客户资料、决策记录），并更新了相关文档模板。  
- **v0.6.1**：添加了首次使用的初始化脚本（在v0.7.3版本中被弃用，因为OpenClaw的基础文件已经包含了所需文件）。  
- **v0.6.0**：将项目名称从`lifeos-memory`改为`memory-pill`，移除了对qmd的依赖，使用了OpenClaw的原生`memory_search`功能。  
- **v0.5.0**：进行了重大改进：增加了里程碑管理、提示工程功能、代理优先执行机制、Obsidian wiki链接和事实记录系统。