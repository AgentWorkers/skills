---
name: memory-pill
description: 专为 OpenClaw 设计的 AI 原生内存系统：采用结构化的项目管理方式、基于里程碑的执行机制，并内置了严格的管理规则——完全符合人工智能的实际工作方式。该内存系统具备持久性、数据链接功能以及上下文感知能力；在系统设置前会先请求用户的授权。
---
# Memory Pill v0.7.9

**问题：**人工智能（AI）会忘记所有事情，它们会陷入循环，任务常常半途而废，它们在尚未完全理解问题的情况下就开始尝试解决。此外，AI天生缺乏上下文感知能力且没有状态存储机制。

**Memory Pill**在系统层面解决了这些问题。**

它不仅仅是一个用于存储笔记的“文件夹”，而是一种**专为AI工作方式设计的结构**：
- **里程碑**：AI需要明确的工作范围，而不是无限的待办事项列表。
- **提示扩展**：AI需要详细的指令，而不仅仅是模糊的请求。
- **执行纪律**：AI在缺乏约束的情况下会无休止地重复相同的工作。
- **链接式记忆**：AI需要快速检索信息，而不是依赖复杂的搜索工具。

使用Memory Pill后，AI能够保持状态一致性，工作更加有条理，并且在不同的会话中也能持续发挥作用。

---

## 快速入门

AI会询问用户是否需要启用该功能。

---

## 为什么它是“AI原生”的？

**传统的待办应用**：随着任务列表的不断增长，AI会逐渐失去对任务的上下文理解，导致工作效率下降。

**Memory Pill的特点：**
- **里程碑**：明确的工作范围有助于AI保持专注。
- **提示设计**：每个任务都会附带角色、上下文、格式和约束条件，确保AI不会产生误解。
- **执行纪律**：强制AI在行动前先制定计划，避免重复劳动。
- **链接式事实**：AI能够快速检索到通用信息。

---

## 文件结构

Memory Pill基于您现有的OpenClaw工作空间进行扩展和使用。

---

## 使用记忆搜索

**重要提示：**在搜索之前，请先对文件进行索引。**OpenClaw的`memory_search`工具可以帮助您更快地找到所需信息。为了获得最佳搜索结果：
1. **搜索前**，文件应该已经被索引（这个过程会随着时间的推移自动完成）。
2. **如果`memory_search`没有返回结果**，可能需要重新索引文件。
3. **搜索范围**：包括`MEMORY.md`、`memory/daily/*.md`、`projects/**/*.md`和`people/**/*.md`。

---

## 文件扩展结构

---

## 归档功能

**目的：**将已完成的工作保存起来，同时避免占用活跃的工作空间。

**归档的内容包括：**
- **已完成的项目**：项目文件夹会完整地被移至归档目录（但不会被删除）。
- **旧的每日笔记**：每天自动移至归档目录（30天后）。
- **不活跃的用户/任务**：会被归档而不是删除。
- **被替换的决策记录**：会保留历史记录，并标记为“已归档”。

**归档规则：**
1. **永不删除**：文件会被移至归档目录。
2. **保持链接的有效性**：如果文件路径发生变化，需要更新相应的wiki链接。
3. **可搜索性**：归档文件仍可被`memory_search`工具搜索到。
4. **按年份分类**：便于后续整理。

---

## 原始文件结构

---

## 扩展的实体类型

除了标准的实体类型（项目、领域、人员）之外，Memory Pill还支持以下类型：

### 技能注册表（`skills/`）

用于跟踪用户安装的技能、技能版本和配置信息：

**用途：**
- 用户自定义的技能
- Clawhub提供的技能
- 跟踪技能版本
- 备份配置设置

### 客户档案（`clients/`）

用于管理客户信息和项目历史记录：

**用途：**
- 适用于自由职业/咨询工作
- 管理与供应商的关系
- 跟踪合作伙伴信息

### 决策记录（`decisions/`）

用于记录重要的决策及其背景信息：

**用途：**
- 用于记录架构决策、招聘选择、战略调整等关键决策

### 语音与样式指南（`resources/voice.md`）

确保所有内容的写作风格保持一致：

---

## ID系统（项目级）

**格式：`{project-slug}-{milestone-slug}-{number}` 或 `{project-slug}-{number}`（对于顶级项目）

**示例：**
- `website-redesign-research-1`（里程碑：研究）
- `website-redesign-research-2`
- `mobile-app-api-1`（里程碑：API开发）
- `openclaw-setup-1`（无特定里程碑）

**规则：**
- 每个里程碑都有一个唯一的ID（或按项目命名）
- ID从1开始编号
- 可以在不同项目中重复使用
- 保持ID的易读性和效率

---

## 优先级系统（高/中/低）

| 优先级 | 含义 | 示例 |
|----------|---------|----------|
| **高** | 需立即处理，可能会影响其他工作 | 提交最终成果，修复生产中的漏洞 |
| **中** | 有重要截止日期，需要持续推进 | 草稿内容，研究总结 |
| **低** | 用于探索性工作，非强制要求 | 竞争对手研究，工具评估，阅读资料 |

**适用范围：**项目、里程碑和任务

---

## 使用记忆搜索的最佳实践

**在回答关于过去工作的问题时：**
1. **首先搜索记忆中的相关信息**。
2. **如果没有找到结果，再查看每日笔记**。
3. **如果仍然找不到，就承认自己忘记了**：
   > “我检查了记忆和最近的每日笔记，但没有找到相关记录。你能提醒我吗？”

---

## 保持记忆的准确性：

- **将重要的信息写入`MEMORY.md`：**用于记录用户的长期见解和偏好设置。
- **将临时性的任务或一次性细节写入每日笔记**。
- **使用wiki链接**：`[[project-slug]]`可以创建文件之间的关联。
- **提取通用信息**：将用户的偏好设置和常用工作流程等信息保存到`memory/facts/`文件夹中。

---

## 创建项目（包含里程碑）

**步骤：**
1. **创建项目结构**。
2. **创建项目摘要**。
3. **创建项目元信息**。
4. **（可选）创建里程碑摘要**。

---

## 创建任务（使用提示扩展功能）

**步骤：**
1. **捕捉用户的简单请求**。
2. **使用提示扩展系统**将用户的简单请求转化为详细的任务指令。
   - 指定具体的角色（例如“高级全栈开发者”）。
   - 提供完整的上下文信息（项目背景、当前状态、现有代码等）。
   - 明确任务的范围和输出格式。
   - 提供示例（参考现有的代码）。
   - 设定具体的约束条件。

**步骤3：**将任务信息转换为JSON格式。

**步骤4：**使用扩展后的指令创建相应的代理任务。**

---

## 提示扩展系统

每个任务都会根据用户的简单请求转化为详细的代理任务指令。

**扩展流程：**
1. **捕捉用户的简单请求**。
2. **生成详细的任务指令**：
   - 确定执行任务的特定角色。
   - 提供完整的上下文信息。
   - 明确任务的具体内容和输出格式。
   - 提供示例或参考代码。
   - 设定可衡量的约束条件。

**步骤3：**保存两种版本的指令**：原始请求和扩展后的详细指令。

**步骤4：**使用扩展后的指令创建代理任务。**

---

## 代理任务分配规则

**默认情况下，任何需要复杂处理的任务都会由代理来执行。**主AI仅负责处理以下任务：
- 快速响应（耗时少于2分钟）。
- 路由决策。
- 阅读或总结文件内容。
- 简单的编辑工作。

**以下情况需要创建代理任务：**
- 创建新的文件或组件。
- 进行研究或数据收集。
- 需要复杂设计的任务。
- 需要特定专业知识的任务。

**注意事项：**如果任务看起来需要耗费大量时间或需要专业知识，就创建代理任务。代理任务可以高效地处理这些任务。**

---

## 日常笔记系统（任务 backlog）

**模板：**
每天记录一条笔记。
- 使用`[[wiki-links]]`以确保与Obsidian兼容。
- 记录所有内容，包括事实、想法和任务。
- 为任务设置优先级标签（`#高`、`#中`、`#低`）。
- 可以通过定时任务在每天结束时自动提取笔记内容。

---

## 事实提取系统

**事实的分类：**
- **通用事实**：保存到`memory/facts/`文件夹中，例如用户偏好设置、工作流程等。
- **一次性细节**：可以忽略，因为这些信息已经记录在每日笔记中。

**提取流程：**
- **选项1：每日结束时查看笔记**，提取通用事实，并更新项目元信息。
- **选项2：使用定时任务**：每天凌晨3点自动执行提取操作：
  - 扫描昨天的笔记。
  - 提取通用事实。
  - 生成`memory/facts/{project-slug}-{number}.json`文件。
  - 更新项目元信息。
  - 从笔记中补充缺失的项目信息。

---

## Obsidian兼容性

**wiki链接格式：**
使用`[[target|Display Text]]`或`[[target]]`来创建链接。

**可链接的文件类型：**
- 项目：`[[project-slug]]`
- 里程碑：`[[project-milestone]]`
- 任务：`[[project-milestone-number]]`
- 人员：`[[person-slug]]`
- 日常笔记：`[[YYYY-MM-DD]]`

** dashboard和Obsidian的交互方式：**
- Obsidian可以显示wiki链接的内容。
- dashboard可以从JSON文件中读取结构化的数据。
- 两者都可以生成图表（Obsidian通过`graph.json`实现）。

---

## 数据结构（必填/可选字段）

### 项目元信息（必填字段）

### 任务信息（必填字段）

### 事实信息（必填字段）

---

## 图谱结构

**节点类型：**
- `project`、`milestone`、`task`、`agent`、`person`、`fact`、`area`

**边类型：**
- `belongs_to`：表示任务或里程碑属于哪个项目。
- `part_of`：表示里程碑属于哪个项目。
- `assigned_to`：表示任务分配给了哪个代理。
- `depends_on`：表示任务依赖于哪个任务。
- `extracted_from`：表示事实信息来源于哪个日常笔记。
- `references`：表示某个节点与其他节点的关联关系。

---

**重要规则：**
1. **首次使用该工具时，务必检查`MEMORY.md`文件**，如果文件缺失则创建它。
2. **在将任务指令分配给代理之前，务必先进行扩展处理**。
3. **使用`[[target]]`格式的wiki链接以确保与Obsidian兼容**。
4. **使用简洁的ID格式**：`{project}-{milestone}-{number}`。
5. **主要任务由主AI处理**，仅用于快速决策。
6. **每天记录一条笔记**，避免重复创建。
7. **仅记录通用事实**，忽略一次性发生的细节。
8. 优先级分为高/中/低三个等级。
9. **为项目设置里程碑**，将大型项目分解为多个阶段。
10. **在回答问题之前，务必先搜索记忆中的相关信息**。
11. **在结构发生变化后，重新生成数据图表**。
12. **使用前务必征求用户的同意**。

---

## 定时任务（维护工作）

Memory Pill每天会运行一次维护任务。不会发送不必要的通知或生成冗长的报告。

**凌晨3点的维护任务：**提取通用事实、重新索引文件，并将超过30天的笔记自动归档。

**任务内容：**
- 提取昨日的笔记中的通用事实。
- 重新索引文件，以便快速搜索。
- 将超过30天的笔记自动移至归档目录。

**设置维护任务的步骤：**
---

## 执行纪律协议

**来源：**改编自@thejayden的`EXECUTION_DISCIPLINE_PROTOCOL v1.0**

请将此协议应用于所有非简单的任务。没有任何例外。

**核心规则：**在执行任务之前，必须先进行详细的计划。**

**1. 明确目标：**在开始工作之前，明确最终成果是什么，以及“完成”意味着什么。
- 如果目标不明确，请提出问题以获取澄清。

**2. 任务分解：**将任务分解为以下部分：**
  - 主要目标。
  - 子任务。
  - 约束条件。
  - 未知变量。
  - 依赖关系。
  - 成功标准。

如果无法将任务分解清楚，说明你还没有完全理解任务的内容。**在未明确任务结构之前，不要开始执行。**

**3. 明确所有假设：**列出所有的假设，并判断它们是否成立或需要验证。
- 如果某个假设未经验证，请标记出来并询问用户或相应地调整任务内容。

**4. 逐层执行：**每次只解决一个子任务。
  - 执行任务。
  - 验证结果是否与目标一致。
  - 确保每个步骤都符合目标要求。

**5. 避免重复：**在回答用户问题之前，检查是否在重复之前的推理过程。
  - 是否在解决已经解决过的问题。
  - 新出现的信息是否改变了原有的计划。

**6. 完成后的验证：**在输出结果之前，确认是否达到了目标要求。
  - 是否有遗漏的子任务？
  - 是否有需要明确说明的细节？
  - 结果是否可以交付？

**7. 处理失败情况：**如果任务失败，要清楚地说明失败的原因、缺失的信息以及下一步应该采取的措施。

**避免沉默不语或随意猜测。**