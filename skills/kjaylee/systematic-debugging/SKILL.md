---
name: systematic-debugging
description: **根本原因优先的调试方法**：在遇到任何错误、测试失败或异常行为时，应首先采用这种方法进行调试。这样做可以避免盲目尝试修复问题，从而节省时间并防止引入新的错误。
metadata:
  author: misskim
  version: "1.0"
  origin: Concept from obra/superpowers systematic-debugging, adapted for our workflow
---

# 系统化调试

## 基本原则

```
근본 원인 파악 없이 수정 시도 절대 금지
```

## 四步调试流程

### 第一步：查找根本原因

**在尝试修改之前，请务必：**
1. **仔细阅读错误信息** — 完整阅读堆栈跟踪信息，记录行号和文件路径。
2. **重现问题** — 问题能否被一致地触发？具体步骤是什么？
3. **检查最近的更改** — 查看 Git 提交记录、最近的应用程序更新、新增的依赖项以及配置变更。
4. **追踪数据流** — 错误值是从哪里开始的？尝试反向追踪。

**对于多组件系统：**
在每个组件边界添加诊断日志 → 运行程序 → 查看问题出现在哪里 → 然后仅针对该组件进行调试。

### 第二步：分析问题模式

1. **寻找正常运行的示例** — 在同一代码库中寻找类似功能的代码。
2. **参考相关文档** — 在实现功能时，务必仔细阅读参考文档（切勿只是粗略浏览！）。
3. **识别差异** — 列出所有导致问题出现的差异（无论是正常运行还是异常运行的情况）。
4. **确定依赖关系** — 明确需要哪些其他组件、配置以及运行环境。

### 第三步：验证假设

1. **提出一个假设** — “X 是根本原因，因为 Y。”
2. **进行最小化修改后的测试** — 每次只修改一个部分。
3. **验证假设** — 如果修改后问题解决了，进入第四步；否则需要提出新的假设。
4. **承认未知** — 如果不确定，就不要随意猜测。

### 第四步：实施修复

1. **编写失败测试用例** — 在进行修改之前先编写相应的测试用例。
2. **实施单一修改** — 仅解决根本原因，避免同时进行多项改进。
3. **验证修复效果** — 测试是否通过？其他功能是否受到影响？
4. **如果多次修改都失败：** 
   - 怀疑系统架构存在问题。
   - 是否需要“大规模重构”？
   - **立即停止** — 这可能意味着原始设计有缺陷，需要与项目负责人讨论。

## 🚨 危险信号 — 立即停止并返回第一步

- “先试着修改 X，看看是否有效。”
- “一次性进行多项修改并进行测试。”
- “快速修复，之后再详细调查。”
- “大概就是这个地方出了问题。”
- “手动确认一下就应该没问题了。”
- 在没有充分调查的情况下提出修改方案。
- 如果多次修改尝试都失败。

## 避免合理化借口

| 常见借口 | 真实情况 |
|------|------|
| “这个问题很简单，不需要遵循这个流程。” | 即使是简单的错误，也有其根本原因。 |
| “时间紧迫，没有时间遵循流程。” | 系统化的调试方法通常比随意猜测更快。 |
- “先尝试这个方法吧。” | 第一次修改可能会影响后续的调试方向。 |
| “参考文档太长了。” | 只理解部分内容并不能确保找到问题的根源。 |