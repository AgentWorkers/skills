---
name: subagent-dev
description: 执行实施计划时，为每个任务使用新的子代理（subagent），并采用两阶段审查机制（包括规范符合性检查与代码质量评估）。该方法适用于执行包含独立工作单元的多任务计划，能够有效提升 Ralph-Loop 方法论的效率。
metadata:
  author: misskim
  version: "1.0"
  origin: Concept from obra/superpowers subagent-driven-development, adapted for Clawdbot sessions_spawn
---

# 基于子代理的开发模式（Subagent-Driven Development）

将实现计划按子代理单元进行分解，并实施两阶段评审。

## 与 ralph-loop 的关系

该开发模式强化了 ralph-loop 的“每个任务由一个子代理负责”的原则：
- ralph-loop：整个流程（需求分析 → 计划制定 → 实现 → 测试）
- subagent-dev：实现阶段的执行机制

## 流程

```
계획 읽기 → 태스크 전체 추출
  ↓
[태스크마다 반복]
  1. 구현 서브에이전트 디스패치 (태스크 전문 + 맥락)
     ├─ 질문 있으면? → 답변 후 재디스패치
     └─ 구현 + 테스트 + 커밋 + 셀프리뷰
  2. 스펙 검증 서브에이전트 디스패치
     ├─ 스펙 불일치? → 구현자가 수정 → 재검증
     └─ 통과
  3. 코드 품질 리뷰 서브에이전트 디스패치
     ├─ 품질 이슈? → 구현자가 수정 → 재리뷰
     └─ 승인
  4. 태스크 완료 표시
  ↓
전체 완료 → 최종 코드 리뷰 → 브랜치 마무리
```

## 两阶段评审的核心内容

### 第一阶段：需求验证
- 代码是否满足需求？
- 是否有遗漏的功能？是否添加了不必要的功能？
- 需求文档中规定的所有内容是否都已实现？

### 第二阶段：代码质量评估
- 代码是否存在重复？命名是否规范？类型覆盖是否完整？
- 错误处理机制是否合理？边缘情况是否考虑到了？
- 是否存在性能问题或安全漏洞？

**为什么要分两个阶段进行评审？**
- 第一阶段关注“是否实现了正确的功能”（What）；
- 第二阶段关注“代码的质量如何”（How）；
- 如果将这两个阶段合并在一起，很容易遗漏问题。

## 子代理的提示模板结构

### 实现者的提示模板
```markdown
## 태스크
[계획에서 추출한 태스크 전문]

## 맥락
[관련 파일, 아키텍처, 제약 조건]

## 제약
- 이 태스크 범위만 수정
- TDD: 테스트 먼저, 구현 후
- 커밋 메시지 작성
- 셀프리뷰 결과 포함

## 출력
- 구현 요약
- 테스트 결과
- 셀프리뷰 발견사항
```

### 需求评审者的提示模板
```markdown
## 원본 스펙
[태스크 요구사항 전문]

## 검증 대상
[구현된 코드의 git diff 또는 파일 목록]

## 체크리스트
- 모든 요구사항 구현됐는가?
- 불필요한 추가 기능은?
- 엣지 케이스 처리?
```

## 优点

- **保持评审的新鲜度**：每个任务由新的子代理负责，避免了评审人员之间的干扰和偏见；
- **双重质量保障**：通过两阶段评审实现双重验证；
- **提高效率**：控制器可以提前准备任务的相关背景信息；
- **便于提问**：子代理可以针对不清楚的地方提出疑问。

## 成本考虑

- 每个任务需要经过三次子代理的评审（实现、需求评审、代码质量评审）；
- 需要控制器进行相应的准备工作；
- 在评审循环中会增加额外的调用次数。

**结论**：总体而言，这种模式在成本与质量之间取得了良好的平衡。特别是在实现关键功能时，这种模式是必不可少的。