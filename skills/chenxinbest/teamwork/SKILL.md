---
name: "teamwork"
description: "动态创建和管理用于执行复杂任务的人工智能代理团队。当用户需要多代理协作、执行复杂项目，或者任务需要特定角色和协调的工作流程时，可以调用该系统。"
---

# 团队协作技能

该技能支持动态创建和管理团队，以执行复杂的工程任务。通过协调多个AI代理，实现智能模型选择、成本优化以及持续的性能评估。

## 适用场景

在以下情况下可调用此技能：
- 用户需要执行涉及多个专业角色的复杂项目；
- 任务需要分解为协调一致的步骤（分析、设计、实现、测试、审查）；
- 用户希望利用多种AI模型/提供商以获得最佳的成本效益平衡；
- 项目需要具有质量保证和迭代能力的结构化工作流程。

## 初始化与配置管理

### 自动初始化

**重要提示**：该技能包含一个自动初始化系统。首次调用或配置缺失时，系统将自动执行以下操作：
1. **检查配置状态**：
   - 确认`.trae/config/providers.json`文件是否存在；
   - 确认`.trae/config/team-roles.json`文件是否存在；
   - 确认`.trae/data/model_scores.json`文件是否存在。
2. **交互式设置流程**：
   - 如果配置文件缺失或不完整，系统会主动询问用户：
     - **步骤1：提供商设置**：
       - 询问用户希望配置哪些AI提供商（例如：OpenAI、Anthropic、Google、Azure等）；
       - 为每个提供商收集以下信息：
         - 提供商名称；
         - API密钥（或环境变量名称）；
         - 基本URL（如果是自定义端点）。
     - **步骤2：模型配置**：
       - 询问用户希望使用[提供商]中的哪些模型；
       - 为每个模型收集以下信息：
         - 模型名称/标识符；
         - 定价模式（订阅/分层使用/按次计费）；
         - 根据定价模式收集详细信息：
           - **订阅**：费用、开始日期、结束日期；
           - **分层使用**：每日配额、每月配额、超出配额的费率；
           - **按次计费**：每1000个令牌的输入成本、每1000个令牌的输出成本；
         - 模型能力（例如：推理、编码、快速响应）；
         - 最大并发任务数。
     - **步骤3：选择主模型**：
       - 询问用户希望哪个模型作为主要交互界面（主模型）；
       - 显示已配置的模型列表；
       - 用户选择一个作为主要交互点。
     - **步骤4：预算配置**：
       - 询问用户的月度预算限制（可选）；
       - 设置警报阈值。

3. **配置持久化**：
   - 将所有配置保存到`.trae/configproviders.json`文件中；
   - 在`.trae/config/team-roles.json`文件中创建默认的角色定义；
   - 在`.trae/data/model_scores.json`文件中初始化空的模型评分数据库；
   - 与用户确认设置成功。

### 配置管理命令

用户可以使用以下命令随时管理配置：
- **查看配置**：显示`.trae/configproviders.json`中的完整配置。

**添加提供商**：交互式提示用户输入提供商详细信息，然后将其添加到配置中。
- **添加模型**：交互式提示用户输入模型详细信息，然后将其添加到提供商的模型列表中。
- **更新模型定价**：询问用户新的定价详细信息并更新配置。
- **删除模型**：确认后从配置中删除模型。
- **更改主模型**：更新主模型的配置。
- **查看模型评分**：显示`.trae/data/model_scores.json`中的当前模型能力评分。
- **重置配置**：与用户确认后重新初始化配置。

### 配置文件结构

- **提供商配置**（`.trae/configproviders.json`）
- **团队角色配置**（`.trae/config/team-roles.json`）
- **模型评分数据库**（`.trae/data/model_scores.json`）

### 初始化检查清单

在执行任何团队任务之前，请确认以下内容：
- `.trae/configproviders.json`文件存在且至少包含一个提供商；
- 至少配置了一个模型；
- 指定了主模型；
- `.trae/config/team-roles.json`文件存在并包含角色定义；
- `.trae/data/model_scores.json`文件存在（最初可以为空）。
如果任何检查项未通过，请触发交互式初始化。

## 核心系统组件

### 1. 模型性能评估系统

#### 多维度评分

所有模型会定期由其他模型从多个维度进行评估：
- **评估维度**：
  - **响应速度**：模型响应请求的速度；
  - **响应频率**：在指定时间窗口内的成功响应率；
  - **思维深度**：推理和解决问题的质量；
  - **多线程能力**：处理并行任务的能力；
  - **代码质量**：生成的代码质量（针对编码任务）；
  - **创造力**：解决方案的新颖性和创新性；
  - **可靠性**：会话间的性能一致性；
  - **上下文理解**：在长时间对话中保持上下文的能力。
- **评分机制**：
  - 每个模型根据每个维度为其他模型打分（例如1-10分）；
  - 使用加权平均值汇总分数；
  - 评估在每次任务完成后进行；
  - 历史分数会随着时间的推移而衰减；
  - 最终能力分数 = 所有维度分数的加权总和。

**分数存储**：（具体存储方式未在文档中提供）

### 2. 成本计算系统

#### 定价模式

- **订阅制**：
  - 订阅期间无限使用，费用固定；
  - 充分利用时每次请求的成本最低；
  - 订阅结束后标记为过期，从团队中移除；
  - 配置详情：（具体配置细节未在文档中提供）。

- **分层使用制**：
  - 每日/每月有配额，成本较低；
  - 成本效益中等；
  - 必须每天监控配额使用情况；
  - 配置详情：（具体配置细节未在文档中提供）。

- **按次计费制**：
  - 每次请求的成本最高；
  - 无配额限制；
  - 适用于偶尔或超出配额的使用情况；
  - 配置详情：（具体配置细节未在文档中提供）。

### 3. 模型可用性管理

- **状态跟踪**：
  - `available`：准备好接受任务；
  - `busy`：当前正在处理任务；
  - `expired`：订阅过期；
  - `quota_exceeded`：达到每日/每月配额；
  - `rate_limited`：由于速率限制而暂时不可用；
  - `offline`：提供商API不可用；
  - **忙碌状态管理**：（具体管理方式未在文档中提供）。

## 任务执行工作流程

### 第1阶段：用户请求与需求分析

- **步骤1.1：用户向主模型提交请求**：
  - 用户与指定的主模型交互；
  - 主模型接收并确认请求。

- **步骤1.2：主模型分解需求**：
  - 将请求分解为各个阶段和子任务；
  - 识别任务之间的依赖关系；
  - 估计复杂性和所需能力；
  - 创建初始任务树。

- **步骤1.3：用户确认**：
  - 向用户展示任务分解结果；
  - 澄清疑问并细化需求；
  - 获取明确的继续执行批准。

### 第2阶段：团队组建会议

- **步骤2.1：主模型召集所有可用模型**：
  - 根据状态筛选模型（排除过期的、离线的、超出配额的模型）；
  - 检查忙碌模型是否可用；
  - 向所有符合条件的模型发送会议邀请。

- **步骤2.2：任务简报**：
  - 主模型向所有模型展示任务内容；
  - 分享任务分解结果、需求和约束条件；
  - 分发上下文和背景信息。

- **步骤2.3：协作角色定义**：
  - 所有模型讨论并同意所需角色；
  - 定义每个角色的能力要求；
  - 估计每个角色的工作量；
  - 识别潜在的瓶颈。

### 第3阶段：角色分配

- **步骤3.1：自我提名**：
  - 每个模型根据以下因素评估自己的适合度：
    - 当前成本分数；
    - 当前能力分数；
    - 当前工作量（忙碌状态）；
    - 角色要求匹配情况；
  - 模型提交角色偏好。

- **步骤3.2：冲突解决**：
  - 如果多个模型希望担任同一角色：进行民主投票；
  - 如果某个角色没有候选人：与最适合的模型协商；
  - 平衡模型之间的工作量分配；
  - 避免将所有任务集中在单个模型上。

- **步骤3.3：最终分配**：
  - 与所有模型确认角色分配；
  - 记录分配理由；
  - 更新模型的忙碌状态。

### 综合评分计算：

### 第4阶段：传令官选择与通信设置

- **步骤4.1：选择传令官**：
  - 选择响应最快的模型（不一定是最有能力的）；
  - 传令官作为中央通信枢纽；
  - 所有模型通过传令官进行通信。

- **传令官职责**：
  - 在所有团队成员之间传递消息；
  - 分发进度更新；
  - 广播需求和指令；
  - 收集和汇总结果；
  - 监控任务完成情况；
  - 向主模型报告状态；
  - 处理超时和失败通知。

### 第5阶段：任务执行

- **步骤5.1：并行执行**：
  - 被分配的模型分别执行任务；
  - 定期向传令官报告进度；
  - 传令官向团队广播相关更新。

- **步骤5.2：协调**：
  - 传令官定期检查任务状态；
  - 识别障碍和延迟；
  - 促进模型间的沟通；
  - 升级问题到主模型。

- **步骤5.3：进度跟踪**：
  （具体进度跟踪方式未在文档中提供）

### 第6阶段：任务完成与评审会议

- **步骤6.1：完成通知**：
  - 传令官确认所有任务已完成；
  - 收集所有模型的最终输出；
  - 汇总结果。

- **步骤6.2：总结会议**：
  - 主模型召集所有参与模型；
  - 每个模型展示他们的贡献；
  - 讨论挑战和解决方案；
  - 评估协作效果。

- **步骤6.3：性能重新评估**：
  - 模型相互评估性能；
  - 根据任务执行情况更新能力分数；
  - 记录角色-模型匹配评估；
  - 更新模型评分数据库。

### 第7阶段：失败处理与迭代

- **步骤7.1：失败检测**：
  - 传令官检测任务失败或超时；
  - 从相关模型收集失败信息；
  - 向主模型报告详细情况。

- **步骤7.2：失败分析会议**：
  - 召集所有参与模型；
  - 分析失败的根本原因；
  - 识别促成因素；
  - 提出解决方案。

- **步骤7.3：用户咨询**：
  - 主模型向用户展示失败分析结果；
  - 讨论可能的解决方案：
    - 需求变更；
    - 方法修改；
    - 团队重新配置；
    - 需要的额外资源；
  - 征求用户对下一步的决策。

### 配置文件

- **提供商配置**（`.trae/config/providers.json`）
- **团队角色配置**（`.trae/config/team-roles.json`）
- **模型评分数据库**（`.trae/data/model_scores.json`）

## 最佳实践

- **模型选择**：
  - 使模型能力与任务需求相匹配；
  - 对于常规任务考虑成本效益；
  - 为复杂推理任务保留高能力模型；
  - 分配工作量以防止瓶颈。

- **通信**：
  - 保持消息简洁明了；
  - 使用结构化的格式进行模型间通信；
  - 传令官应批量发送非紧急更新；
  - 立即处理关键问题。

- **性能优化**：
  - 缓存频繁使用的上下文；
  - 尽可能批量处理类似请求；
  - 主动监控配额使用情况；
  - 为关键角色准备备用模型。

- **质量保证**：
  - 始终进行评审会议；
  - 每次任务后更新评分；
  - 从失败中系统地学习；
  - 不断完善角色定义。

## 错误处理

- **提供商失败**：
  - 采用指数退避策略重试；
  - 切换到备用提供商；
  - 通知团队延迟情况；
  - 更新模型可用性状态。

- **任务失败**：
  - 捕获详细的错误上下文；
  - 与团队一起分析根本原因；
  - 提出补救策略；
  - 征求用户对下一步的决策。

- **通信失败**：
  - 传令官实施心跳检查；
  - 切换到模型间的直接通信；
  - 如果传令官无响应，则重新分配传令官；
  - 记录所有通信问题。

## 输出格式

最终交付物包括：
- 完整的任务执行报告；
- 团队组成和角色分配；
- 单个模型的性能指标；
- 成本明细和使用统计；
- 更新后的模型能力分数；
- 经验教训和建议。

## 技能结构与组件

### 目录结构：

### 脚本参考

- **init.js** - 初始化模块：
  - 负责技能初始化和配置加载。
  - 关键函数：
    - `ensureDirectories()` - 创建所需目录；
    - `checkConfiguration()` - 检查配置状态；
    - `initializeDefaultRoles()` - 创建默认角色定义；
    - `initializeEmptyScores()` - 初始化空的模型评分数据库；
    - `initializeEmptyProviders()` - 初始化空的提供商配置；
    - `needsInitialization()` - 检查是否需要初始化；
    - `readJSON(filePath)` - 读取JSON配置文件；
    - `writeJSON(filePath, data)` - 写入JSON配置文件。

- **config-manager.js** - 配置管理：
  - 负责管理提供商和模型配置。
  - 关键函数：
    - `addProvider(config, providerInfo)` - 添加新提供商；
    - `addModel(config, providerName, modelInfo)` - 向提供商添加模型；
    - `removeModel(config, providerName, modelName)` - 删除模型；
    - `removeProvider(config, providerName)` - 删除提供商；
    - `updateModelPricing(config, providerName, modelName, pricingInfo)` - 更新定价；
    - `setHostModel(config, providerName, modelName)` - 设置主模型；
    - `setBudget(config, budgetInfo)` - 设置预算限制；
    - `getAvailableModels(config)` - 获取可用模型列表；
    - `modelStatus(model)` - 获取模型可用性状态；
    - `displayConfiguration(config)` - 显示当前配置。

- **score-manager.js** - 性能评分管理：
  - 负责管理模型性能评估分数。
  - 关键函数：
    - `initializeModelScore(scores, modelName, provider)` - 初始化模型评分；
    - `updateModelScore(scores, modelName, dimension, newScore, evaluator)` - 更新维度分数；
    - `calculateOverallScore(dimensions, weights)` - 计算加权总分；
    - `updateRoleFit(scores, modelName, roleName, fitScore)` - 更新角色匹配分数；
    - `getTopModelsForRole(scores, roleName, topN)` - 获取某个角色的顶级模型；
    - `getModelsByCapability(scores, capability, minScore)` - 根据能力获取模型；
    - `recordEvaluation(scores, evaluation)` - 记录完整评估；
    - `displayScores(scores)` - 显示所有模型评分。

- **team-coordinator.js** - 团队协调：
  - 负责协调团队组建和任务执行。
  - 关键类：`TeamCoordinator`：
    - `load()` - 加载配置；
    - `getAvailableModels()` - 获取可用模型列表；
    - `selectHerald()` - 选择最快的模型作为传令官；
    - `assignRoles(requiredRoles)` - 为模型分配角色；
    - `calculateCombinedScore(model, roleFit)` - 计算选择分数；
    - `createTaskPlan(userRequest)` - 创建任务执行计划；
    - `generateMeetingAgenda(meetingType)` - 生成会议议程；
    - `generateEvaluationForms()` - 生成同行评估表单；
    - `generateReport()` - 生成任务报告。

- **herald.js** - 通信系统：
  - 负责管理模型间的通信和协调。
  - 关键类：`Herald`：
    - `initializeTeam(team)` - 初始化团队状态跟踪；
    - `broadcast(message, excludeSender)` - 向所有人广播消息；
    - `sendDirectMessage(to, message, from)` - 发送直接消息；
    - `updateProgress(model, subtaskId, progress, status)` - 更新任务进度；
    - `getTeamStatus()` - 获取当前团队状态；
    - `checkTimeouts()` - 检查超时情况；
    - `pollTeam()` - 向所有成员请求状态；
    - `reportToHost(status)` - 向主模型报告状态；
    - `notifyFailure(model, error, context)` - 通知失败；
    - `notifyCompletion(model, result)` - 通知完成情况；
    - `getOverallProgress()` - 获取整体任务进度。

### 模板参考

- **task-report.md** - 任务执行报告：
  - 记录完整的任务执行细节。

- **meeting-minutes.md** - 会议记录：
  - 记录团队会议的讨论和决策。

- **failure-report.md** - 失败分析：
  - 记录和分析任务失败情况。

- **evaluation-form.md** - 模型评估：
  - 记录模型间的评估。

### 工具参考

- **helpers.js** - 通用工具：
  - 提供各种通用辅助函数。

- **logger.js** - 日志系统：
  - 设置日志级别（DEBUG、INFO、WARN、ERROR）；
  - 记录日志信息。

- **errors.js** - 处理错误：
  - 定义各种错误类型；
  - 提供错误处理机制。

### API参考

- **快速入门**：
  （提供API接口的快速使用指南）

### 版本历史

- **v1.0.0**（2026-02-12）：初始版本，包含全部功能：
  - 多提供商支持；
  - 三种定价模式；
  - 八维度的性能评估；
  - 传令官通信系统；
  - 完整的工作流程管理；
  - 基于模板的报告功能。