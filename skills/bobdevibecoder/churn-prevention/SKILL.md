# 防止客户流失（Churn Prevention）

该功能用于检测有流失风险的订阅者，并触发相应的挽留流程，以降低客户流失率。

## 概述

系统会监控订阅事件中的取消信号，识别出有流失风险的客户，并生成相应的挽留邮件和优惠信息。目标是将每月的客户流失率降至5%以下。

## 使用方法

- `churn check`：分析所有订阅者的流失风险
- `churn at-risk`：列出被标记为有流失风险的客户
- `churn winback PRODUCT-SLUG`：生成挽留邮件序列
- `churn report`：生成每月的客户流失分析报告

## 流失风险信号

| 信号 | 风险等级 | 来源 |
|--------|-----------|--------|
| 支付失败2次以上 | 高 | Stripe事件 |
| 订阅降级 | 中等 | Stripe事件 |
| 14天以上未登录 | 中等 | 分析系统（如果已记录） |
| 提交支持投诉 | 中等 | 反馈收集系统 |
| 提交取消申请 | 高 | Stripe事件 |
| 试用期结束且未升级 | 中等 | Stripe事件 |

## 检测机制

通过POST请求检查Stripe平台上的流失风险信号：
```
POST http://host.docker.internal:18790/stripe-query
Headers: Content-Type: application/json, X-Bridge-Secret: DEPLOY_BRIDGE_SECRET
Body: { "type": "at-risk", "daysInactive": 14 }
```

同时还需要检查以下情况：
- 订阅状态为“过期未支付”的订阅者
- 过去30天内支付失败的订阅者
- 被设置为在周期结束时自动取消的订阅者

## 挽留流程

### 对于支付失败（非自愿流失的情况）

1. 第0天：发送“您的支付失败了”邮件，附上更新银行卡的链接
2. 第3天：发送“还有问题吗？”邮件，提供其他支付方式
3. 第7天：发送“想念您”邮件，提供额外7天的免费使用期限
4. 第14天：暂停账户，并提供3个月内的50%折扣优惠，鼓励用户升级

### 对于取消订阅（自愿流失的情况）

1. 立即发送调查问卷，询问用户离开的原因
2. 第1天：发送“在您离开之前”邮件，提供3个月内的30%折扣优惠
3. 第7天：发送“新功能上线”邮件，介绍最近的改进
4. 第30天：发送“我们已做出改进”邮件，总结用户离开后的变化

### 对于试用期结束的情况

1. 提前3天发送“您的试用期将在3天后结束”邮件，强调试用期的价值
2. 提前1天发送“试用期的最后一天”邮件，提供特别优惠价格
3. 第0天：发送“试用期结束”邮件，如果用户决定升级，则提供额外7天的试用期
4. 第3天后发送“还在犹豫吗？”邮件，比较当前服务与其他替代方案的优势

## 输出结果

挽留邮件草稿将保存在以下路径：
```
/home/milad/.openclaw/workspace/skills/churn-prevention/winback/PRODUCT-SLUG/
```

## 需要跟踪的指标

- 每月客户流失率（目标：低于5%）
- 挽留成功率
- 通过挽留流程恢复的收入
- 平均客户生命周期（目标：超过6个月）

## 规则

- 绝不要自动发送挽留邮件，需先生成草稿供人工审核
- 每次挽留流程最多发送4封邮件
- 立即处理用户的退订请求
- 记录所有流失事件以进行趋势分析
- 在每周收入报告中报告每月的客户流失数据

## 集成方式

- 使用`stripe-webhook-monitor`实时监控取消订阅事件
- 使用`user-feedback-collector`收集用户反馈
- 将数据传输到`revenue-tracker`系统以计算流失率
- 严格按照`email-outreach`格式标准生成邮件