---
name: tokenmeter
description: "跟踪不同提供商提供的AI服务的使用情况与费用。您可以导入会话数据、查看仪表板、费用明细，并比较使用“Max计划”所带来的费用节省情况。"
user-invocable: true
metadata: {"openclaw":{"emoji":"📊"}}
---

# tokenmeter - 用于 OpenClaw 的 AI 使用量与成本追踪工具

该工具可帮助您实时追踪所有提供商提供的 AI 令牌使用情况及其成本，数据存储在本地（私有环境中）。

## 命令示例

- `/tokenmeter`：显示今日的仪表盘信息
- `/tokenmeter this week?`：查询本周的花费
- `/tokenmeter costs by model`：按模型分类的成本统计
- `/tokenmeter import latest sessions`：导入最新的使用数据
- `/tokenmeter compare max plan savings`：比较 API 订阅方案的成本节省情况

## 功能概述

**tokenmeter** 是一个命令行工具（CLI），用于追踪大型语言模型（LLM）的 API 使用情况并计算实际成本。对于使用 Claude Max 订阅方案的 OpenClaw 用户而言，该工具具有以下作用：

1. **证明 Max 订阅方案的价值**：显示您若按 API 计费需要支付的费用
2. **监控使用模式**：了解您最常使用的模型
3. **提前发现超量使用情况**：判断是否过度使用了高成本的模型
4. **统一的数据追踪**：支持跨多个 OpenClaw 实例的数据管理

所有数据均存储在本地（SQLite 数据库 `~/.tokenmeter/usage.db` 中），无需上传到云端。

---

## 安装过程

**该工具会自动完成所有安装步骤。**

首次使用时，工具会自动创建虚拟环境（`venv`）并运行相关命令。之后，每次您请求查询使用量或成本时，工具会自动克隆、安装并配置相关组件，无需任何管理员干预。

---

## 工具的工作原理

### 当您询问“本周花费了多少？”时：

**步骤 1：** 工具会读取此 `SKILL.md` 文件
  - 通过关键词（如 “spend”、“cost”、“usage”、“tokens”）触发相应的处理逻辑
  - 将整个文件内容纳入处理流程

**步骤 2：** 工具会检查 `tokenmeter` 是否已存在

**步骤 3：** 工具会导入最新的使用数据
  - 读取所有 OpenClaw 会话文件并将其记录到数据库中

**步骤 4：** 工具会执行相应的命令

**步骤 5：** 工具会解析处理结果

**步骤 6：** 以简洁的中文形式向您反馈结果**
  例如：“您本周的花费为 1,142 美元（按 API 计费标准计算）。Opus 模型的使用成本为 742 美元（占 65%），Sonnet 模型的使用成本为 400 美元（占 35%）。您的 Max 订阅方案每月节省了 1,117 美元。”

---

## 命令参考

**标准命令格式：**

**工具常用的命令：**

---

## 使用方法

### 快速命令

---

## 与 OpenClaw 的集成

**推荐方式：** OpenClaw 会自动将令牌使用数据写入 JSONL 格式的会话文件中

**步骤 1：** 查找会话文件的位置**

**步骤 2：** 一次性导入所有会话数据**

**效果：**
- 解析所有会话文件
- 从每次 LLM 调用中提取令牌使用量
- 将数据按 API 计费标准记录到 `tokenmeter` 数据库中
- 避免重复导入已有的数据
- 显示总记录数及总成本

**可选参数：**
（具体参数可根据实际需求添加）

**建议：** 每天通过 cron 任务或在高负载使用后手动运行 `tokenmeter import --auto` 命令。

### 手动数据导入（备用方案）

如果您需要手动导入数据：

**参数说明：**
- `--provider` / `-p`：指定使用提供商（anthropic、openai、google、azure）
- `--model` / `-m`：指定使用的模型名称（参见 `tokenmeter models`）
- `--input` / `-i`：输入的令牌数量
- `--output` / `-o`：输出文件的路径
- `--app` / `-a`：应用程序名称（例如 “openclaw”）

---

## 数据解读

### 模型定价（截至 2026 年 2 月）

| 令牌类型 | claude-sonnet-4 | claude-opus-4 | claude-3.5-haiku |
|------------|----------------|---------------|------------------|
| **输入令牌** | 3.00 美元/百万次调用 | 15.00 美元/百万次调用 | 0.80 美元/百万次调用 |
| **输出令牌** | 15.00 美元/百万次调用 | 75.00 美元/百万次调用 | 4.00 美元/百万次调用 |
| **缓存写入令牌** | 3.75 美元/百万次调用 | 18.75 美元/百万次调用 | 1.00 美元/百万次调用 |
| **缓存读取令牌** | 0.30 美元/百万次调用 | 1.50 美元/百万次调用 | 0.08 美元/百万次调用 |

### 了解缓存令牌

**什么是缓存令牌？**

OpenClaw（及 Claude）使用缓存机制来存储对话中的部分内容，从而避免重复发送相同的数据。

**缓存令牌有两种类型：**
1. **缓存写入令牌**：仅发送一次并存储在缓存中
   - 例如：您的代码库、文档、系统提示等
   - 比普通输入令牌稍贵（约 25% 的额外费用）
   - 仅需支付一次，之后可重复使用
2. **缓存读取令牌**：直接从缓存中读取数据
   - 不需要再次付费
   - 比普通输入令牌便宜约 90%

**实际使用示例：**
- 未使用缓存时，我们可能需要发送约 12 亿个令牌（费用约为 3,600 美元）；
- 使用缓存后，仅需支付 307 美元用于缓存读取。

**仅通过缓存节省了 3,293 美元！**

### 仪表盘解读

**各列含义：**
- **Input**：发送给 Claude 的新令牌数量
- **Output**：Claude 生成的令牌数量
- **Cache R**：从缓存中读取的令牌数量
- **Cache W**：写入缓存的令牌数量
- **Total**：所有令牌的总数
- **Cost**：按 API 计费标准的总成本

**缓存读取令牌为何占比较高？**
- 每次继续对话时，Claude 会从缓存中读取数据，而非重新发送，从而大幅节省费用。

**成本构成：**
- 普通令牌：每百万次调用 3-15 美元
- 缓存写入令牌：略贵（约 25% 的额外费用）
- 缓存读取令牌：非常便宜（每百万次调用 0.30-1.50 美元）

**因此，尽管缓存使用量很大，总体成本仍能保持较低。**

### 与 Claude Max 订阅方案的比较

**Max 订阅方案：** 每月 100 美元

- 如果 `tokenmeter` 显示本月费用为 800 美元：
  - 按 API 计费标准：800 美元
  - Max 订阅方案费用：100 美元
  **节省：700 美元**

- 如果 `tokenmeter` 显示本月费用为 90 美元：
  - 按 API 计费标准：90 美元
  - Max 订阅方案费用：100 美元
  **多支付了 10 美元**（但可以更安心！）

---

## 日常使用流程

### 每日检查

### 每周回顾

- 关注 Opus 模型的使用情况（费用较高）
- 注意使用量异常波动的情况
- 检查输出令牌的数量（可能表明代码生成或响应时间较长）

### 月度费用对比

每月末：

- 将实际费用与 Anthropic 的账单进行对比：
  - Max 订阅方案费用：100 美元
  - 按 API 计费标准的费用：XXX 美元
  **节省金额：** （显示节省或超支的金额）

---

## 自动化设置（可选）

您可以将 `tokenmeter` 配置为定时执行（通过 cron 任务），无需手动操作：

这样即可确保数据始终保持同步。

---

## 多个 OpenClaw 实例的追踪

如果您同时运行多个 OpenClaw 实例（例如 Cheenu 和 Chhotu），每个实例都会分别向 `tokenmeter` 导入数据。您可以使用 `--app` 参数来区分不同的实例。

---

## 故障排除

### 出现 “tokenmeter: command not found” 错误

请确保已激活虚拟环境。

### 导入后仪表盘为空？

请检查：
1. 是否有 OpenClaw 会话文件（`ls ~/.clawdbot/agents/*/sessions/*.jsonl`）
2. 导入命令是否成功执行（无错误信息）
3. 数据库中是否有记录（`sqlite3 ~/.tokenmeter/usage.db "SELECT COUNT(*) FROM usage;"`）

### 价格显示不正确？

价格基于 2026 年 2 月的 API 定价。如果 Anthropic 更改了定价，请更新 `tokenmeter/pricing.py` 文件或在 GitHub 上提交问题。

---

## 示例

### 示例 1：查看今日的使用情况

**结果：** 今日费用为 4.23 美元，预计每周费用约为 30 美元，完全在 Max 订阅方案的预算范围内。

### 示例 2：每周成本统计

**结果：** Opus 模型的使用成本占 40%，但仅占令牌使用量的 7%。建议增加 Sonnet 模型的使用。

### 示例 3：月度费用对比（实际数据，2026 年 2 月）

**结果：**
- 按 API 计费标准的总费用：1,246.55 美元
- Max 订阅方案费用：100 美元
- **节省：1,146.55 美元**

Opus 模型的使用占比较高（59.6%），显示出较高的计算成本。

---

## 常见问题解答

**Q：** `tokenmeter` 会将数据发送到外部吗？**
**A：** 不会。所有数据都存储在本地数据库 `~/.tokenmeter/usage.db` 中，无数据传输。

**Q：** 如果删除数据库会怎样？**
**A：** 会丢失历史数据，但可以通过重新导入 OpenClaw 会话数据来恢复（操作是可重复的）。

**Q：** 这个工具可以用于非 OpenClaw 工具吗？**
**A：** 可以！该工具支持 Claude Code、Cursor 以及任何 LLM 工具的手动数据记录功能。

**Q：** 这会降低 OpenClaw 的运行速度吗？**
**A：** 不会。数据导入过程是独立的，日志读取也是事后进行的。

**Q：** 关于缓存令牌呢？**
**A：** `tokenmeter` 会在计算中包含缓存令牌的消耗情况（OpenClaw 本身也会记录这些数据）。

---

## 参考资料

- **GitHub 项目链接：** https://github.com/jugaad-lab/tokenmeter
- **OpenClaw 官方文档：** https://docs.openclaw.ai
- **Anthropic 定价信息：** https://anthropic.com/pricing

---

## 更新日志

### 2026-02-06（版本 2）
- 自动发现会话数据源
- 自动导入所有会话数据
- 提供了实际节省费用的示例
- 更新了工作流程及相关命令
- 在真实 OpenClaw 和 Claude Code 会话环境中进行了测试

### 2026-02-06（版本 1）
- 初始版本发布
- 完整记录了安装和使用方法
- 添加了使用示例

**专为解答 “我的 Max 订阅方案实际节省了多少费用？” 这个问题而开发！**