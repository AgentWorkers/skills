---
name: smart-memory
description: 面向AI代理的上下文感知内存系统，支持两种检索模式：快速向量搜索或定制化的Focus Agent合成功能。采用SQLite作为后端数据库，无需任何配置即可使用，同时支持本地嵌入（local embeddings）技术。
---

# Smart Memory v2.1 – Focus Agent Edition

**作为 OpenClaw 内存系统的替代方案**，具备更出色的搜索性能，并支持通过 Focus Agent 进行可选的精选内容检索。

## 主要特性

- **混合搜索**：结合了 FTS5 关键词搜索（BM25）和语义向量搜索技术
- **Focus Agent**：针对复杂查询的多阶段内容精选过程（检索 → 排序 → 合成）
- **双模式**：快速模式（直接搜索）或精选模式（智能检索）——可随时切换
- **SQLite 后端**：使用单文件数据库，无需外部服务
- **100% 本地化**：通过 Transformers.js 在本地运行嵌入模型（无需 API 密钥）
- **自动优化**：在支持的情况下使用 sqlite-vec 进行原生向量运算
- **零配置**：安装后立即可用

## 安装方法

（安装步骤请参见相应的代码块或访问 ClawHub：https://clawhub.ai/BluePointDigital/smart-memory）

## 快速入门

### 1. 同步数据
（同步数据的代码请参见相应的代码块）

### 2. 搜索（快速模式 - 默认设置）
（搜索操作的代码请参见相应的代码块）

### 3. 启用精选模式（智能检索）
（启用精选模式的代码请参见相应的代码块）

### 4. 禁用精选模式
（禁用精选模式的代码请参见相应的代码块）

## 搜索模式

### 快速模式（默认模式）
直接进行向量相似性搜索。适用于：
- 简单查询
- 快速获取事实信息
- 常规查询

（快速模式的代码请参见相应的代码块）

### 精选模式（智能检索）
通过 Focus Agent 进行多阶段内容精选。适用于：
- 复杂决策
- 多项事实的综合分析
- 规划与策略制定
- 选项比较

（精选模式的代码请参见相应的代码块）

**精选模式的工作原理：**
1. **检索**：获取 20 多个相关结果
2. **排序**：根据权重相关性进行排序（结合向量相似度和关键词匹配结果）
3. **合成**：将结果整合成连贯的叙述
4. **提供**：附带置信度的结构化上下文信息

## 工作原理

### 混合搜索算法

1. **FTS5**：查找精确的关键词匹配结果（基于 BM25 算法进行排序）
2. **向量搜索**：查找语义上的匹配结果（基于余弦相似度）
3. **合并结果**：采用加权评分方式：
   - 70% 来自向量相似度得分 + 30% 来自关键词匹配得分
   - 确保同时捕捉到用户的意图和精确的文本内容

### Focus Agent 的内容精选功能

启用该功能后，搜索过程会进行额外的处理：
（精选功能的代码请参见相应的代码块）

## 工具

### memory_search
（相关工具的代码请参见相应的代码块）

**快速模式下的返回结果：**
（快速模式下的返回结果代码请参见相应的代码块）

**精选模式下的返回结果：**
（精选模式下的返回结果代码请参见相应的代码块）

### memory_get
（相关函数的代码请参见相应的代码块）

### memory_mode（切换搜索模式）
（切换搜索模式的代码请参见相应的代码块）

## 命令行接口（CLI）命令
（CLI 命令的代码请参见相应的代码块）

## 性能对比

| 特性 | 快速模式 | 精选模式（使用 sqlite-vec） |
|---------|------------|----------------------|
| 关键词搜索 | FTS5（原生） | FTS5（原生） |
| 向量搜索 | JS 余弦相似度 | 原生 KNN 算法 |
| 内容精选 | 加速 50-100 毫秒 | 加速 50-100 毫秒 |
| 搜索速度 | 约 100 个结果/秒 | 约 10,000 个结果/秒 |
| 内存使用 | 全部数据存储在 RAM 中 | 数据库处理 |

## 何时使用精选模式

在以下情况下使用 `--focus` 选项或启用精选模式：
- 查询涉及多个相关概念
- 需要综合性的上下文信息，而不仅仅是原始数据片段
- 需要基于关系做出决策
- 需要总结项目历史信息
- 需要比较不同文件中的内容

**不建议在以下情况下使用精选模式：**
- 需要快速查找具体信息（如电话号码、命令语法）
- 需要精确的文本匹配结果
- 对搜索延迟要求较高，而不在乎上下文质量

## （可选）安装 sqlite-vec

为了获得最佳性能，请安装 sqlite-vec：
（安装 sqlite-vec 的代码请参见相应的代码块）
**未安装时**：系统仍可正常使用，但在处理大型数据库时速度会稍慢。

## 文件结构
（文件结构的代码请参见相应的代码块）

## 环境变量设置
（环境变量设置的代码请参见相应的代码块）

## 版本对比：v1 vs v2 vs v2.1

| 版本 | v1（JSON 格式） | v2（SQLite 数据库） | v2.1（Focus Agent 版本） |
|--------|-----------|------------------|-------------------|
| 搜索方式 | 仅使用向量搜索 | 混合搜索（BM25 + 向量搜索） | 混合搜索 + 智能内容精选 |
| 数据存储方式 | JSON 文件 | SQLite 数据库 | SQLite 数据库 |
| 扩展性 | 处理约 1000 个结果 | 无限制 | 无限制 |
| 关键词匹配能力 | 较弱 | 强（FTS5 算法） | 强（FTS5 算法） |
| 上下文生成能力 | 无 | 无 | 有（可切换） |
| 配置要求 | 无需配置 | 无需配置 | 无需配置 |

## 许可证

MIT 许可证